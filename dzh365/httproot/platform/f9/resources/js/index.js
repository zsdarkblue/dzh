define(["./_base","jquery","./services","splitter","ztree"],function(d,c,b){var a=d.extend(function(f){c.extend(this,f);this.tree.setting.callback.onClick=this.onTreeNodeClick.bind(this);this.iframe.on("load",this.onFrameLoad.bind(this));var i=location.search;var e=(i.match(/\bclear=([^&]*)/)||[,"Soulence"])[1];if(e!="Soulence"){localStorage.removeItem(b.key_Prefix()+"navTree")}var j=(localStorage.getItem(b.key_Prefix()+"navTree")||"").split(","),h=this.tree.getNodeByParam("id",j[0]);if(h&&h.name===j[1]){this.tree.selectNode(h,true)}else{var g=this.tree.getNodesByFilter(function(l){return l.level==0},true);if(g.children!=undefined&&g.children instanceof Array){j[0]=parseInt(g.id)+1}else{j[0]=g.id}}var k=(i.match(/\bpg=([^&]*)/)||[,"Sou"])[1];if(k!="Sou"&&parseInt(k)>0){j[0]=parseInt(k)}document.getElementById("nav_"+j[0]+"_a").click()},{onTreeNodeClick:function(h,i,g){if(g.children){this.tree.expandNode(g)}else{h.preventDefault();var f=g.url;if(/f9/.test(f)&&f.substr(0,7)!="http://"){f=b.baseUrl+f}this.showLoadingMsg();f+=/\?/.test(f)?"&":"?";this.title.text(h.target.innerText);this.iframe.css("visibility","hidden");this.iframe.attr("src",f+c.param({obj:localStorage.getItem(b.key_Prefix()+"sObj"),title:h.target.innerText}));localStorage.setItem(b.key_Prefix()+"navTree",[g.id,g.name])}},onFrameLoad:function(f){this.iframe.css("visibility","visible");this.hideLoadingMsg()}});a.init=function(){b.getNav().then(function(e){e.data[0].open=true;var f=e.title.name;c(".l_title:eq(0)>b").html(" <span>"+e.title.code+"</span>"+f);c(".l_title:eq(0)>b").attr("title",f);new a({loadingMsg:c(".l_title:eq(1)"),title:c(".l_title:eq(1)>b"),iframe:c("iframe"),tree:c.fn.zTree.init(c("#nav"),{data:{simpleData:{enable:true,idKey:"id",pIdKey:"pid",rootPId:0}},view:{dblClickExpand:false,expandSpeed:"",nameIsHTML:true,selectedMulti:false,showIcon:false,showTitle:false}},e.data)})});return this};return a});