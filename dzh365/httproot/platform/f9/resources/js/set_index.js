define(["./_base","jquery","./set_services","./set_chat"],function(d,c,e,b){var a=d.extend(function(f){c.extend(this,f);var g=c("#top-cinfo-ri-ri");c("#top-cinfo-ri-cen dl").on("mouseenter","a[data-more]",function(){g.show(5)});g.mouseleave(function(){c(this).hide(5)});c("#c-c-content .c-c-c-top").on("click","[data-bind]",function(h){e.showLoading(c("#networth"),"hidden");b.networth(this.dataset.bind);c(this).addClass("selected").siblings().removeClass("selected")});c(".item_list").on("click","a[data-type]",function(){e.redirect(this.dataset.type)});c(".notice").on("click","i[data-icon]",function(){e.downFile(this.dataset.icon)});c(".cfg-b-header").on("click","div",function(){c(this).addClass("selected").siblings().removeClass("selected");c(".cfg-bottom").find(".commhei").eq(c(this).index()).show().siblings(".commhei").hide()});c(".cfg-t-right .cfg-list").on("click","div",function(){c(this).addClass("selected").siblings().removeClass("selected");c(".cfg-top .cfg-t-right").find(".commhei").eq(c(this).index()).show().siblings(".commhei").hide()})},{assetsCfg:function(){e.getAjax("assetsCfg").then(function(f){var g=c(".cfg-bottom").find(".commhei");b.assetsCfgPie(f["饼图"]);b.assetsCfgInd(f["行业分布"]);b.assetsCfgQzhong(f["券种分布"]);g.eq(0).html(e.assetsCfgCommon(f["重仓股"]));g.eq(1).html(e.assetsCfgCommon(f["重仓债"]));g.eq(2).html(e.assetsCfgCommon(f["重仓基金"]));e.showLoading(g.eq(0),"visible",false);console.log(f)}.bind(this))},riskReturn:function(){var f={so:"jso-fc-socket.jar","function":"gw.sh.func.FCSocketRequest",parameter:"2;SECODE="+e.obj+"|*|SECODETYPE=6|*|REFINDEX=SH000001.index|*|REFINDEXTYPE=9|*|TRADEDATE="+e.getDate()+"|*|INDEXNAME=RiskBenefitAssessment|*|PRECISION=8|*|FREQ=1|*|NONRISKYIELD=|*|CALIBER=2|*|"};e.getJavaSend(f).then(function(i){var j=c(".riskReturn"),h="";if(e.isEmpty(i)||i.length<1){h=e.nodata}else{var h="";var g=[{name:"风险调整收益",field:"d0",cssClass:"t_name",cssHead:"pink"},{name:"Jensen(%)",field:"d1"},{name:"Sharpe(%)",field:"d2"},{name:"Treynor(%)",field:"d3"},{name:"Sortino(%)",field:"d4"},{name:"信息比率(%)",field:"d5"}],k=[{d0:e.getVal(i[0]["集合理财简称"],false),d1:e.getVal(i[0]["Jensen"]),d2:e.getVal(i[0]["Sharp"]),d3:e.getVal(i[0]["Treynor"]),d4:e.getVal(i[0]["Sortino"]),d5:e.getVal(i[0]["信息比率"])}];h=e.createTable(g,k);h+='<div class="rr-margin"></div>';delete g,k;var g=[{name:"波动性风险",field:"d0",cssClass:"t_name",cssHead:"pink"},{name:"Beta",field:"d1"},{name:"年化波动率(%)",field:"d2"},{name:"可决系数",field:"d3"},{name:"下行风险(%)",field:"d4"},{name:"跟踪误差(%)",field:"d5"}],k=[{d0:e.getVal(i[0]["集合理财简称"],false),d1:e.getVal(i[0]["Beta"]),d2:e.getVal(i[0]["年化波动率"]),d3:e.getVal(i[0]["决定系数R2"]),d4:e.getVal(i[0]["下跌风险(%)"]),d5:e.getVal(i[0]["跟踪误差"])}];h+=e.createTable(g,k);delete g,k}j.html(h);e.showLoading(j,"visible",false);console.log(i)}.bind(this))},jltgGallery:function(){e.getAjax("jltgGallery").then(function(f){this.phaseFun(f.phase);this.mangerFun(f.manger);this.buyFun(f.buy);this.annualincome(f.annualincome);this.product_(f.product);console.dir(f)}.bind(this))},annualincome:function(l){var k=c(".c4-height"),o="";if(e.isEmpty(l)){o=e.nodata}else{var g=[],j=[];for(var m=0,f=l.length;m<f;m++){var q={};for(var p in l[m]){if(m==0){var h={};if(p=="name"){h.name="",h.field=p,h.cssClass="t_name"}else{h.name=p,h.field=p}g.push(h)}q[p]=l[m][p]}j.push(q)}o=e.createTable(g.reverse(),j)}k.html(o);e.showLoading(k,"visible",false)},product_:function(o){var m=c(".product");if(e.isEmpty(o)||o.length<2){m.html(e.nodata)}else{var h=[],k=[],l=[],r=[{name:"申购",color:"#F78A8A",type:"column",data:[]},{name:"赎回",color:"#84BC41",type:"column",data:[]},{name:"净申赎",dataLabels:{enabled:true,color:"#318CC7"},color:"#318CC7",type:"spline",data:[]}];for(var p=0,f=o.length;p<f;p++){var g={};for(var q in o[p]){if(p==0&&q!="净申赎"){var j={};j.name=q,j.field=q;if(q=="报告期"){j.cssClass="t_name"}h.push(j)}g[q]=o[p][q];if(q=="报告期"){g[q]=e.replaceField(o[p][q]);l.push(g[q])}if(q=="本期申购"){r[0].data.push(parseFloat(o[p][q].replace(/,/g,"")))}if(q=="本期赎回"){r[1].data.push(-parseFloat(o[p][q].replace(/,/g,"")))}if(q=="净申赎"){r[2].data.push(parseFloat(o[p][q]))}}k.push(g)}r[0].data.reverse(),r[1].data.reverse(),r[2].data.reverse(),l.reverse();b.parse_chat(l,r,"product-fe",false);c(".product-table").html(e.createTable(h,k))}e.showLoading(m,"visible",false)},buyFun:function(h){var g=c(".buy-cla");if(e.isEmpty(h)){g.html(e.nodata)}else{if(!e.isEmpty(h.C4)){delete h.C4}var k='<table class="c-c-table common-table">',j=0,f=[],o=[];for(var m in h){var l="";if(h[m].length>6){l=' title="'+e.custr(h[m],20)+'"'}var n='<td class="t_name" width="27%">'+m+"</td><td"+l+">"+h[m]+"</td>";if(j<5){f.push(n)}else{o.push(n)}j++}for(var m in f){k+="<tr>"+f[m]+'<td width="5%"></td>'+o[m]+"</tr>"}k+="</table>";g.html(k)}e.showLoading(g,"visible",false)},mangerFun:function(f){if(!e.isEmpty(f)){var g=c("#tzjl-con");g.find("tr").eq(0).find("td").eq(1).html("<span>"+f["名字"]+"</span>　　"+f["任职机构"]);var j=f["简历"],i="",h=g.find("tr").eq(1).find("td").eq(0);if(j.length>180){i=e.custr(j,35);j=j.substring(0,180)+"...";h.attr("title",i)}h.html(j);if(!e.isEmpty(f["头像"])){g.find("tr").eq(0).find("td").eq(0).find("img").attr("src",f["头像"])}}},phaseFun:function(r){var f=c("#jdsy-table"),s=c("#jdsy-con"),t=r.val.length;if(t>1){var k=[],l=[],p=[],u=[],y=["#B40104","#5EAAF6","#FFCC00"];for(var q=0;q<t;q++){var o=0,z={},g={name:"",data:[]};for(var x in r.val[q]){if(q==0){var w=x!="产品简称"?x:"";var m={name:w,field:"_"+o+"_"};if(o==0){m.cssClass="t_name"}k.push(m);if(o!=0){p.push(w)}}if(o==0){g.name=r.val[q][x]}else{g.data.push(parseFloat(r.val[q][x]))}z["_"+o+"_"]=r.val[q][x];o++}if((t==4&&q<3)||(t==3&&q<2)){u.push(g)}l.push(z)}for(var q=0,h=u.length;q<h;q++){u[q]["color"]=y[q]}b.parse_chat(p,u);f.html(e.createTable(k,l))}else{s.html(e.nodata)}e.showLoading(s,"visible",false)},getNotice:function(){var f={so:"jso-ui-notice_new.jar","function":"gw.sh.func.NoticeSearchRequest",parameter:{type:14,pageSize:7,objCode:"PF"+(e.obj.substring(1))+".fnd"}};e.getJavaSend(f).then(function(k){var m=c(".notice"),j="";if(e.isEmpty(k)||k.length<1){j=e.nodata}else{var n=[];for(var h=0,g=k.length;h<g;h++){n[h]={};n[h].time=k[h].C2;n[h].content=k[h].C3;n[h].icon=k[h].C7;n[h].explan=k[h].C4;n[h].id=k[h].C1;n[h].type=k[h].TYPE}j=e.createNotice(n)}m.html(j);e.showLoading(m,"visible",false);console.log(k)}.bind(this))},getInfo:function(){e.getAjax("getInfo").then(function(g){if(g["券商代码"]!=undefined){var h="";for(var f in g){var i=g[f];if(i.length>15){i=i.substring(0,15)+"..."}h+="<dd><span>"+f+'</span><span class="f-right t-right" title="'+e.custr(g[f],30)+'">'+i+"</span></dd>"}c("#c-r-info dl").html(h)}console.dir(g)}.bind(this))},createCinfo:function(){e.getAjax("Cinfo").then(function(u){if(u.type!=undefined){var f="red",h=0,j="<dd>";if(parseInt(u.type)==1&&u["最新净值"].indexOf("-")>-1){f="green"}for(var r in u){if(h<5){var q="",s="",k="";if(h<2){q=" f-bold"}else{s="%";if(r=="最新日期"){s=""}if(parseInt(u[r])<0){f="green"}}j+="<span>"+r+'：</span><span class="'+f+q+'">'+u[r]+s+k+"</span>";if(h==1){j+='</dd><dd class="r-s-con">'}}else{break}h++}c("#top-cinfo-right dl").html(j);var g=c("#top-cinfo-center dl").find("dd");g.eq(0).find("span").eq(1).html(u["状态"]==null?"--":u["状态"]);g.eq(1).find("span").eq(1).html(u["投资类型"].replace("计划","")+"｜"+u["风险等级"]+"风险");g.eq(2).find("span").eq(1).html(u["最新规模"]==null?"--":(u["最新规模"]+"亿元("+u["截止日期"]+")"))}if(u["相关产品"]!=undefined&&parseInt(u["相关产品"].length)>0){var p="",o="",m=parseInt(u["相关产品"].length);for(var h=0;h<m;h++){var n=parseFloat(u["相关产品"][h]["收益率"]);var l=parseFloat(u["相关产品"][h]["最新净值"]);var g=u["相关产品"][h]["集合理财代码"];var q="";if(!isNaN(n)){if(n<0){q="("+n+"%)"}else{q="(+"+n+"%)"}}var t='<dd><a href="'+location.origin+location.pathname+"?obj="+g+"&type="+e.type+'">'+u["相关产品"][h]["集合理财简称"]+"("+g.substring(1)+')</a><span class="'+((n<0||l<0)?"green":"red")+'"> '+((isNaN(n)&&isNaN(l))?"":""+l+q)+"</span></dd>";if(h<2){p+=t.replace('class="','class="d-none ')}o+=t}if(m>2){p+='<dd><a href="javascript:void(0)" data-more>更多</a></dd>'}c("#top-cinfo-ri-cen dl").html(p);c("#top-cinfo-ri-ri dl").html(o)}console.dir(u)}.bind(this))},init:function(){this.createCinfo();this.getInfo();b.networth("3m");this.jltgGallery();this.riskReturn();this.assetsCfg();this.getNotice()}});a.init=function(){return new a()};return a});