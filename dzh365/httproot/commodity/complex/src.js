define("repositories/commodity",["repository_base"],function(e){return new(e.extend({getComplexCommodities:function(){return $.send("/rpc",{so:"jso-ui-commodityscreen.jar","function":"gw.sh.func.CommodityScreenRequest",paraencode:"base64",parameter:btoa("{}")},{before:function(e){return e.datas.forEach(function(e){e[1].head=["obj","name"]}),e},after:function(e){return e&&e.length?[e[0],e[3],e[1],e[4],[{obj:"SH000001.index",name:"上证指数"},{obj:"IXUDI.index",name:"美元指数"},{obj:"IXDJIA.index",name:"道琼斯工业"},{obj:"IXNDX.index",name:"纳斯达克综指"},{obj:"IXSPX.index",name:"标普500"},{obj:"IXGDAXI.index",name:"德国DAX指数"},{obj:"IXN225.index",name:"日经225"},{obj:"SH000300.index",name:"沪深300"},{obj:"FXXAUUSD.frx",name:"国际黄金现货"},{obj:"SGAu(T+D).cmdty",name:"上海黄金T+D"}],e[2],e[5]]:e}})}}))}),define("repositories/news",["repository_base"],function(e){return new(e.extend({getComplexNews:function(e){return $.send("/rpc",{so:"jso-ui-zhpnews.jar","function":"gw.sh.func.SearchNewsByExpressionRequest",paraencode:"base64",parameter:btoa(JSON.stringify({fids:"C1,C2,C3,C4,C8,C16",dcategory:"1-100",bdate:"",edate:"",sort:"C16:-1",skip:"0",amount:e.amount,exp:e.exp}))})}}))}),define("presenters/index",["presenter_base","../repositories/commodity","../repositories/news"],function(e,t,i){return e.extend(function(){},{onInit:function(){t.getComplexCommodities().then(function(e){this.view.renderQuotesGrids(e),this.view.renderDefaultChart()}.bind(this)),[{amount:"52",exp:"[#in(=00000000000100010000,=000000000001000100010000)]"},{amount:"50",exp:"[(#like0000000000010001000100010000%)]"},{amount:"50",exp:"[(#like0000000000010001000100010001%)]"},{amount:"50",exp:"[(#like0000000000010001000100010002%)]"}].forEach(function(e,t){i.getComplexNews(e).then(function(e){this.view.renderNewsGrids(e,t)}.bind(this))}.bind(this))}})}),define("views/index",["view_base","../presenters/index","fast_grid","quotes_grid","tabs","dialog"],function(e,t,i,n){var s=e.extend(function(){this.tabs.on("active",this.onNewsTabActive.bind(this))},{onNewsTabActive:function(e,t){this.newsGrids[t]&&this.newsGrids[t].refresh()},onQuotesGridSelectItem:function(e,t){this.quotesGrids.forEach(function(e){e!==this&&(e.selectedItem=void 0,e.target.find("tr.active").removeClass("active"))},e),this.chart.attr("src","/platform/charts/index.html#"+t.obj)},onNewsGridSelectItem:function(e,t){if(external.closeDialog)location.assign("dzh://navigate?'root://news/details/index.html#"+t.C1+"#DZHPOPUP(854,504)#'");else{var i=this.dialog.target.find("iframe");i.attr("src","../../news/details/index.html#"+t.C1),this.dialog.show()}},renderQuotesGrids:function(e){this.quotesGrids=e.map(function(e,t){return new n(this.grids[t],{regZero:new RegExp("(\\.[1-9]+)0+$|\\.0+$"),fields:"new,lastclose,time",columns:[{width:"auto",name:"名称",css:"white l",sort:!0,value:function(e){return'<a title="'+e.name+'" href="dzh://VIEWSTOCK?DATATYPE=DAY&LAYOUT=Level2默认&PAGE=分时走势&LABEL='+e.obj+'">'+e.name.replace(/连续$|\(电子\)/,"")+"</a>"}},{width:"20%",name:"最新",color:!0,sort:!0,value:function(e){return this.fixValue(this.fixLastTrade(e)).replace(this.regZero,"$1")}},{width:"20%",name:"涨跌",color:!0,sort:!0,value:function(e){return this.fixValue(this.fixChange(e)).replace(this.regZero,"$1")}},{width:"18%",name:"涨幅",color:!0,sort:!0,order:"desc",value:function(e){return this.fixPercent(this.fixChg(e))}},{width:"15%",name:"时间",css:"white",sort:!0,value:function(e){return this.fixTime(e.time)}}],items:e,onSelectItem:this.onQuotesGridSelectItem.bind(this),onDblClick:function(e){location.assign($(e.currentTarget).find("a").attr("href"))},compare:function(e){return function(e,t){return this(e,t)||(t.time||0)-(e.time||0)||e.obj.localeCompare(t.obj)}.bind(this.base(e))}})},this)},renderNewsGrids:function(e,t){this.newsGrids[t]=new i(this.grids[7+t],{columns:[{width:"auto",name:"标题",css:"white l",sort:!0,title:!0,value:"C3"},{width:"15%",name:"时间",css:"white",sort:!0,value:function(e){return this.fixTime(e.C16)}}],items:e,onSelectItem:this.onNewsGridSelectItem.bind(this)})},renderDefaultChart:function(){for(var e=0,t=this.quotesGrids.length;t>e;e++){var i=this.quotesGrids[e];if(i.getItems().length){i.one("sorted",function(e){this.onQuotesGridSelectItem(e,e.getItem(0))}.bind(this));break}}}});return s.init=function(){new t(new this({root:$(document),grids:$(".grid"),chart:$("iframe.flex-auto"),tabs:$(".nav-tabs"),dialog:$(".dialog").widget("dialog"),quotesGrids:[],newsGrids:[]}))},s}),require(["views/index"],function(){require(["views/"+(location.pathname.match(/([^\/]+)\.html/)||[,"index"])[1]],function(){arguments[0]&&arguments[0].init&&arguments[0].init()})}),define("src",function(){});