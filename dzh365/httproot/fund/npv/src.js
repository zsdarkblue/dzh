define("views/_base",["_base","observable","jquery","_widget","datetime","filter","select"],function(t,e,i,n){return t.extend([e],function(t){i.extend(this,t),this.root.on("click","[data-bind$=Click]",this.handleEvent.bind(this)),this.root.on("change","[data-bind$=Change]",this.handleEvent.bind(this)),setTimeout(function(){"function"==typeof this.init&&this.init(t),this.emit("init")}.bind(this),0)},{handleEvent:function(t){var e=t.currentTarget.dataset.bind;e in this&&"function"==typeof this[e]&&this[e](t),this.emit(e.replace(/^on\w/,function(t){return t.slice(-1).toLowerCase()}),t.currentTarget.value||t.currentTarget.dataset)},handleLoading:function(){if(i("body").hasClass("loading"))for(var t in this)if(0===t.indexOf("render")&&"function"==typeof this[t]&&this[t].length){var e=function(){for(var t in this)if("function"==typeof this[t]&&this[t].origin){var e=this[t];this[t]=e.origin,e.origin=void 0}this[arguments.callee.key].apply(this,arguments),i("body").removeClass("loading")};e.key=t,e.origin=this[t],this[t]=e}},destroy:function(){for(var t in this)"object"==typeof this[t]&&(this[t]instanceof i&&this[t].off(),this[t]instanceof n&&this[t].destroy())}})}),define("repositories/aIndex",["repository_base"],function(t){return new(t.extend({getStatusData:function(t){return $.send("/rpc",{so:"jso-html5-fundnetvalue.jar","function":"gw.sh.func.NetValueOfFundCountRequest",paraencode:"base64",parameter:(external.base64encode||btoa)(JSON.stringify(t))})},getDateData:function(){return $.send("/rpc",{so:"jso-html5-fundnetvalue.jar","function":"gw.sh.func.FundTradeDateRequest",paraencode:"base64",parameter:""})},getTableData:function(t){return $.send("/rpc",{so:"jso-html5-fundnetvalue.jar","function":"gw.sh.func.FundNetValueRankRequest",paraencode:"base64",parameter:(external.base64encode||btoa)(JSON.stringify(t))},{before:function(t){return JSON.parse(JSON.stringify(t).replace(/\bNULL\b/g,"-"))}})},getSecurities:function(t){return $.send("/keyspirit/search",{key:encodeURI(t),f:0,e:"N2",__encoding:"gbk",l:10})},getAllCorp:function(){return $.send("/rpc",{so:"jso-html5-fundnetvalue.jar","function":"gw.sh.func.FundOrgCollectionRequest",paraencode:"base64",parameter:(external.base64encode||btoa)(JSON.stringify({}))})},getNetValueData:function(t){return $.send("/rpc",{so:"jso-html5-fundnetvalue.jar","function":"gw.sh.func.NetValueOfFundRequest",paraencode:"base64",parameter:(external.base64encode||btoa)(JSON.stringify(t))},{before:function(t){return JSON.parse(JSON.stringify(t).replace(/\bNULL\b/g,"-"))}})}}))}),define("view_models/pager",{data:{index:1,input:1,take:80,size:7,count:1,items:[],show:!1},methods:{onClick:function(t){"A"===t.target.tagName&&this.go(Number(t.target.innerText)||Number(t.target.dataset.index))},onChange:function(t){this.go(Number(t.target.value))},go:function(t){var e=this.count;return 1>t?t=e:t>e&&(t=1),this.index=t,this.input=t,this.refresh(e),this.$emit("change",this.$data),this},prev:function(){return this.go(this.index-1)},next:function(){return this.go(this.index+1)},refresh:function(t){var e=this.index,i=this.size,n=Math.floor(i/2)-1,a=e-n,r=e+n;n>a&&(a=2,r=a+i-3,r>t-1&&(r=t-1)),n>t-r&&(r=t-1,a=r-i+3,2>a&&(a=2)),this.count=t,this.input=this.index,this.items.splice(0,this.items.length);for(var s=a;r>=s;s++)this.items.push(s)}}}),define("presenters/aIndex",["presenter_base","../repositories/aIndex","../view_models/pager","vue","topic"],function(t,e,i,n,a){return t.extend(function(){this.createViewModels(),this.pager.$on("change",this.onPagerChange.bind(this)),this.view.on("changeView",this.changeView.bind(this)),this.view.on("init",this.onInitPage.bind(this)),this.view.on("filterInput",this.onFilterInput.bind(this)),this.view.on("clearSearchText",this.clearSearchText.bind(this)),this.view.on("closeFilterList",this.closeFilterList.bind(this)),this.saveData=[],n.filter("fixed",function(t,e,i){e&&isNaN(e)&&(i=e,e=2);var n,a=e||2;if(isNaN(t)||!t)return t;n=parseFloat(t).toFixed(a);var r=n.split(".");1===r.length&&(r[1]="");for(var s=a-r[1].length,o=0;s>o;o++)r[1]+="0";return i&&(n+=i),n})},{onInitPage:function(){this.view.render(this.pager,this.corpFilter),e.getNetValueData(this.view.getSendObj(this.pager)).then(this.handleData.bind(this)),e.getAllCorp().then(function(t){this.corpFilter.items=t}.bind(this)),this.bindStatusData()},bindStatusData:function(){e.getStatusData({page:1,pagesize:180,type1:1,type2:""}).then(function(t){this.view.setStatus(t[1])}.bind(this))},formatDate:function(t){return isNaN(t)?t:t.substr(0,4)+"-"+t.substr(4,2)+"-"+t.substr(6,2)},formatData:function(t){var e=this,i=["净值日期","收益起始日","收益截止日","到期日","成立日期","前净值日期","收盘日期","前收益截止日"];return t.forEach(function(t,n){t.num=n+(e.pager.index-1)*e.pager.take+1;for(var a in t)$.inArray(a,i)>=0&&(t[a]=e.formatDate(t[a]))}.bind(this)),t},createViewModels:function(){var t=this;this.view.root.find(".panel table").each(function(){var e=new n({data:{items:[],date:"",firstDate:"",secondDate:""},methods:{onFundClick:function(e,i){e.preventDefault(),a.emit("showInfoDialog",$.extend({},i,t.view.getSendObj(t.pager)))}}});$(this).data("vue",e)}),this.pager=new n(i),this.corpFilter=new n({data:{items:[],searchText:"",isShow:!1,activeItem:0},watch:{searchText:function(e){""==e?(this.isShow=!1,t.view.root.find(".cover").addClass("hide")):t.view.root.find("input[type=search]").data("id","").val("")}},methods:{itemClick:function(t){return this.searchText=t,this.isShow=!1,!1},onBlur:function(){setTimeout(function(){t.view.root.find(".cover").addClass("hide")},200)},onKeyUp:function(e){this.isShow=!0,setTimeout(function(){t.view.root.find(".cover").attr("class",t.view.root.find(".filter-corps li").length?"cover":"cover hide")},100);var i=$(".filter-corps .active"),n=$(".filter-corps ul"),a=n.find('li:not(".hide")').length;switch(e.which){case 13:case 38:case 40:if(13===e.which)i.click(),this.searchText=i.text(),this.isShow=!1,setTimeout(function(){$(e.target).blur(),t.view.root.find(".cover").addClass("hide"),$(".search-area button").click()},100);else switch(i.removeClass("active"),e.which){case 38:this.activeItem>0?this.activeItem--:this.activeItem=a-1;break;case 40:this.activeItem<a-1?this.activeItem++:this.activeItem=0}e.preventDefault()}}}})},handleTableDate:function(t,e){if(e.length){var i,n,a=this.view.getSendObj({}).type1,r=t.data("vue");switch(a){case 1:n="前净值日期",i="净值日期";break;case 2:n="净值日期",i="收盘日期";break;case 3:case 4:i="收益截止日",n="前收益截止日";break;case 5:i="净值日期"}e.forEach(function(t){return n&&!r.secondDate&&"NULL"!=t[n]&&(r.secondDate=t[n]),r.firstDate||(r.firstDate=t[i]),n&&!r.secondDate||!r.firstDate?!1:void 0})}},handleData:function(t){var e=this.view.getCurrentTable(),i=this.formatData(t[1]);e.data("vue").items=i,this.handleTableDate(e,i),this.pager.show=!!t[1].length,this.pager.refresh(Math.ceil(Number(t[0][0].total)/this.pager.take)||1),this.view.getCurrentPanel().find(".info").attr("class",this.pager.show?"info hide":"info")},getTableData:function(){this.pager.index=this.view.getPageEl().data("page");var t=this.view.getSendObj(this.pager);e.getNetValueData(t).then(this.handleData.bind(this)),1==t.type1&&this.bindStatusData()},onPagerChange:function(){this.view.getPageEl().data("page",this.pager.index),this.getTableData()},changeView:function(){this.getTableData()},onFilterInput:function(t){e.getSecurities(t).then(function(t){for(var e=[],i=0,n=t.length;n>i;i++)e.push({id:t[i]["bond"===this.type?"trcode":"obj"],name:t[i].obj.replace(/\D/g,"")+"　"+t[i].disp});this.view.renderFilterResults(e)}.bind(this))},clearSearchText:function(){this.corpFilter.searchText=""},closeFilterList:function(){this.corpFilter.isShow=!1}})}),define("repositories/dialog",["repository_base"],function(t){return new(t.extend({getDialogData:function(t){return $.send("/rpc",{so:"jso-html5-fundnetvalue.jar","function":"gw.sh.func.NetValueOfFundCurveRequest",paraencode:"base64",parameter:(external.base64encode||btoa)(JSON.stringify(t))},{before:function(t){return JSON.parse(JSON.stringify(t).replace(/\bNULL\b/g,"-"))}})}}))}),define("presenters/dialogB",["presenter_base","vue","topic","../repositories/dialog","../view_models/pager"],function(t,e,i,n,a){return t.extend(function(){this.view.on("selectRangeChange",this.selectRangeChange.bind(this)),this.view.on("onDialogTabClick",this.changeChartView.bind(this))},{init:function(){this.createViewModel(),i.on("showInfoDialog",this.initDataView.bind(this)),this.vm.$on("change",this.onDPagerChange.bind(this))},drawChart:function(t,e){this.view.renderChart(t,e>1?"%":"")},changeChartView:function(t){this.saveData[t]?1==t?this.handleChartData(this.saveData[t],t):this.drawChart(this.saveData[t],t):(this.sendObj.S2=t,7!=t&&1!=t&&this.view.clearChart(),n.getDialogData(this.sendObj).then(function(e){e.cols&&delete e.cols;var i=this.addUtcDate(e,"C1");if(i.sort(function(t,e){return t.date>e.date?1:-1}),1!=t&&1==this.vm.viewType){var n=!1;for(var a in i[0])"净值率"==a&&(n=!0);n||i.forEach(function(t){t["净值率"]=t.C18})}this.handleChartData(i,t)}.bind(this)))},onDPagerChange:function(){this.vm.list=this.getTableData()},initDataView:function(t){this.saveData={},this.vm.list=[],this.vm.show=!1,this.vm.viewType=1,(3==t.type1||4==t.type1)&&(this.vm.viewType=2),this.sendObj={SO:t["基金代码"],S1:this.vm.viewType,S2:1},this.vm.title=t["基金简称"],n.getDialogData(this.sendObj).then(function(t){t.cols&&delete t.cols;var e=this.addUtcDate(t,"净值日期"),i=this.view.getCurrentType();e.sort(function(t,e){return t.date>e.date?1:-1}),this.saveData[i]=$.extend(!0,[],e),this.saveTblData=$.extend(!0,[],e).reverse(),this.handleChartData(e,i),this.vm.index=1,this.vm.refresh(Math.ceil(Number(e.length)/this.vm.take)||1),this.vm.show=!0,this.vm.list=this.getTableData()}.bind(this)),this.view.dialog.show()},getTableData:function(){return this.saveTblData.slice((this.vm.index-1)*this.vm.take,this.vm.index*this.vm.take)},handleChartData:function(t,e){var i=$.extend(!0,[],t),n=this.view.getDateRange();if("all"!==n&&1==this.view.getCurrentType()){var a=new Date,r=a.getFullYear(),s=a.getMonth()-n,o=a.getDate(),d=Date.UTC(r,s,o);i=i.filter(function(t){return parseInt(t.date)>=d})}var h=[];for(var c in i[i.length-1])if(1==this.sendObj.S1&&("单位净值"==c||"累计净值"==c||"净值率"==c)||2==this.sendObj.S1&&("万份收益"==c||"7日年收益"==c)){var l={name:c,data:[]};i.forEach(function(t){isNaN(t[c])||l.data.push([t.date,Number(t[c])])}),"净值率"==l.name&&(l.name="收益率"),h.push(l)}1!=e&&(this.saveData[e]=$.extend(!0,[],h)),this.view.getCurrentType()==e&&this.view.renderChart(h,e>1?"%":"")},turnStrToDate:function(t){return Date.UTC(parseInt(t.substr(0,4)),parseInt(t.substr(4,2))-1,parseInt(t.substr(6,2)))},addUtcDate:function(t,e){for(var i in t)isNaN(t[i][e])?delete t[i]:t[i].date=this.turnStrToDate(t[i][e]);return t},selectRangeChange:function(){var t=this.view.getCurrentType();1==t?this.handleChartData(this.saveData[t],t):this.changeChartView(t)},createViewModel:function(){var t=this;this.vm=new e($.extend(!0,{},a,{el:t.view.dialog.target[0],data:{take:5,list:[],title:"",viewType:1}}))}})}),define("text!views/dialogB.html",[],function(){return'<div class="dialog large" draggable="true">\r\n    <div class="dialog-header"><span v-text="\'详细信息\' + \'(\' +title + \')\'"></span><i>&times;</i></div>\r\n    <div class="dialog-body">\r\n        <div class="container">\r\n            <div class="chart-area">\r\n                <ul class="tab-list" data-bind="onDialogTabClick">\r\n                    <li v-if="viewType == 1" data-type="1" class="active">净值走势</li>\r\n                    <li v-if="viewType == 1">收益走势</li>\r\n                    <li v-if="viewType == 2" class="active" data-type="1">历史收益</li>\r\n                </ul>\r\n\r\n                <div class="chart-title">\r\n\r\n                    <ul class="btns-list" data-bind="onDateRangeClick">\r\n                        <li data-type="2" data-value="1">1个月</li>\r\n                        <li data-type="3" class="active" data-value="3">3个月</li>\r\n                        <li data-type="4" data-value="6">6个月</li>\r\n                        <li data-type="5" data-value="12">1年</li>\r\n                        <li data-type="6" data-value="36">3年</li>\r\n                        <li data-type="7" data-value="all">成立以来</li>\r\n                    </ul>\r\n                </div>\r\n\r\n                <div id="chart"></div>\r\n            </div>\r\n\r\n            <div class="tbl-container">\r\n                <h3 v-if="viewType == 1">历史净值</h3>\r\n                <table v-if="viewType == 1">\r\n                    <colgroup>\r\n                        <col width="20%">\r\n                        <col width="20%">\r\n                        <col width="20%">\r\n                        <col width="20%">\r\n                        <col width="20%">\r\n                    </colgroup>\r\n                    <thead>\r\n                    <tr>\r\n                        <th>净值日期</th>\r\n                        <th>单位净值</th>\r\n                        <th>累计净值</th>\r\n                        <th>日增长值</th>\r\n                        <th>日增长率</th>\r\n                    </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                    <tr v-repeat="item:list">\r\n                        <td v-text="item[\'净值日期\'] | formatDate" class="center number"></td>\r\n                        <td>\r\n                            <span class="number" v-class="num: item[\'单位净值\'] != \'-\'"\r\n                                  v-text="item[\'单位净值\']| fixed 4"></span>\r\n                        </td>\r\n                        <td>\r\n                            <span class="number" v-class="num: item[\'累计净值\'] != \'-\'"\r\n                                  v-text="item[\'累计净值\']| fixed 4"></span>\r\n                        </td>\r\n                        <td class="number" v-class="red: item[\'增长值\']>= 0, green: item[\'增长值\']< 0">\r\n                            <span v-class="num: item[\'增长值\'] != \'-\'" v-text="item[\'增长值\'] | fixed 4"></span>\r\n                        </td>\r\n                        <td class="number" v-class="red: item[\'日增长率\']>= 0, green: item[\'日增长率\']< 0">\r\n                            <span v-class="num: item[\'日增长率\'] != \'-\'" v-text="item[\'日增长率\'] | fixed %"></span>\r\n                        </td>\r\n                    </tr>\r\n                    </tbody>\r\n                </table>\r\n\r\n                <table v-if="viewType == 2">\r\n                    <colgroup>\r\n                        <col width="33%">\r\n                        <col width="33%">\r\n                        <col width="34%">\r\n                    </colgroup>\r\n                    <thead>\r\n                    <tr>\r\n                        <th>净值日期</th>\r\n                        <th>万份收益</th>\r\n                        <th>7日年收益</th>\r\n                    </tr>\r\n                    </thead>\r\n                    <tbody>\r\n                    <tr v-repeat="item:list">\r\n                        <td v-text="item[\'净值日期\'] | formatDate" class="center number"></td>\r\n                        <td>\r\n                            <span class="number" v-class="num: item[\'万份收益\'] != \'-\'"\r\n                                  v-text="item[\'万份收益\']| fixed 3"></span>\r\n                        </td>\r\n                        <td>\r\n                        <span class="number" v-class="num: item[\'7日年收益\'] != \'-\'"\r\n                              v-text="item[\'7日年收益\']| fixed 3 %"></span>\r\n                        </td>\r\n                    </tr>\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n\r\n            <div class="pager-container">\r\n                <div class="pager" v-on="click:onClick" v-show="show">\r\n                    <a v-attr="data-index:index-1">上一页</a>\r\n                    <a v-class="active:index==1" v-text="1"></a>\r\n                    <i v-if="count>size&&index>size/2+1">...</i>\r\n                    <a v-class="active:index==$value" v-repeat="items" v-text="$value"></a>\r\n                    <i v-if="count>size&&index<count-size/2">...</i>\r\n                    <a v-class="active:index==count" v-if="count>1" v-text="count"></a>\r\n                    <a v-attr="data-index:index+1">下一页</a>\r\n                    <input v-attr="min:1,max:count" v-model="input" v-on="change:onChange" type="number">\r\n                    <a v-attr="data-index:input">GO</a>\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n\r\n    </div>\r\n</div>'}),define("views/dialogB",["view_base","../presenters/dialogB","text!views/dialogB.html","vue","dialog","highcharts"],function(t,e,i,n){var a=t.extend(function(){Highcharts.setOptions({lang:{months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],shortMonths:["1","2","3","4","5","6","7","8","9","10","11","12"]}}),n.filter("formatDate",function(t){return"-"!=t?t.substr(0,4)+"-"+t.substr(4,2)+"-"+t.substr(6,2):t}),this.dialog.on("hide",function(){this.clearChart(),this.resetTab()}.bind(this))},{onDialogTabClick:function(t){$(t.target).addClass("active").siblings().removeClass("active"),this.emit("onDialogTabClick",this.getCurrentType())},onDateRangeClick:function(t){t.preventDefault(),"LI"==t.target.tagName&&($(t.target).addClass("active").siblings().removeClass("active"),this.emit("selectRangeChange"))},getCurrentSubTab:function(){return this.dialog.target.find(".btns-list .active")},getDateRange:function(){return this.getCurrentSubTab().data("value")},getCurrentType:function(){var t;return t=this.dialog.target.find(".tab-list .active").data("type")?this.dialog.target.find(".tab-list .active").data("type"):this.getCurrentSubTab().data("type")},resetTab:function(){var t=this.dialog.target;t.find(".tab-list").find(".active").removeClass("active").end().find("li:eq(0)").addClass("active"),t.find(".btns-list").find(".active").removeClass("active").end().find("li:eq(1)").addClass("active")},clearChart:function(){this.renderChart([])},renderChart:function(t,e){new Highcharts.Chart({chart:{type:"spline",renderTo:"chart"},plotOptions:{series:{marker:{enabled:!1}}},credits:{enabled:!1},exporting:{enabled:!1},title:{text:""},subtitle:{text:""},legend:{margin:0,itemStyle:{color:"#3c4d54"}},xAxis:{type:"datetime",dateTimeLabelFormats:{day:"%b/%e",week:"%b/%e",month:"%Y.%b",year:"%Y"}},yAxis:{title:{text:""},plotLines:[{value:0,width:1,color:"#808080"}],labels:{format:e?"{value}"+e:"{value}"}},tooltip:{crosshairs:!0,shared:!0,backgroundColor:"#fff",formatter:function(){var t=new Date(this.x),e="<strong>"+t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()+"</strong>";return $.each(this.points,function(){e+='<br/><span style="font-size: 12px; font-family: normal; color: '+this.series.color+'">'+this.series.name+"</span>",e+="收益率"==this.series.name?': <span style="color: '+(this.y.toFixed(2)>0?"red":"#339966")+'">'+this.y.toFixed(2)+"%</span>":"7日年收益"==this.series.name?": <span>"+this.y+"%</span>":": <span>"+this.y+"</span>"}),e}},colors:["#5eaff6","#ff860c","#ffcc00","#90c400","#cc0001","#3bafa3","#63cef0","#b0de26","#fff54c","#a73bcc","#fe5b5c","#006e2f","#1c9d0b","#cc0001"],series:t})}});return a.init=function(t){return new e(new this({root:t.append(i),dialog:t.find(".dialog").widget("dialog")})).view},a}),define("views/index",["./_base","../presenters/aIndex","./dialogB"],function(t,e,i){var n=t.extend(function(){this.root.on("init","input[type=search]",this.onFilterInit.bind(this)),this.resetHeight(),addEventListener("resize",function(){this.resetHeight()}.bind(this))},{render:function(t,e){this.pagerDiv.removeClass("hide"),t.$mount(this.pagerDiv[0]),this.container.find("table").each(function(){$(this).data("vue").$mount(this)}),i.init(this.root.find("body")),e.$mount(this.root.find(".filter-corps")[0]),this.root.find(".search-area .filter-results").removeClass("hide")},resetHeight:function(){$("#container").css("height",document.body.clientHeight-37+"px")},onTabClick:function(t){t.preventDefault();var e,i=$(t.target);i.parent("li").length&&(i=i.parent("li:eq(0)")),(e=i.data("type"))&&(i.addClass("active").siblings().removeClass("active"),this.container.find(".panel[data-type="+e+"]").removeClass("hide").siblings(".panel").addClass("hide"),this.emit("changeView"))},onSubTabClick:function(t){t.preventDefault();var e=$(t.target);if("LI"==t.target.tagName){e.addClass("active").siblings().removeClass("active"),this.getCurrentPanel().find("[data-item="+e.data("value")+"]").removeClass("hide").siblings("table").addClass("hide");var i=this.getCurrentTable();if(i.find(".order").removeClass("order desc"),e.data("order")){var n="order";e.data("desc")&&(n+=" desc"),i.find('[data-order = "'+e.data("order")+'"]').addClass(n)}this.emit("changeView")}},getPageEl:function(){var t=this.getCurrentPanel().find(".btns-list").find(".active");return!t.length&&(t=$("#headerSecondUl .active")),t},getCurrentPanel:function(){return this.container.find('.panel:not(".hide")')},getCurrentTable:function(){return this.getCurrentPanel().find('table:not(".hide")')},getSendObj:function(t){var e=$("#searchTxt").attr("data-id"),i=this.getCurrentTable().find(".order");e=e?e.match(/\d+/)[0]:"";var n={page:t.index,pagesize:t.take,type1:this.root.find("#headerSecondUl .active").data("type"),type2:this.getCurrentPanel().find(".btns-list").find(".active").data("value")||"",code:e,fundorg:this.root.find("#searchCorp").val()};return i.length&&(n.order=i.hasClass("desc")?-1:1,n.sortby=i.data("order")),n},onFilterInit:function(t){var e=t.target.widget,i=e.target;e.on("select",function(t){this.target.val(t.innerText.replace(/^(\S+)\s(.+)/,"$2 $1")).attr("data-id",t.dataset.id)}),i.on({focus:function(){this.val("").attr("data-id","")}.bind(i),blur:function(){!this.attr("data-id")&&this.val(""),this.attr("data-id")&&$("#searchCorp").val("")}.bind(i),keyup:function(t){13===t.which&&this.blur().parent().find(">button:eq(0)").click()}.bind(i),input:function(t){var e=t.target.value.trim();e?(this.emit("filterInput",e.toUpperCase(),t.target.id),this.activeFilter=t.target.widget):t.target.widget.render([])}.bind(this)})},renderFilterResults:function(t){this.activeFilter.render(t)},onSearchClick:function(t){t.preventDefault(),1==$("#headerSecondUl .active").data("type")&&this.getCurrentPanel().find(".btns-list li:eq(0)").addClass("active").siblings().removeClass("active"),this.getPageEl().data("page",1),this.emit("changeView"),$("#searchTxt").val("").attr("data-id",""),this.emit("clearSearchText")},onTHeadClick:function(t){var e=$(t.target);if(e.parents("th").length&&(e=e.parents("th").first()),"undefined"!=typeof e.data("order")){var i=this.getCurrentPanel().find(".btns-list").find(".active");e.hasClass("order")?(e.toggleClass("desc"),i.data("desc",!i.data("desc"))):(e.parents("thead").find(".order").removeClass("order desc").find("i").remove(),e.addClass("order"),i.data("order",e.data("order")),e.find("span").length?e.find("span").append('<i class="arrow"></i>'):e.append('<i class="arrow"></i>')),this.getPageEl().data("page",1),this.emit("changeView")}},onCoverClick:function(){this.emit("closeFilterList"),this.root.find(".cover").addClass("hide")},setStatus:function(t){for(var e in t){var i=t[e];switch(i.TYPE){case"1":this.root.find("#fund-update").text(i["COUNT(*)"]);break;case"2":this.root.find("#fund-up").text(i["COUNT(*)"]);break;case"3":this.root.find("#fund-draw").text(i["COUNT(*)"]);break;case"4":this.root.find("#fund-down").text(i["COUNT(*)"])}}}});return n.init=function(){new e(new this({root:$(document),pagerDiv:$("#pagerParent"),container:$("#container")}))},n}),define("repositories/cIndex",["repository_base"],function(t){return new(t.extend({getTableData:function(t){return $.send("/rpc",{so:"jso-html5-fundnetvalue.jar","function":"gw.sh.func.FundNetValueRequest",paraencode:"base64",parameter:(external.base64encode||btoa)(JSON.stringify(t))},{before:function(t){return JSON.parse(JSON.stringify(t).replace(/\bNULL\b/g,"-"))}})},getSecurities:function(t){return $.send("/keyspirit/search",{key:encodeURI(t),f:0,e:"N2",__encoding:"gbk",l:10})},getAllCorp:function(){return $.send("/rpc",{so:"jso-html5-fundnetvalue.jar","function":"gw.sh.func.FundOrgCollectionRequest",paraencode:"base64",parameter:(external.base64encode||btoa)(JSON.stringify({}))})}}))}),define("presenters/cIndex",["presenter_base","../repositories/cIndex","../view_models/pager","vue"],function(t,e,i,n){return t.extend(function(){this.createViewModels(),this.view.on("init",this.onInitPage.bind(this)),this.view.on("reorderTable",this.reorderTable.bind(this)),n.filter("fixed",function(t,e,i){e&&isNaN(e)&&(i=e,e=2);var n,a=e||2;if(isNaN(t)||!t)return t;n=parseFloat(t).toFixed(a);var r=n.split(".");1===r.length&&(r[1]="");for(var s=a-r[1].length,o=0;s>o;o++)r[1]+="0";return i&&(n+=i),n}),n.filter("formatDate",function(t){return"-"===t?t:t.substr(0,4)+"-"+t.substr(4,2)+"-"+t.substr(6,2)})},{onInitPage:function(){this.view.render(this.vm),this.getTableData()},getTableData:function(){e.getTableData({type1:6,type2:"",sortby:0,page:1,pagesize:99999999}).then(function(t){this.saveData=$.extend(!0,[],t[1]),this.reorderTable(this.view.tblContainer.find("select").val(),!0),this.view.tblContainer.find(".info").attr("class",t[1].length?"info hide":"info")}.bind(this))},createViewModels:function(){var t=this;this.vm=new n({data:{items:[],filter:""},methods:{changeSelectRange:function(){t.view.removeOldOrder(),t.reorderTable(t.view.tblContainer.find("select").val(),!0)}}})},reArrangeData:function(t){var e=[];return t.forEach(function(t){var i=!1;e.forEach(function(e){e["名称"]===t["名称"]&&(e.lists.push(t),i=!0)}),i||e.push({"名称":t["名称"],lists:[t]})}),e},setIndex:function(t){var e=this.view.tblContainer.find("select").val();return t.forEach(function(t,i){t.index=i,t.lists.forEach(function(t){t.growthRate=t[e]})}),t},reorderTable:function(t,e){var i=this.reArrangeData($.extend(!0,[],this.saveData),t),n=this;i.forEach(function(i){i.lists=n.sortItems(i.lists,t,e),i.sortItem=e?i.lists[0][t]:i.lists[i.lists.length-1][t]}),this.vm.items=this.setIndex(this.sortItems(i,"sortItem",e))},sortItems:function(t,e,i){var n=i?1:-1,a=t.sort(function(t,i){if("-"===t[e])return n;if("-"===i[e])return-n;var a=isNaN(t[e])?t[e]:parseFloat(t[e]),r=isNaN(i[e])?i[e]:parseFloat(i[e]);return a===r?0:a>r?-n:n});return a}})}),define("views/chart",["./_base","../presenters/cIndex"],function(t,e){var i=t.extend(function(){this.resetHeight(),addEventListener("resize",function(){this.resetHeight()}.bind(this))},{render:function(t){t.$mount(this.tblContainer[0])},resetHeight:function(){$("#container").css("height",document.body.clientHeight-37+"px")},removeOldOrder:function(){this.tblContainer.find(".order").removeClass("order desc").find("> i").remove()},onTHeadClick:function(t){var e=$(t.target);e.data("type")&&(e.hasClass("order")?e.toggleClass("desc"):(e.siblings().removeClass("order desc").find("i").remove().end().end().addClass("order"),e.append('<i class="arrow"></i>')),this.emit("reorderTable",e.data("type"),e.hasClass("desc")))}});return i.init=function(){new e(new this({root:$(document),tblContainer:$(".table-container")}))},i}),define("presenters/rIndex",["presenter_base","../repositories/aIndex","../view_models/pager","vue","topic"],function(t,e,i,n,a){return t.extend(function(){this.createViewModels(),this.pager.$on("change",this.onPagerChange.bind(this)),this.view.on("changeView",this.changeView.bind(this)),this.view.on("init",this.onInitPage.bind(this)),this.view.on("filterInput",this.onFilterInput.bind(this)),this.view.on("clearSearchText",this.clearSearchText.bind(this)),this.view.on("closeFilterList",this.closeFilterList.bind(this)),this.view.on("calendarBtnClick",this.calendarBtnClick.bind(this)),this.saveData=[],this.dateArr=[],a.on("searchDate",function(t){this.view.getPageEl().data("time",t),$.extend(this.view.getCurrentPanel().data("vue").searchDate,t),this.changeView()}.bind(this)),n.filter("fixed",function(t,e,i){e&&isNaN(e)&&(i=e,e=2);var n,a=e||2;if(isNaN(t)||!t)return t;n=parseFloat(t).toFixed(a);var r=n.split(".");1===r.length&&(r[1]="");for(var s=a-r[1].length,o=0;s>o;o++)r[1]+="0";return i&&(n+=i),n})},{onInitPage:function(){var t=this;this.view.render(this.pager,this.corpFilter),e.getDateData().then(function(e){e.forEach(function(e){t.dateArr.push(e.C1)}),a.emit("getDayArr",t.dateArr);var i={beginDate:t.formatDate(t.dateArr[1]),endDate:t.formatDate(t.dateArr[0])};t.view.setDefaultSearchDate(i),t.view.getCurrentPanel().data("vue").searchDate=i}),e.getTableData(t.view.getSendObj(t.pager)).then(t.handleData.bind(t)),e.getAllCorp().then(function(e){t.corpFilter.items=e})},formatDate:function(t){return isNaN(t)?t:t.substr(0,4)+"-"+t.substr(4,2)+"-"+t.substr(6,2)},formatData:function(t){var e=this,i=["净值日期","收益起始日","收益截止日","到期日","成立日期","最新日期"];return t.forEach(function(t,n){t.num=n+(e.pager.index-1)*e.pager.take+1;for(var a in t)$.inArray(a,i)>=0&&(t[a]=e.formatDate(t[a]))}),t},createViewModels:function(){this.selectItems=[];var t=this;this.view.root.find(".panel").each(function(){var t=new n({data:{items:[],date:"",searchDate:{}}});$(this).data("vue",t)}),this.pager=new n(i),this.corpFilter=new n({data:{items:[],searchText:"",isShow:!1,activeItem:0},watch:{searchText:function(e){""==e?(this.isShow=!1,t.view.root.find(".cover").addClass("hide")):t.view.root.find("input[type=search]").data("id","").val("")}},methods:{itemClick:function(t){return this.searchText=t,this.isShow=!1,!1},onBlur:function(){setTimeout(function(){t.view.root.find(".cover").addClass("hide")},200)},onKeyUp:function(e){this.isShow=!0,setTimeout(function(){t.view.root.find(".cover").attr("class",t.view.root.find(".filter-corps li").length?"cover":"cover hide")},100);var i=$(".filter-corps .active"),n=$(".filter-corps ul"),a=n.find('li:not(".hide")').length;switch(e.which){case 13:case 38:case 40:if(13===e.which)i.click(),this.searchText=i.text(),this.isShow=!1,setTimeout(function(){$(e.target).blur(),t.view.root.find(".cover").addClass("hide"),$(".search-area button").click()},100);else switch(i.removeClass("active"),e.which){case 38:this.activeItem>0?this.activeItem--:this.activeItem=a-1;break;case 40:this.activeItem<a-1?this.activeItem++:this.activeItem=0}e.preventDefault()}}}})},filterData:function(t){return t.forEach(function(t){if("200017"==t["基金代码"])for(var e in t)"基金代码"!=e&&"基金简称"!=e&&(t[e]="-")}),t},handleData:function(t){var e=this.filterData(t[1]);this.view.getCurrentPanel().data("vue").items=this.formatData(e),this.pager.show=!!e.length,this.pager.refresh(Math.ceil(Number(t[0][0].total)/this.pager.take)||1),this.view.getCurrentPanel().find(".info").attr("class",this.pager.show?"info hide":"info")},getTableData:function(){this.pager.index=this.view.getPageEl().data("page"),e.getTableData(this.view.getSendObj(this.pager)).then(this.handleData.bind(this))},onPagerChange:function(){this.view.getPageEl().data("page",this.pager.index),this.getTableData()},changeView:function(){this.view.getCurrentPanel().data("vue").searchDate=this.view.getPageEl().data("time"),this.getTableData()},onFilterInput:function(t){e.getSecurities(t).then(function(t){for(var e=[],i=0,n=t.length;n>i;i++)e.push({id:t[i]["bond"===this.type?"trcode":"obj"],name:t[i].obj.replace(/\D/g,"")+"　"+t[i].disp});this.view.renderFilterResults(e)}.bind(this))},clearSearchText:function(){this.corpFilter.searchText=""},closeFilterList:function(){this.corpFilter.isShow=!1},calendarBtnClick:function(){a.emit("openCalendarModel",this.view.getPageEl().data("time"))}})}),define("presenters/dialogA",["presenter_base","vue","topic","../repositories/dialog"],function(t,e,i){return t.extend(function(){this.view.on("closeAndSendData",this.searchBtnClick.bind(this))},{init:function(){i.on("openCalendarModel",this.bindDate.bind(this))},bindDate:function(t){this.view.setDate(t),this.view.dialog.show()},searchBtnClick:function(t){i.emit("searchDate",t),this.view.dialog.hide()}})}),define("text!views/dialogA.html",[],function(){return'<div class="dialog" draggable="true">\r\n    <div class="dialog-header">时间范围选择<i>&times;</i></div>\r\n    <div class="dialog-body">\r\n        <div class="container">\r\n            <form action="">\r\n                <div class="form-group">\r\n                    <label for="beginDate">起始时间：</label><input type="datetime" id="beginDate" type="text"><i\r\n                        class="fa fa-calendar"></i>\r\n                    <p class="errorMsg">\r\n                        <span class="required hide">起始时间不能为空!</span>\r\n                        <span class="format hide">起始时间格式不正确</span>\r\n                    </p>\r\n                </div>\r\n                <div class="form-group">\r\n                    <label for="endDate">结束时间：</label><input type="datetime" id="endDate"><i class="fa fa-calendar"></i>\r\n                    <p class="errorMsg">\r\n                        <span class="required hide">结束时间不能为空!</span>\r\n                        <span class="format hide">结束时间格式不正确</span>\r\n                        <span class="hide compare">结束时间需大于起始时间!</span>\r\n                    </p>\r\n                </div>\r\n                <div class="buttons-group">\r\n                    <button class="btn btn-gray" data-bind="onSearchBtnClick">查询</button>\r\n                </div>\r\n            </form>\r\n        </div>\r\n    </div>\r\n</div>'
}),define("views/dialogA",["view_base","../presenters/dialogA","text!views/dialogA.html","topic","dialog"],function(t,e,i,n){var a=t.extend(function(){this.beginDate=this.dialog.target.find("#beginDate"),this.endDate=this.dialog.target.find("#endDate");var t=[];n.on("getDayArr",function(e){t=e}),$.fn.datepicker.defaults.onRender=function(e){var i=e.getMonth()+1,n=e.getDate(),a=e.getFullYear().toString()+(i>9?i:"0"+i)+(n>=10?n:"0"+n)+"000000";return t.indexOf(a)>-1?"":"disabled"}},{setDate:function(t){this.beginDate.val(t.beginDate),this.endDate.val(t.endDate)},clearErrorMsg:function(){this.dialog.target.find(".errorMsg > span").addClass("hide").end().find(".error").removeClass("error")},checkDateFormat:function(t){return/^[1,2]\d{3}-[0,1]\d-[0,1,2,3]\d$/.test(t)},turnStrToDate:function(t){return new Date(Date.parse(t.replace(/-/g,"/")))},validate:function(){var t=!0,e=this;return this.clearErrorMsg(),this.dialog.target.find("input").each(function(){var i=$(this),n=i.val(),a=i.parents(".form-group:eq(0)");return""==n?(a.addClass("error").find(".required").removeClass("hide"),t=!1,!1):void(e.checkDateFormat(n)||(a.addClass("error").find(".format").removeClass("hide"),t=!1))}),t&&(t=this.turnStrToDate(this.endDate.val())>=this.turnStrToDate(this.beginDate.val()),t||this.dialog.target.find(".compare").removeClass("hide")),t},onSearchBtnClick:function(t){t.preventDefault(),t.stopPropagation(),this.validate()&&this.emit("closeAndSendData",{beginDate:this.beginDate.val(),endDate:this.endDate.val()})}});return a.init=function(t){return new e(new this({root:t.append(i),dialog:t.find(".dialog").widget("dialog")})).view},a}),define("views/ranking",["./_base","../presenters/rIndex","./dialogA"],function(t,e,i){var n=t.extend(function(){this.root.on("init","input[type=search]",this.onFilterInit.bind(this)),this.resetHeight(),addEventListener("resize",function(){this.resetHeight()}.bind(this))},{render:function(t,e){this.pagerDiv.removeClass("hide"),t.$mount(this.pagerDiv[0]),this.container.find(".panel").each(function(){$(this).data("vue").$mount(this)}),i.init(this.root.find("body")).dialog,e.$mount(this.root.find(".filter-corps")[0]),this.root.find(".search-area .filter-results").removeClass("hide")},resetHeight:function(){$("#container").css("height",document.body.clientHeight-37+"px")},onTabClick:function(t){t.preventDefault();var e,i=$(t.target);i.parent("li").length&&(i=i.parent("li:eq(0)")),(e=i.data("type"))&&(i.addClass("active").siblings().removeClass("active"),this.container.find(".panel[data-type="+e+"]").removeClass("hide").siblings(".panel").addClass("hide"),this.emit("changeView"))},onSubTabClick:function(t){t.preventDefault();var e=$(t.target);if("LI"==t.target.tagName){e.addClass("active").siblings().removeClass("active"),this.getCurrentPanel().find("[data-item="+e.data("value")+"]").removeClass("hide").siblings("table").addClass("hide");var i=this.getCurrentTable();if(i.find(".order").removeClass("order desc"),e.data("order")){var n="order";e.data("desc")&&(n+=" desc"),i.find('[data-order = "'+e.data("order")+'"]').addClass(n)}this.emit("changeView")}},getPageEl:function(){var t=this.getCurrentPanel().find(".btns-list").find(".active");return!t.length&&(t=$("#headerSecondUl .active")),t},getCurrentPanel:function(){return this.container.find('.panel:not(".hide")')},getCurrentTable:function(){return this.getCurrentPanel().find('table:not(".hide")')},getSendObj:function(t){function e(t){var e=t.split("-");return e[0]+e[1]+e[2]+"000000"}var i=$("#searchTxt").attr("data-id"),n=this.getCurrentTable().find(".order"),a=this.getPageEl().data("time");i=i?i.match(/\d+/)[0]:"";var r={page:t.index,pagesize:t.take,type1:this.root.find("#headerSecondUl .active").data("type"),type2:this.getCurrentPanel().find(".btns-list").find(".active").data("value")||"",code:i,fundorg:this.root.find("#searchCorp").val(),bdate:a&&e(a.beginDate)||"",edate:a&&e(a.endDate)||""};return n.length&&(r.order=n.hasClass("desc")?-1:1,r.sortby=n.data("order")),r},onFilterInit:function(t){var e=t.target.widget,i=e.target;e.on("select",function(t){this.target.val(t.innerText.replace(/^(\S+)\s(.+)/,"$2 $1")).attr("data-id",t.dataset.id)}),i.on({focus:function(){this.val("").attr("data-id","")}.bind(i),blur:function(){!this.attr("data-id")&&this.val(""),this.attr("data-id")&&$("#searchCorp").val("")}.bind(i),keyup:function(t){13===t.which&&this.blur().parent().find(">button:eq(0)").click()}.bind(i),input:function(t){var e=t.target.value.trim();e?(this.emit("filterInput",e.toUpperCase(),t.target.id),this.activeFilter=t.target.widget):t.target.widget.render([])}.bind(this)})},renderFilterResults:function(t){this.activeFilter.render(t)},onSearchClick:function(t){t.preventDefault(),1==$("#headerSecondUl .active").data("type")&&this.getCurrentPanel().find(".btns-list li:eq(0)").addClass("active").siblings().removeClass("active"),this.getPageEl().data("page",1),this.emit("changeView"),$("#searchTxt").val("").attr("data-id",""),this.emit("clearSearchText")},onTHeadClick:function(t){var e=$(t.target);if(e.parents("th").length&&(e=e.parents("th").first()),"undefined"!=typeof e.data("order")){var i=this.getCurrentPanel().find(".btns-list").find(".active");e.hasClass("order")?(e.toggleClass("desc"),i.data("desc",!i.data("desc"))):(e.parents("thead").find(".order").removeClass("order desc").find("i:not(.fa-calendar)").remove(),e.addClass("order"),i.data("order",e.data("order")),e.find("> span").length?e.find("> span").last().append('<i class="arrow"></i>'):e.append('<i class="arrow"></i>')),this.getPageEl().data("page",1),this.emit("changeView")}},onCoverClick:function(){this.emit("closeFilterList"),this.root.find(".cover").addClass("hide")},onCalendarBtnClick:function(t){t.preventDefault(),t.stopPropagation()},setDefaultSearchDate:function(t){this.root.find(".btns-list > li").each(function(){$(this).data("time",$.extend(!0,{},t))})}});return n.init=function(){new e(new this({root:$(document),pagerDiv:$("div.pager"),container:$("#container")}))},n}),require(["views/index","views/chart","views/ranking"],function(){require(["views/"+(location.pathname.match(/([^\/]+)\.html/)||[,"index"])[1]],function(){arguments[0]&&arguments[0].init&&arguments[0].init()})}),define("src",function(){});