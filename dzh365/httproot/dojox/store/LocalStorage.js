//>>built
define("dojox/store/LocalStorage",["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/store/util/QueryResults","dojo/store/util/SimpleQueryEngine"],function(h,i,g,j,k){return h(null,{DEFAULT_NAMESPACE:"default",constructor:function(a){if(!window.localStorage)throw Error("LocalStorage not available on this device");i.mixin(this,a);this.setData(this.data||[])},idProperty:"id",queryEngine:k,get:function(a){a=this.getFullKey(a,this.namespace?this.namespace:this.DEFAULT_NAMESPACE);return g.fromJson(localStorage.getItem(a))},
getIdentity:function(a){return a[this.idProperty]},put:function(a,b){var c=a[this.idProperty]=b&&b.id||a[this.idProperty]||this.getId(),d=this.getFullKey(c,this.namespace?this.namespace:this.DEFAULT_NAMESPACE);localStorage.setItem(d,g.toJson(a));return c},add:function(a,b){if(this.get(a[this.idProperty]))throw Error("Object already exists");return this.put(a,b)},remove:function(a){a=this.getFullKey(a,this.namespace?this.namespace:this.DEFAULT_NAMESPACE);localStorage.removeItem(a)},query:function(a,
b){for(var c=this.namespace?this.namespace:this.DEFAULT_NAMESPACE,c="__"+c+"_",d=[],e=0;e<localStorage.length;e++){var f=localStorage.key(e);this._beginsWith(f,c)&&(f=f.substring(c.length),d.push(this.get(f)))}return j(this.queryEngine(a,b)(d))},setData:function(a){var d;if(a.items)this.idProperty=a.identifier,d=this.data=a.items,a=d;for(var b=0,c=a.length;b<c;b++)this.put(a[b])},getFullKey:function(a,b){return"__"+b+"_"+a},getKeys:function(a){for(var a=a||this.DEFAULT_NAMESPACE,a="__"+a+"_",b=[],
c=0;c<localStorage.length;c++){var d=localStorage.key(c);this._beginsWith(d,a)&&(d=d.substring(a.length),b.push(d))}return b},clear:function(a){for(var a=a||this.DEFAULT_NAMESPACE,a="__"+a+"_",b=[],c=0;c<localStorage.length;c++)this._beginsWith(localStorage.key(c),a)&&b.push(localStorage.key(c));dojo.forEach(b,dojo.hitch(localStorage,"removeItem"))},getNamespaces:function(){var a=[this.DEFAULT_NAMESPACE],b={};b[this.DEFAULT_NAMESPACE]=!0;for(var c=/^__([^_]*)_/,d=0;d<localStorage.length;d++){var e=
localStorage.key(d);!0==c.test(e)&&(e=e.match(c)[1],"undefined"==typeof b[e]&&(b[e]=!0,a.push(e)))}return a},_beginsWith:function(a,b){return b.length>a.length?!1:a.substring(0,b.length)===b},getId:function(){function a(a){for(a=a.toString(b);8>a.length;)a="0"+a;return a}var b=16,c=a((new Date).getTime()),d=a(Math.floor(Math.random()%1*Math.pow(2,32)));return c=(c+d).toLowerCase()}})});