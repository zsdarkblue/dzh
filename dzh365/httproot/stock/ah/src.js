define("repositories/stock",["repository_base"],function(t){return new(t.extend({getInfo:function(t,e){return 1===arguments.length&&(e=t,t="new,lastclose"),$.send("/objinfo/getinfo",{field:t,where:"obj="+e})},getQuotes:function(t,e,i){switch(arguments.length){case 1:i=t,e="new,lastclose",t=void 0;break;case 2:i=e,e=t,t=void 0}return $.send(t?"/did?did="+t:"/quote/dyna",{field:e,where:"obj="+i,response_mode:0,response_times:-1})},getAHStocks:function(){return $.send("/rpc",{so:"jso-ui-ahpricecomparision.jar","function":"gw.sh.func.AHLinkageStockRequest",paraencode:"base64",parameter:btoa("{}")})},getHGTStocks:function(t){return $.send("/rpc",{so:"jso-ui-ahpricecomparision.jar","function":"gw.sh.func.GetHGTStockRequest",paraencode:"base64",parameter:btoa(JSON.stringify({type:t}))},{before:function(t){return t.datas[0][1].head=["obj","name"],t}})},getAStocks:function(){return this.getHGTStocks(1)},getHStocks:function(){return this.getHGTStocks(2)},getHGTLimit:function(){return $.send("/rpc",{so:"jso-ui-ahpricecomparision.jar","function":"gw.sh.func.GetHGTLimitRequest",paraencode:"base64",parameter:btoa("{}")})}}))}),define("repositories/forex",["repository_base"],function(t){return new(t.extend({getHKDExchangeRate:function(){return $.send("/rpc",{so:"jso-ui-ahpricecomparision.jar","function":"gw.sh.func.HKDollarExchangeRateRequest",paraencode:"base64",parameter:btoa("{}")})}}))}),define("presenters/index",["presenter_base","vue","formatter","../repositories/stock","../repositories/forex"],function(t,e,i,n,s){return t.extend(function(){},{onInit:function(){this.createViewModel(),$.when(n.getAHStocks(),s.getHKDExchangeRate(),n.getInfo(["HIHSAHP.index","HIAHXAH.index"])).then(function(t,e){this.exchangeRate=.01*(t.length&&e.length&&e[0].C6||0),e.length&&this.subscribe(t).then(function(){this.view.renderHeader(this.vm),this.view.renderGrid(this.items,this.exchangeRate)}.bind(this)),this.updateViewModel(arguments[2]),n.getQuotes(["HIHSAHP.index","HIAHXAH.index"]).progress(this.updateViewModel.bind(this))}.bind(this),function(){location.reload()}.bind(this))},subscribe:function(t){return this.items=t,this.keys=[],this.items.forEach(function(t){this.items[t.a_obj]=t,this.items[t.h_obj]=t,this.keys.push(t.a_obj,t.h_obj)},this),n.getInfo(this.keys).then(function(t){this.updateItems(t),n.getQuotes(this.keys).progress(this.updateItems.bind(this))}.bind(this))},updateItems:function(t){t.length&&(t.forEach(function(t){var e=this.items[t.obj],i=0===t.obj.indexOf("HK")?"h_":"a_";for(var n in t)("new"!==n||0!=e[n])&&(e[i+n]=isNaN(Number(t[n]))?t[n]:Number(t[n]))},this),this.view.renderGrid())},createViewModel:function(){this.vm=new e({data:{HIHSAHP:{"new":"",change:"",chg:""},HIAHXAH:{"new":"",change:"",chg:""}}})},updateViewModel:function(t){t.forEach(function(t){var e=this.vm[t.obj.replace(/\..+/,"")];e.new=i.fixFloat(i.fixLastTrade(t)),e.change=i.fixFloat(i.fixChange(t)),e.chg=i.fixPercent(i.fixChg(t))},this)}})}),define("views/index",["view_base","../presenters/index","active_grid","splitter"],function(t,e,i){var n=t.extend(function(){this.splitter.on("move",this.onSplitterMove.bind(this))},{onSplitterMove:function(){this.quotesGrid&&this.quotesGrid.refresh()},onQuotesGridSelectItem:function(t,e){this.renderCharts(e.a_obj,e.h_obj)},renderHeader:function(t){t.$mount(this.header[0])},renderGrid:function(t,e){arguments.length?(this.quotesGrid=new i(this.grid[0],{columns:[{width:"40",name:"序号",css:"white c",value:function(t,e){return e+1}},{width:"80",name:"A股代码",css:"blue c",sort:!0,value:function(t){return this.fixSymbol(t.a_obj)}},{width:"80",name:"A股简称",css:"l",sort:!0,value:"a_name"},{width:"60",name:"最新",css:"white",color:function(t){return this.fixColor(this.fixChange(t.a_new,t.a_lastclose))},sort:!0,value:function(t){return this.fixValue(this.fixLastTrade(t.a_new,t.a_lastclose))}},{width:"60",name:"涨跌",css:"white",color:function(t){return this.fixColor(this.fixChange(t.a_new,t.a_lastclose))},sort:!0,value:function(t){return this.fixValue(this.fixChange(t.a_new,t.a_lastclose))}},{width:"60",name:"涨幅",css:"white",color:function(t){return this.fixColor(this.fixChange(t.a_new,t.a_lastclose))},sort:!0,order:"desc",value:function(t){return this.fixFloat(this.fixChg(t.a_new,t.a_lastclose))}},{width:"80",name:"A/H比价",sort:!0,value:function(t){return this.fixValue(this.fixLastTrade(t.a_new,t.a_lastclose)/(this.fixLastTrade(t.h_new,t.h_lastclose)*this.exchangeRate))}},{width:"75",name:"溢价率",sort:!0,value:function(t){return this.fixFloat(100*(this.fixLastTrade(t.a_new,t.a_lastclose)/(this.fixLastTrade(t.h_new,t.h_lastclose)*this.exchangeRate)-1))}},{width:"76",name:"AH价差",sort:!0,value:function(t){return this.fixValue(this.fixLastTrade(t.a_new,t.a_lastclose)-this.fixLastTrade(t.h_new,t.h_lastclose)*this.exchangeRate)}},{width:"80",name:"H股代码",css:"blue c",sort:!0,value:function(t){return this.fixSymbol(t.h_obj)}},{width:"130",name:"H股简称",css:"l",sort:!0,value:"h_name"},{width:"60",name:"最新",color:function(t){return this.fixColor(this.fixChange(t.h_new,t.h_lastclose),3)},css:"white",sort:!0,value:function(t){return this.fixValue(this.fixLastTrade(t.h_new,t.h_lastclose),3)}},{width:"60",name:"涨跌",css:"white",color:function(t){return this.fixColor(this.fixChange(t.h_new,t.h_lastclose),3)},sort:!0,value:function(t){return this.fixValue(this.fixChange(t.h_new,t.h_lastclose),3)}},{width:"60",name:"涨幅",css:"white",color:function(t){return this.fixColor(this.fixChange(t.h_new,t.h_lastclose),3)},sort:!0,value:function(t){return this.fixFloat(this.fixChg(t.h_new,t.h_lastclose),3)}},{width:"auto",name:"",value:function(){return""}}],exchangeRate:e,items:t,onSelectItem:this.onQuotesGridSelectItem.bind(this),compare:function(t){return function(t,e){return this(t,e)||t.a_obj.localeCompare(e.a_obj)}.bind(this.base(t))}}),this.grid.find("tbody>tr:first-child").click()):this.quotesGrid&&this.quotesGrid.refresh(!0)},renderCharts:function(t,e){"about:blank"===this.charts[1].src?this.charts.eq(0).one("load",function(){this.charts.eq(1).attr("src","/platform/charts/index.html#"+e)}.bind(this)).attr("src","/platform/charts/index.html#"+t):(this.charts.eq(0).attr("src","/platform/charts/index.html#"+t),this.charts.eq(1).attr("src","/platform/charts/index.html#"+e))}});return n.init=function(){new e(new this({root:$(document),header:$("dl"),grid:$(".grid"),charts:$("iframe"),splitter:$(".flex-splitter")}))},n}),define("repositories/news",["repository_base"],function(t){return new(t.extend({getComplexNews:function(t){return $.send("/rpc",{so:"jso-ui-zhpnews.jar","function":"gw.sh.func.SearchHGTNewsRequest",paraencode:"base64",parameter:btoa(JSON.stringify({type:t||1,skip:0,amount:50}))})},getComplexNewsA:function(){return this.getComplexNews(3)},getComplexNewsH:function(){return this.getComplexNews(2)}}))}),define("presenters/complex",["presenter_base","../repositories/stock","../repositories/news"],function(t,e,i){return t.extend(function(){this.view.renderDefaultCharts()},{onInit:function(){$.when(e.getAStocks(),e.getHStocks(),i.getComplexNewsA(),i.getComplexNewsH()).then(function(){this.updateHGTLimit(),this.view.renderQuotesGrids([arguments[0],arguments[1]]),this.view.renderNewsGrids([arguments[2],arguments[3]])}.bind(this),function(){location.reload()}.bind(this))},updateHGTLimit:function(){e.getHGTLimit().then(function(t){this.view.renderHGTLimit(t[0]),setTimeout(this.updateHGTLimit.bind(this),6e4)}.bind(this))}})}),define("views/complex",["view_base","../presenters/complex","formatter","fast_grid","quotes_grid","tabs"],function(t,e,i,n,s){var r=t.extend(function(){this.tabs.on("active",this.onTabActive.bind(this))},{fastGrids:[],onTabActive:function(t,e){this.renderChart(this.tabs.index(t.target),$(t.target).children()[e].dataset.obj)},onGridSelectItem:function(t,e){this.fastGrids.forEach(function(t){t!==this&&(t.selectedItem=void 0,t.target.find("tr.active").removeClass("active"))},t),e.obj&&this.renderChart(2,e.obj)},renderQuotesGrids:function(t){t.forEach(function(t,e){this.fastGrids.push(new s(this.grids[e],{fields:"new,lastclose,volume,amount",columns:[{width:e?65:70,name:"代码",css:"blue c",sort:!0,value:function(t){return'<a href="dzh://VIEWSTOCK?DATATYPE=DAY&LAYOUT=Level2默认&PAGE=分时走势&LABEL='+t.obj+'">'+this.fixSymbol(t.obj)+"</a>"}},{width:e?110:80,name:"名称",css:"l",sort:!0,value:function(t){return'<a href="dzh://VIEWSTOCK?DATATYPE=DAY&LAYOUT=Level2默认&PAGE=分时走势&LABEL='+t.obj+'">'+t.name+"</a>"}},{width:"60",name:"最新",color:!0,sort:!0,value:function(t){return this.fixValue(this.fixLastTrade(t),e?3:2)}},{width:"60",name:"涨跌",color:!0,sort:!0,value:function(t){return this.fixValue(this.fixChange(t),e?3:2)}},{width:"60",name:"涨幅",color:!0,sort:!0,order:"desc",value:function(t){return this.fixFloat(this.fixChg(t),e?3:2)}},{width:"70",name:"总手",sort:function(t){return t.volume},value:function(t){return this.fixDigit(t.volume,1)}},{width:"70",name:"总额",sort:function(t){return t.amount},value:function(t){return this.fixDigit(t.amount,1)}}],items:t,onSelectItem:this.onGridSelectItem.bind(this),onDblClick:function(t){location.assign($(t.currentTarget).find("a").attr("href"))}}))},this)},renderNewsGrids:function(t){t.forEach(function(t,e){this.fastGrids.push(new n(this.grids[2+e],{columns:[{width:"auto",name:"标题",css:"white l",sort:!0,title:!0,value:function(t){return"<a href=\"dzh://navigate?'root://news/details/index.html#"+t.C1+"#DZHPOPUP(854,504)#'\">"+t.C3+"</a>"}},{width:"15%",name:"时间",css:"white",sort:!0,value:function(t){return this.fixTime(t.C6)}}],items:t,onSelectItem:this.onGridSelectItem.bind(this)}))},this)},renderChart:function(t,e){this.charts.eq(t).attr("src","/platform/charts/index.html#"+e)},renderDefaultCharts:function(){var t=this.tabs.find("li:first-child[data-obj]").toArray().map(function(t){return t.dataset.obj}).concat("SH600000.stk");this.charts.on("load",function(t){t.length?this.renderChart(t.length-1,t.pop()):this.charts.off("load")}.bind(this,t)),this.renderChart(t.length-1,t.pop())},renderHGTLimit:function(t){this.limits.eq(0).html("　当日余额: <em>"+t.c3+"亿</em> / <em>"+t.c7+"亿</em>　总余额: <em>"+t.c5+"亿</em>"),this.limits.eq(1).html("　当日余额: <em>"+t.c4+"亿</em> / <em>"+t.c8+"亿</em>　总余额: <em>"+t.c6+"亿</em>")},handleLoading:function(){this.base(arguments),this.renderChart=this.renderChart.origin}});return r.init=function(){new e(new this({root:$(document),grids:$(".grid"),charts:$("iframe.flex-auto"),tabs:$(".nav-tabs"),limits:$(".limit")}))},r}),require(["views/index","views/complex"],function(){require(["views/"+(location.pathname.match(/([^\/]+)\.html/)||[,"index"])[1]],function(){arguments[0]&&arguments[0].init&&arguments[0].init()})}),define("src",function(){});