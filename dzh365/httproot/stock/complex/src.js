define("repositories/stock",["repository_base"],function(e){return new(e.extend({markets:[{obj:"IXUDI.index",name:"美元指数"},{obj:"SCau0000.index",name:"沪金连续"},{obj:"NXCLY0.cmdty",name:"美原油连续"},{obj:"IXDJIA.index",name:"道琼斯工业"},{obj:"IXNDX.index",name:"纳斯达克综指"},{obj:"IXSPX.index",name:"标普500"},{obj:"IXGDAXI.index",name:"德国DAX指数"},{obj:"IXFTSE.index",name:"富时100"},{obj:"IXN225.index",name:"日经225"},{obj:"HIHSI.index",name:"恒生指数"},{obj:"FXXAUUSD.frx",name:"国际黄金现货"}],getRank:function(e){return $.send("/quote/ranking",{block:e,where:"ranking=updn_radio,updn_radio_r,updn_speed,updn_speed_r",response_times:arguments.length>1?arguments[1]:1},{before:function(e){return e&&e.datas.forEach(function(e){e[1].head=["obj","name","new","numeric","lastclose"]}),e},after:function(e){return e&&e.forEach(function(e){e.data.forEach(function(e){e.obj=e.obj+".stk"})}),e}})},getPlate:function(){return $.send("/rpc",{so:"jso-ui-hszhp.jar","function":"gw.sh.func.HszhpPlateCodeRequest"},{before:function(e){return e&&(e.datas[0][1].head=["type","obj","name"]),e},after:function(e){return[e.filter(function(e){return 1==e.type}),e.filter(function(e){return 2==e.type})]}})},getBlockInfo:function(e){return $.send({service:"blockinfo",type:e?"leaf":"sub",source:"local",block:e||"自选股",depth:1})}}))}),define("repositories/news",["repository_base"],function(e){return new(e.extend({getComplexNews:function(e){var t=[["gw.sh.func.CommonNewsQueryRequest","009000000","37019"],["gw.sh.func.SearchAllNewsRequest","009005","37014"],["gw.sh.func.CommonNewsQueryRequest","009004000","37014"],["gw.sh.func.CommonNewsQueryRequest","009002000","37019"]][e];return $.send("/rpc",{so:"jso-ui-112news.jar","function":t[0],paraencode:"base64",parameter:btoa(JSON.stringify({menuid:t[1],sourceflag:t[2],fids:"C1,C3,C6",dcategory:"1",skip:"0",amount:"50"}))})},getNews:function(){return $.send("/rpc",{so:"jso-ui-zhpnews.jar","function":"gw.sh.func.CompetitiveProductsNewsRequest",paraencode:"base64",parameter:btoa(JSON.stringify({fids:"C1,C3,C6",skip:"0",amount:"50"}))})}}))}),define("presenters/index",["presenter_base","../repositories/stock","../repositories/news"],function(e,t,n){return e.extend(function(){this.view.on("selectChange",this.onSelectChange.bind(this)),this.view.renderDefaultCharts()},{onInit:function(){$.when(t.getRank("上证A股"),t.getRank("深证A股"),t.getPlate(),t.getBlockInfo(),n.getNews()).then(function(){this.view.renderChart(2,arguments[0][0].data[0].obj),this.view.renderSHGrids(arguments[0]),this.view.renderSZGrids(arguments[1]),this.view.renderPlateGrids(arguments[2]),arguments[3].shift(),this.view.renderSelect(arguments[3]),this.onSelectChange("自选股"),this.view.renderNewsGrid(arguments[4]),this.view.renderMarketGrid(t.markets),setTimeout(function(){t.getRank("上证A股",-1).progress(this.renderSHGrids.bind(this)),t.getRank("深证A股",-1).progress(this.renderSZGrids.bind(this))}.bind(this.view),1e3)}.bind(this))},onSelectChange:function(e){this.blockPromise&&this.blockPromise.cancel(),this.blockPromise=t.getBlockInfo(e).then(function(e){this.view.renderOptionalGrid(e.map(function(e){return{obj:e.stockid}}))}.bind(this))},onNewsTabActive:function(e){this.view.renderNewsGrid([]),this.newsPromise&&this.newsPromise.cancel(),this.newsPromise=n.getComplexNews(e).then(this.view.renderNewsGrid.bind(this.view))}})}),define("views/index",["view_base","../presenters/index","formatter","fast_grid","active_grid","quotes_grid","tabs","select"],function(e,t,n,i,r,s){var o=e.extend(function(){this.tabs.on("active",this.onTabActive.bind(this))},{onTabActive:function(e,t){var n=$(e.target).children()[t].dataset;n.obj?this.renderChart(this.tabs.index(e.target),n.obj):n.link&&($(e.target).next("a").attr("href",n.link),this.emit("newsTabActive",t))},onGridSelectItem:function(e,t){this.fastGrids.forEach(function(e){e!==this&&(e.selectedItem=void 0,e.target.find("tr.active").removeClass("active"))},e),t.obj&&this.renderChart(2,t.obj)},handleLoading:function(){this.base(arguments),this.renderChart.origin&&(this.renderChart=this.renderChart.origin)},renderChart:function(e,t){this.charts.eq(e).attr("src","/platform/charts/index.html#"+t)},renderDefaultCharts:function(){var e=this.tabs.find("li:first-child[data-obj]").toArray().map(function(e){return e.dataset.obj}).concat("");this.charts.on("load",function(e){e.length?this.renderChart(e.length-1,e.pop()):this.charts.off("load")}.bind(this,e)),this.renderChart(e.length-1,e.pop())},renderSHGrids:function(e){e.forEach(function(e){this.renderStocksGrid("sh_grid_"+e.ranking,e.data)},this)},renderSZGrids:function(e){e.forEach(function(e){this.renderStocksGrid("sz_grid_"+e.ranking,e.data)},this)},renderStocksGrid:function(e,t){var n=$("#"+e),i=n.widget();t.length>5&&(t.length=5),i?(i.items=t,t.forEach(function(e,t){e&&e.obj===t.obj&&(this.selectedItem=t)}.bind(i,i.selectedItem)),i.refresh(!0)):this.fastGrids.push(new r(n[0],{columns:[{width:60,name:"名称",css:"l",sort:!0,value:function(e){return'<a href="dzh://VIEWSTOCK?DATATYPE=DAY&LAYOUT=Level2默认&PAGE=分时走势&LABEL='+e.obj+'">'+e.name+"</a>"}},{width:40,name:"最新",color:function(e){return this.fixColor(e.numeric,6)},sort:!0,value:function(e){return this.fixValue(this.fixLastTrade(e))}},{width:50,name:"涨幅",color:function(e){return this.fixColor(e.numeric,6)},sort:!0,value:function(e){return this.fixPercent(100*e.numeric)}}],items:t,onSelectItem:this.onGridSelectItem.bind(this),onDblClick:function(e){location.assign($(e.currentTarget).find("a").attr("href"))}}))},renderPlateGrids:function(e){e.forEach(function(e,t){this.fastGrids.push(new s(this.grids[t+8],{columns:[{width:60,name:"名称",css:"l",sort:!0,value:function(e){return'<a href="dzh://VIEWSTOCK?DATATYPE=DAY&LAYOUT=Level2默认&PAGE=分时走势&LABEL='+e.obj+'">'+e.name+"</a>"}},{width:58,name:"最新",color:!0,sort:!0,title:!0,value:function(e){return this.fixValue(this.fixLastTrade(e))}},{width:48,name:"涨幅",color:!0,sort:!0,order:"desc",value:function(e){return this.fixPercent(this.fixChg(e))}}],items:e,onSelectItem:this.onGridSelectItem.bind(this),onDblClick:function(e){location.assign($(e.currentTarget).find("a").attr("href"))}}))},this)},renderSelect:function(e){this.select.html(e.map(function(e){return"<option>"+e.blockname+"</option>"}).join("")).widget().refresh()},renderOptionalGrid:function(e){var t=this.grids[10].widget;t?(t.selectedItem=void 0,t.setItems(e)):this.fastGrids.push(new s(this.grids[10],{fields:"new,lastclose,name",columns:[{width:"17%",name:"代码",css:"blue c",sort:!0,value:function(e){return'<a href="dzh://VIEWSTOCK?DATATYPE=DAY&LAYOUT=Level2默认&PAGE=分时走势&LABEL='+e.obj+'">'+this.fixSymbol(e.obj)+"</a>"}},{width:"auto",name:"名称",title:!0,css:"white l",sort:!0,value:function(e){return'<a href="dzh://VIEWSTOCK?DATATYPE=DAY&LAYOUT=Level2默认&PAGE=分时走势&LABEL='+e.obj+'">'+(e.name||"－").replace("--","－")+"</a>"}},{width:"23%",name:"最新",color:function(e){return this.fixColor(this.fixChange(e),this.fixDecimals(e))},sort:!0,value:function(e){return this.fixFloat(this.fixLastTrade(e),this.fixDecimals(e))}},{width:"18%",name:"涨跌",color:function(e){return this.fixColor(this.fixChange(e),this.fixDecimals(e))},sort:!0,value:function(e){return this.fixFloat(this.fixChange(e),this.fixDecimals(e))}},{width:"19%",name:"涨幅",color:function(e){return this.fixColor(this.fixChange(e),this.fixDecimals(e))},sort:!0,value:function(e){return this.fixPercent(this.fixChg(e))}}],items:e,onSelectItem:this.onGridSelectItem.bind(this),onDblClick:function(e){location.assign($(e.currentTarget).find("a").attr("href"))},fixDecimals:function(e){switch(e.obj.split(".")[1]){case"fnd":return 3;default:return 2}}}))},renderNewsGrid:function(e){var t=this.grids[11].widget;t?(t.selectedItem=void 0,t.setItems(e)):this.fastGrids.push(new i(this.grids[11],{columns:[{width:"auto",name:"标题",css:"white l",sort:!0,title:!0,value:function(e){return"<a href=\"dzh://navigate?'root://news/details/index.html#"+e.C1+"#DZHPOPUP(854,504)#'\">"+e.C3+"</a>"}},{width:"15%",name:"时间",css:"white",sort:!0,value:function(e){return this.fixTime(e.C6)}}],items:e,onSelectItem:this.onGridSelectItem.bind(this)}))},renderMarketGrid:function(e){this.fastGrids.push(new s(this.grids[this.grids.length-1],{fields:"new,lastclose,time",columns:[{width:"auto",name:"名称",title:!0,css:"white l",sort:!0,value:function(e){return'<a href="dzh://VIEWSTOCK?DATATYPE=DAY&LAYOUT=Level2默认&PAGE=分时走势&LABEL='+e.obj+'">'+e.name+"</a>"}},{width:"23%",name:"最新",color:!0,sort:!0,value:function(e){return this.fixFloat(this.fixLastTrade(e))}},{width:"18%",name:"涨跌",color:!0,sort:!0,value:function(e){return this.fixFloat(this.fixChange(e))}},{width:"19%",name:"涨幅",color:!0,sort:!0,value:function(e){return this.fixPercent(this.fixChg(e))}},{width:"17%",name:"时间",css:"white",sort:!0,value:function(e){return this.fixTime(e.time)}}],items:e,onSelectItem:this.onGridSelectItem.bind(this),onDblClick:function(e){location.assign($(e.currentTarget).find("a").attr("href"))}}))}});return o.init=function(){new t(new this({root:$(document),grids:$(".grid"),charts:$("iframe.flex-auto"),tabs:$(".nav-tabs"),select:$("select"),fastGrids:[]}))},o}),require(["views/index"],function(){require(["views/"+(location.pathname.match(/([^\/]+)\.html/)||[,"index"])[1]],function(){arguments[0]&&arguments[0].init&&arguments[0].init()})}),define("src",function(){});