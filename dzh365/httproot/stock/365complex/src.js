define("repositories/stock",["repository_base"],function(e){return new(e.extend({markets:[{obj:"SH000001.index",name:"上证指数"},{obj:"SZ399006.index",name:"创业板指"},{obj:"SZ399001.index",name:"深证成指"},{obj:"SH000300.index",name:"沪深300"},{obj:"SH000016.index",name:"上证50"},{obj:"SZ399005.index",name:"中小板指"},{obj:"SFIF0001.cmdty",name:"沪深300期指"},{obj:"HIHSI.index",name:"恒生指数"},{obj:"IXN225.index",name:"日经225"},{obj:"IXSPX.index",name:"标普500"},{obj:"IXDJIA.index",name:"道琼斯工业"},{obj:"IXNDX.index",name:"纳斯达克综合"},{obj:"IXKS11.index",name:"韩国KOSPI"},{obj:"IXSENSEX.index",name:"印度SENSEX30"},{obj:"IXFTSE.index",name:"英国富时100"},{obj:"IXGDAXI.index",name:"德国DAX30"},{obj:"IXFCHI.index",name:"法国CAC40"},{obj:"IXUDI.index",name:"美元指数"},{obj:"FXXAUUSD.frx",name:"黄金现货/美元"},{obj:"IPBY0.cmdty",name:"布伦特原油连续"}],getBlockInfo:function(e){return $.send({service:"blockinfo",type:e?"leaf":"sub",source:"local",block:e||"自选股",depth:1})}}))}),define("repositories/news",["repository_base"],function(e){return new(e.extend({getComplexNews:function(){return $.send("/rpc",{so:"jso-ui-zhpnews.jar","function":"gw.sh.func.CompetitiveProductsNewsRequest",paraencode:"base64",parameter:btoa(JSON.stringify({fids:"C1,C3,C6",skip:"0",amount:"50"}))})}}))}),define("presenters/index",["presenter_base","../repositories/stock","../repositories/news"],function(e,t,i){return e.extend(function(){this.view.on("selectChange",this.onSelectChange.bind(this)),this.view.dropDownTabs.$on("active",this.onTabsItemClick.bind(this))},{onInit:function(){this.view.dropDownTabs.setItems(t.markets),t.getBlockInfo().then(function(e){e.shift(),this.view.renderSelect(e),this.onSelectChange("自选股"),this.view.renderView()}.bind(this)),i.getComplexNews().then(function(e){this.view.renderNewsGrid(e)}.bind(this)),$.ajax({url:"http://rdfile.gw.com.cn/dataconver/frontPage.jsonp",dataType:"jsonp",jsonpCallback:"jsonpCallback"}).then(function(e){this.view.eventPane.render(e)}.bind(this))},onSelectChange:function(e){this.blockPromise&&this.blockPromise.cancel(),this.blockPromise=t.getBlockInfo(e).then(function(e){this.view.renderOptionalGrid(e.map(function(e){return{obj:e.stockid}}))}.bind(this))},onTabsItemClick:function(e){this.view.renderChart(0,e.obj)}})}),define("views/index",["view_base","../presenters/index","vue","fast_grid","quotes_grid","select"],function(e,t,i,n,s){var r=e.extend(function(){this.dropDownTabs.$mount(".drop-down-tabs"),this.eventPane.$mount(".event"),this.renderCharts()},{handleLoading:function(){},onGridSelectItem:function(e,t){this.fastGrids.forEach(function(e){e!==this&&(e.selectedItem=void 0,e.target.find("tr.active").removeClass("active"))},e),t.obj&&this.renderChart(1,t.obj)},renderView:function(){this.chartsPromise.then(function(){$("body").removeClass("loading")})},renderSelect:function(e){this.select.html(e.map(function(e){return"<option>"+e.blockname+"</option>"}).join("")).widget().refresh()},renderOptionalGrid:function(e){var t=0,i=this.grids[t].widget;this.empty[e.length?"hide":"show"](),i?(i.selectedItem=void 0,i.setItems(e)):(this.fastGrids.push(new s(this.grids[0],{fields:"new,lastclose,name,volume",columns:[{width:"17%",name:"代码",css:"blue c",sort:!0,value:function(e){return'<a href="dzh://VIEWSTOCK?DATATYPE=DAY&LAYOUT=Level2默认&PAGE=分时走势&LABEL='+e.obj+'">'+this.fixSymbol(e.obj)+"</a>"}},{width:"auto",name:"名称",title:!0,css:"white l",sort:!0,value:function(e){return'<a href="dzh://VIEWSTOCK?DATATYPE=DAY&LAYOUT=Level2默认&PAGE=分时走势&LABEL='+e.obj+'">'+(e.name||"－").replace("--","－")+"</a>"}},{width:"23%",name:"最新",color:function(e){return this.fixColor(this.fixChange(e),this.fixDecimals(e))},sort:!0,value:function(e){return this.fixFloat(this.fixLastTrade(e),this.fixDecimals(e))}},{width:"19%",name:"涨幅",color:function(e){return this.fixColor(this.fixChange(e),this.fixDecimals(e))},sort:!0,value:function(e){return this.fixPercent(this.fixChg(e))}},{width:"18%",name:"成交量",css:"white",sort:function(e){return e.volume},value:function(e){return e.volume?this.fixDigit(e.volume,0)+"手":"－"}}],items:e,onSelectItem:this.onGridSelectItem.bind(this),onDblClick:function(e){location.assign($(e.currentTarget).find("a").attr("href"))},fixDecimals:function(e){switch(e.obj.split(".")[1]){case"fnd":return 3;default:return 2}}})),this.renderChart(1,e.length?e[0].obj:"SH000001.index"))},renderChart:function(e,t){var i=this.charts.eq(e),n="/platform/charts/index.html";t?this.chartsPromise.then(function(e){this.attr("src",e)}.bind(i,n+"#"+t)):i.attr("src",n)},renderCharts:function(){var e=0;this.chartsPromise=$.Deferred(),this.charts.on("load",function(){e<this.charts.length?this.renderChart(e++):(this.charts.off("load"),this.chartsPromise.resolve(!0))}.bind(this)),this.renderChart(e++)},renderNewsGrid:function(e){var t=1,i=this.grids[t].widget;i?(i.selectedItem=void 0,i.setItems(e)):this.fastGrids.push(new n(this.grids[t],{columns:[{width:"auto",name:"标题",css:"white l",sort:!0,title:!0,value:function(e){return"<a href=\"dzh://navigate?'root://news/details/index.html#"+e.C1+"#DZHPOPUP(854,504)#'\">"+e.C3+"</a>"}},{width:"15%",name:"时间",css:"white",sort:!0,value:function(e){return this.fixTime(e.C6)}}],items:e,onSelectItem:this.onGridSelectItem.bind(this)}))}});return r.init=function(){new t(new this({root:$(document),select:$("select"),grids:$(".grid"),charts:$("iframe.flex-auto"),empty:$(".empty"),fastGrids:[],dropDownTabs:new i({created:function(){this.__resize=this.__resize.bind(this)},attached:function(){addEventListener("resize",this.__resize)},detached:function(){removeEventListener("resize",this.__resize)},data:{items:[],active:null,start:0},computed:{dropDownItems:function(){return this.items.slice(this.start)}},methods:{__click:function(e){this.active=e,this.$emit("active",e)},__resize:function(){for(var e=$(this.$el).find(">ul>li").toArray(),t=0,i=1,n=e.length;n>i;i++)if(e[i].offsetTop!==e[i-1].offsetTop){t=i;break}this.start=t},setItems:function(){var e=this.items;e.splice.apply(e,[0,e.length].concat(arguments[0])),i.nextTick(function(){this.__click(this.items[0]),this.__resize()}.bind(this))},clear:function(){this.setItems()}}}),eventPane:new i({data:{src:"about:blank",link:"javascript:;",isImg:null},methods:{render:function(e){this.src=e.advImageUrl,this.link=e.advLinkUrl,this.isImg=!/\.swf$/.test(this.src)}}})}))},r}),require(["views/index"],function(){require(["views/"+(location.pathname.match(/([^\/]+)\.html/)||[,"index"])[1]],function(){arguments[0]&&arguments[0].init&&arguments[0].init()})}),define("src",function(){});