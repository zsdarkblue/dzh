//>>built
define("stock/MicroStrategy/resources/linkPage/createMicroUtil","dijit/registry,dojo/_base/config,dojo/date/locale,dojo/dom,dojo/request/xhr,dojox/store/GridSOStore,dojox/slickgrid/slickgrid,dojo/io-query,dojo/date,dojo/dom-attr".split(","),function(i,g,j,p,q,k,l,m,n,o){var d={getDateStr:function(){var a=new Date;return a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate()},getUserInfo:function(){var a=new l({store:new k,queryLimit:{}},""),c={userId:g.dzhUserId,randNum:Math.random()};a.renderQuery({service:"rpc",
so:"javadataproxy.jar","function":"gw/UIMain",paraencode:"base64",parameter:"Z2V0,"+btoa(g.dzhURL+"/MicroStrategyBG/createMicro/getUserTypAndOrg?"+m.objectToQuery(c)),response_times:1,response_mode:0}).then(function(a){var e=[];if(0<a.getLength()){a.getItem(0);var b=a.getItem(0)[1],c=a.getItem(0)[2],a=a.getItem(0)[3];"null"!=b&&""!=b.replace(/^\s\s*/,"")&&(dijit.byId("budManName").set("value",b),dijit.byId("budManName").set("readOnly",!0));"null"!=c&&""!=c.replace(/^\s\s*/,"")?("\u666e\u901a\u7528\u6237"==
c?e.push({label:c,value:"2"}):"\u5206\u6790\u5e08"==c?e.push({label:c,value:"1"}):"\u6295\u8d44\u987e\u95ee"==c&&e.push({label:c,value:"3"}),i.byId("userTypSelect").addOption(e),dijit.byId("userTypSelect").set("readOnly",!0)):(e=[{label:"\u8bf7\u9009\u62e9\u7528\u6237\u7c7b\u578b",value:""},{label:"\u666e\u901a\u7528\u6237",value:2},{label:"\u5206\u6790\u5e08",value:1},{label:"\u6295\u8d44\u987e\u95ee",value:3}],i.byId("userTypSelect").addOption(e));"null"!=a&&""!=a.replace(/^\s\s*/,"")&&(dijit.byId("userOrg").set("value",
a),dijit.byId("userOrg").set("title",a),dijit.byId("userOrg").set("readOnly",!0))}else e=[{label:"\u8bf7\u9009\u62e9\u7528\u6237\u7c7b\u578b",value:""},{label:"\u666e\u901a\u7528\u6237",value:2},{label:"\u5206\u6790\u5e08",value:1},{label:"\u6295\u8d44\u987e\u95ee",value:3}],i.byId("userTypSelect").addOption(e)})},setValues:function(){this.getUserInfo();dojo.byId("textfield").value="\u6b64\u529f\u80fd\u6682\u672a\u5f00\u653e";dojo.byId("textfield002").value="\u6b64\u529f\u80fd\u6682\u672a\u5f00\u653e";
i.byId("microTypSelect").addOption([{label:"\u8bf7\u9009\u62e9\u7b56\u7565\u5206\u7c7b",value:""},{label:"\u6307\u6570\u8ddf\u8e2aT51",value:"T51"},{label:"\u4e8b\u4ef6\u9a71\u52a8T52",value:"T52"},{label:"\u6280\u672f\u6307\u6570T53",value:"T53"},{label:"\u7a33\u5065\u6536\u76caT53",value:"T54"},{label:"\u4e8b\u4ef6\u9a71\u52a8T55",value:"T55"}]);i.byId("microStyleSelect").addOption([{label:"\u7a33\u5065",value:"1"},{label:"\u6fc0\u8fdb",value:"2"},{label:"\u8fdb\u53d6",value:"3"},{label:"\u4fdd\u5b88",
value:"4"}]);dojo.byId("buldTimeDiv").value=this.getDateStr();for(var a=dojo.query(".rxsj"),c=0;c<a.length;c++)dijit.registry.byNode(a[c]).set("value",this.getDateStr());o.set(dijit.byId("DateTextBox_end").focusNode,"disabled",!0)},checkValues:function(){if(!g.dzhUserId||""==g.dzhUserId)return"\u83b7\u53d6\u7528\u6237ID\u5931\u8d25,\u8bf7\u91cd\u65b0\u6253\u5f00\u6b64\u9875\u9762";if(!dijit.byId("budManName").get("value")||""==dijit.byId("budManName").get("value"))return"\u521b\u5efa\u4eba\u59d3\u540d\u4e0d\u80fd\u4e3a\u7a7a";
if(!(1<=dijit.byId("userTypSelect").get("value")&&3>=dijit.byId("userTypSelect").get("value")))return"\u8bf7\u9009\u62e9\u7528\u6237\u7c7b\u578b";if(!dijit.byId("userOrg").get("value")||""==dijit.byId("userOrg").get("value"))return"\u6240\u5c5e\u673a\u6784\u4e0d\u80fd\u4e3a\u7a7a";if(!dijit.byId("microTypSelect").get("value")||""==dijit.byId("microTypSelect").get("value"))return"\u8bf7\u9009\u62e9\u7b56\u7565\u5206\u7c7b";if(!dijit.byId("strategyName").get("value")||3>dijit.byId("strategyName").get("value").length||
10<dijit.byId("strategyName").get("value").length)return"\u7b56\u7565\u540d\u79f0\u53ea\u80fd\u4e3a3-10\u4e2a\u5b57\u7b26";if(!dijit.byId("description").get("value")||""==dijit.byId("description").get("value"))return"\u7b56\u7565\u8bf4\u660e\u4e0d\u80fd\u4e3a\u7a7a!";for(var a=0,c=!1,d=1;5>=d;d++){var e=dojo.query(".stk"+d);if(e&&e.length&&0<e.length){for(var c=!0,b={},f=0;f<e.length;f++){var h=dijit.registry.byNode(e[f]);b[h.get("name")]=h.get("value")}if(!b.stockCode||0>=b.stockCode.length)return"\u6210\u5206\u80a1\u7684\u80a1\u7968\u4ee3\u7801\u4e0d\u80fd\u4e3a\u7a7a";
if(!b.stockName||0>=b.stockName.length)return"\u6210\u5206\u80a1\u7684\u80a1\u7968\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a";if(!b.buyingPrice||!b.buyingPrice.length||0>=b.buyingPrice.length)return"\u6210\u5206\u80a1\u4e70\u5165\u4ef7\u4e0d\u80fd\u4e3a\u7a7a";if("\u5f53\u65e5\u6536\u76d8\u4ef7"!=b.buyingPrice&&"\u6b21\u65e5\u5f00\u76d8\u4ef7"!=b.buyingPrice&&"\u6b21\u65e5\u6536\u76d8\u4ef7"!=b.buyingPrice&&!(0<b.buyingPrice))return"\u624b\u5de5\u8f93\u5165\u7684\u6210\u5206\u80a1\u4e70\u5165\u4ef7\u5fc5\u987b\u5927\u4e8e0";
if(!b.weight||!(0<b.weight.length))return"\u6210\u5206\u80a1\u6743\u91cd\u4e0d\u80fd\u5c0f\u4e8e0";a+=1*b.weight;if(b.zytj&&b.zytj.length&&0<b.zytj.length&&!(0<b.zytj))return"\u6210\u5206\u80a1\u6b62\u76c8\u6761\u4ef6\u5fc5\u987b\u5927\u4e8e0";if(b.zstj&&b.zstj.length&&0<b.zstj.length&&!(0<b.zstj))return"\u6210\u5206\u80a1\u6b62\u635f\u6761\u4ef6\u5fc5\u987b\u5927\u4e8e0";if(!b.chosenReasons||0>=b.chosenReasons.length)return"\u6210\u5206\u80a1\u5165\u9009\u7406\u7531\u4e0d\u80fd\u4e3a\u7a7a"}}return!c?
"\u5fae\u7b56\u7565\u5fc5\u987b\u542b\u6709\u81f3\u5c11\u4e00\u652f\u6210\u5206\u80a1":100<a||0>=a?"\u6210\u5206\u80a1\u6743\u91cd\u603b\u548c\u987b\u57280~100%\u4e4b\u95f4":""},addButEvt:function(){this.addDeleteStkRowEvt();this.submitButEvt();this.cancelButEvt();this.getStkName();this.microStrategyInputOnClick();this.closeDialog();dojo.query(".txtGray").style("background","rgb(230, 230, 230)");dojo.connect(dijit.registry.byId("DateTextBox_end"),"onChange",function(){var a=dijit.registry.byId("DateTextBox_start").value,
c=dijit.registry.byId("DateTextBox_end").value;if(1==n.compare(a,c))alert("\u7ed3\u675f\u65e5\u671f\u5fc5\u987b\u5927\u4e8e\u8d77\u59cb\u65e5\u671f"),a=(new Date(a)).getTime()+864E5,a=new Date(a),dojo.byId("DateTextBox_end").value=j.format(a,{selector:"date",datePattern:"yyyy/M/d"})});dojo.connect(dijit.registry.byId("userTypSelect"),"onChange",function(){2==dijit.registry.byId("userTypSelect").value?(dojo.byId("userOrg").value="\u666e\u901a\u6295\u8d44\u8005",dojo.byId("userOrg").readOnly=!0):(dojo.byId("userOrg").value=
"",dojo.byId("userOrg").readOnly=!1)});dojo.connect(dojo.byId("yongjiuyouxiao"),"onclick",function(){if("true"==dojo.byId("yongjiuyouxiao").attributes[8].value)dojo.byId("DateTextBox_end").value="",dijit.byId("DateTextBox_end").set("readOnly",!0);else{var a=dijit.registry.byId("DateTextBox_start").value,a=(new Date(a)).getTime()+864E5,a=new Date(a);dojo.byId("DateTextBox_end").value=j.format(a,{selector:"date",datePattern:"yyyy/M/d"});dijit.byId("DateTextBox_end").set("readOnly",!1)}})}};d.closeDialog=
function(){dijit.registry.byId("dialog_2");dojo.connect(dijit.registry.byId("dialog_2"),"hide",function(){d.closeBrowser()})};d.microStrategyInputOnClick=function(){};d.getStkName=function(){for(var a=dojo.query(".stkCodeKeyBoard"),c=0;c<a.length;c++){var d=dijit.registry.getEnclosingWidget(a[c]);dojo.connect(d,"onChange",function(){this.get("value");var a=this.get("id")+"Name";this.get("item")&&this.get("item").name?dijit.registry.byId(a).set("value",this.get("item").name):dijit.registry.byId(a).set("value",
"")})}};d.submitButEvt=function(){dojo.connect(dojo.byId("subBut"),"click",function(){var a=d.checkValues();if(a.length&&0<a.length)alert(a);else{var a=new l({store:new k,queryLimit:{}},""),c={subInfo:encodeURI(d.getJsonDatas()),randNum:Math.random()};a.renderQuery({service:"rpc",so:"javadataproxy.jar","function":"gw/UIMain",paraencode:"base64",parameter:"Z2V0,"+btoa(g.dzhURL+"/MicroStrategyBG/createMicro/create?"+m.objectToQuery(c)),response_times:1,response_mode:0}).then(function(){dijit.registry.byId("dialog_2").show()})}})};
d.getJsonDatas=function(){var a=dojo.query(".microStrategyInput"),c={};c.authorId=g.dzhUserId;for(var d=0;d<a.length;d++){var e=dijit.registry.byNode(a[d]),b=e.get("name");"affectStartDate"==b||"affectEndDate"==b?c[b]=j.format(e.get("value"),{selector:"date",datePattern:"yyyy-MM-dd HH:mm:ss"}):"createDate"==b?(e.get("value"),c[b]=j.format(new Date,{selector:"date",datePattern:"yyyy-MM-dd HH:mm:ss"})):c[e.get("name")]=e.get("value")}c.stockList=[];for(d=1;5>=d;d++)if((a=dojo.query(".stk"+d))&&a.length&&
0<a.length){for(var f={},h=0;h<a.length;h++)e=dijit.registry.byNode(a[h]),b=e.get("name"),"selectedTime"==b?(e.get("value"),f[b]=j.format(new Date,{selector:"date",datePattern:"yyyy-MM-dd HH:mm:ss"})):f[b]=e.get("value");f.stockCode&&0<f.stockCode.length&&c.stockList.push(f)}return JSON.stringify(c)};d.addDeleteStkRowEvt=function(){dojo.query(".deleteBut").connect("onclick",function(){var a="";if(dojo.byId("rmBut5Div"))a="rmBut5Div";else if(dojo.byId("rmBut4Div"))a="rmBut4Div";else if(dojo.byId("rmBut3Div"))a=
"rmBut3Div";else if(dojo.byId("rmBut2Div"))a="rmBut2Div";else return;dijit.registry.byNode(dojo.byId(a)).destroy()})};d.cancelButEvt=function(){dojo.connect(dojo.byId("cancleBut"),"onclick",function(){d.closeBrowser()})};d.closeBrowser=function(){window.external&&window.external.closeDialog?window.external.closeDialog():(window.opener=null,window.open("","_self"),window.close())};return d});