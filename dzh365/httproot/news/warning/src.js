define("views/_base",["_base","observable","jquery","_widget","datetime","filter","select"],function(t,e,i,n){return t.extend([e],function(t){i.extend(this,t),this.root.on("click","[data-bind$=Click]",this.handleEvent.bind(this)),this.root.on("change","[data-bind$=Change]",this.handleEvent.bind(this)),setTimeout(function(){"function"==typeof this.init&&this.init(t),this.emit("init")}.bind(this),0)},{handleEvent:function(t){var e=t.currentTarget.dataset.bind;e in this&&"function"==typeof this[e]&&this[e](t),this.emit(e.replace(/^on\w/,function(t){return t.slice(-1).toLowerCase()}),t.currentTarget.value||t.currentTarget.dataset)},handleLoading:function(){if(i("body").hasClass("loading"))for(var t in this)if(0===t.indexOf("render")&&"function"==typeof this[t]&&this[t].length){var e=function(){for(var t in this)if("function"==typeof this[t]&&this[t].origin){var e=this[t];this[t]=e.origin,e.origin=void 0}this[arguments.callee.key].apply(this,arguments),i("body").removeClass("loading")};e.key=t,e.origin=this[t],this[t]=e}},destroy:function(){for(var t in this)"object"==typeof this[t]&&(this[t]instanceof i&&this[t].off(),this[t]instanceof n&&this[t].destroy())}})}),define("repositories/rindex.js",["repository_base"],function(t){return t.extend({getData:function(t){return console.log("rindex.getData"),$.send("/rpc",{so:"jso-ui-negativenews.jar","function":"gw.sh.func.WarningStockNewsRequest",paraencode:"base64",parameter:(external.base64encode||btoa)(t)},{after:function(t){return t&&t[0].length&&t[0].forEach(function(t){if(t.CO_t){var e=t.CO_t.split(","),i=t.SName_t.split(",");t.stocks=[],t.obj=e[0],t.name=i[0];for(var n=0,s=e.length;s>n;n++)t.stocks.push({obj:e[n],name:i[n]})}}),t}})},getZXGcode:function(){return $.send({service:"blockinfo",type:"leaf",source:"local",block:"自选股",depth:"-1",response_times:1,response_mode:0,cache_timeout:0})},getSecurities:function(t){return $.send("/keyspirit/search",{key:encodeURI(t),f:0,e:"NN1",__encoding:"gbk",l:10})}})}),define("view_models/pager",{data:{index:1,input:1,take:50,size:7,count:1,items:[]},methods:{onClick:function(t){"A"===t.target.tagName&&this.go(Number(t.target.innerText)||Number(t.target.dataset.index))},onChange:function(t){this.go(Number(t.target.value))},go:function(t){var e=this.count;return 1>t?t=e:t>e&&(t=1),this.index=t,this.input=t,this.refresh(e),this.$emit("change",this.$data),this},prev:function(){return this.go(this.index-1)},next:function(){return this.go(this.index+1)},refresh:function(t){var e=this.index,i=this.size,n=Math.floor(i/2)-1,s=e-n,r=e+n;n>s&&(s=2,r=s+i-3,r>t-1&&(r=t-1)),n>t-r&&(r=t-1,s=r-i+3,2>s&&(s=2)),this.count=t,this.items.splice(0,this.items.length);for(var a=s;r>=a;a++)this.items.push(a)}}}),define("presenters/pindex",["presenter_base","../repositories/rindex.js","../view_models/pager","vue"],function(t,e,i,n){return t.extend(function(){this.zxgCodes="",this.wStock=new e,this.pager=new n(i),this.parmeter={pageSize:this.pager.take},this.view.on("filterInput",this.onFilterInput.bind(this)),this.pager.$on("change",this.onPagerChange.bind(this)),this.view.on("changeParmeter",this.onChangeParmeter.bind(this)),this.view.on("allDataBtnClick",this.onAllDataBtnClick.bind(this)),this.view.on("zXGDataBtnClick",this.onZXGDataBtnClick.bind(this)),"#zxg"==location.hash?(this.getZXGCodes().then(function(){if(""!=this.zxgCodes){this.parmeter={},this.parmeter.pageNum=0,this.parmeter.pageSize=this.pager.take,this.parmeter.stock=this.zxgCodes;var t=this.jsonToString(this.parmeter);this.getGridData(t).then(function(){this.view.render(this.pager)}.bind(this))}else this.view.renderGrid([])}.bind(this)),$("header a").removeClass("selected"),$("header a:eq(1)").addClass("selected")):(this.getGridData("{}").then(function(){this.view.render(this.pager)}.bind(this)),$("header a").removeClass("selected"),$("header a:eq(0)").addClass("selected"))},{jsonToString:function(t){var e="{";for(oname in t)e+='"'+oname+'":"'+t[oname]+'",';return e=e.substr(0,e.length-1)+"}"},getGridData:function(t){return this.view.renderGrid([]),this.wStock.getData(t).then(function(t){this.view.renderGrid(t[0]),this.pager.refresh(Math.ceil(parseInt(t[1][0].Total)/50)||1)}.bind(this))},getZXGCodes:function(){return this.wStock.getZXGcode().then(function(t){for(var e="",i=0,n=t.length;n>i;i++)t[i].stockid&&-1!=t[i].stockid.indexOf(".stk")&&(e+=t[i].stockid+",");""!=e&&(e=e.substr(0,e.length-1)),this.zxgCodes=e}.bind(this))},onPagerChange:function(){this.detailsPromise&&this.detailsPromise.cancel(),this.parmeter.pageNum=this.pager.take*(this.pager.index-1);var t=this.jsonToString(this.parmeter);this.getGridData(t)},onFilterInput:function(t){this.wStock.getSecurities(t).then(function(t){for(var e=[],i=0,n=t.length;n>i;i++)e.push({id:t[i]["bond"===this.type?"trcode":"obj"],name:t[i].obj.replace(/\..+$/,"　")+t[i].disp});this.view.renderFilterResults(e)}.bind(this))},onChangeParmeter:function(t){this.parmeter={pageNum:0,pageSize:this.pager.take},t.code&&(this.parmeter.stock=t.code),t.titleKey&&(this.parmeter.key=t.titleKey);var e=this.jsonToString(this.parmeter);this.getGridData(e)},onAllDataBtnClick:function(){this.parmeter={pageNum:0,pageSize:this.pager.take};var t=this.jsonToString(this.parmeter);this.getGridData(t),$("header a").removeClass("selected"),$("header a:eq(0)").addClass("selected")},onZXGDataBtnClick:function(){this.parmeter={pageNum:0,pageSize:this.pager.take},this.getZXGCodes().then(function(){this.parmeter.stock=this.zxgCodes;var t=this.jsonToString(this.parmeter);this.getGridData(t).then(function(){this.view.render(this.pager)}.bind(this))}.bind(this)),$("header a").removeClass("selected"),$("header a:eq(1)").addClass("selected")}})}),define("views/vindex",["./_base","../presenters/pindex","quotes_grid"],function(t,e,i){var n=t.extend(function(){this.root.on("init","input[type=search]",this.onFilterInit.bind(this)),this.root.on("mouseenter",".flex-auto td:nth-of-type(2)",this.onCellMouseEnter.bind(this)),$("input[name=titleKey]").bind("keyup",function(t){13===t.which&&$("a[data-bind=onSearchBtnClick]").click()})},{render:function(t){t.$mount(this.pagerDiv[0])},onCellMouseEnter:function(t){var e=this.mainGrid.getItem(t.currentTarget.parentNode.dataset.index);if(e&&e.stocks.length>1){var n=$(t.currentTarget),s=n.offset(),r=n.height(),a=this.tips.outerHeight(),o=this.root.height();s.top+=r,s.left+=14,s.top+a>o&&(s.top-=a+r),this.tipGrid=this.tipGrid||new i(this.grids[1],{columns:[{width:"100",name:"代码",css:"blue l",value:function(t){return'<a href="dzh://VIEWSTOCK?DATATYPE=DAY&LAYOUT=Level2默认&PAGE=分时走势&LABEL='+t.obj+'">'+t.obj+"</a>"}},{width:"75",name:"名称",title:!0,css:"l",value:function(t){return'<a href="dzh://VIEWSTOCK?DATATYPE=DAY&LAYOUT=Level2默认&PAGE=分时走势&LABEL='+t.obj+'">'+t.name+"</a>"}},{width:"50",name:"最新",color:!0,value:function(t){return this.fixValue(this.fixLastTrade(t))}},{width:"60",name:"涨幅",color:!0,value:function(t){return this.fixPercent(this.fixChg(t))}},{width:"auto",name:"",value:function(){return""}}],items:[]}),this.tipGrid.setItems(e.stocks),this.tips.css(s).show(),this.tipSelector=[t.currentTarget.parentNode,this.tips],this.onCellMouseLeave=function(t){$(t.target).closest(this.tipSelector).length||(this.tips.hide(),this.root.off("mousemove",this.onCellMouseLeave))}.bind(this),this.root.on("mousemove",this.onCellMouseLeave)}else this.tips.hide()},renderGrid:function(t){var e=new Date,n=e.getFullYear(),s=parseInt(e.getMonth())+1>9?parseInt(e.getMonth())+1:"0"+(parseInt(e.getMonth())+1),r=parseInt(e.getDate())<10?"0"+e.getDate():e.getDate(),a=""+n+s+r;this.mainGrid&&this.mainGrid.destroy(),this.mainGrid=new i(this.grids[0],{columns:[{width:"40",name:"序号",css:"white c",value:function(t,e){return e+1}},{width:"20",name:"",css:"blue r",value:function(t){return t.stocks.length>1?'<i class="fa fa-caret-down"></i>':""}},{width:"80",name:"证券代码",css:"1",sort:!0,value:function(t){return'<a href="dzh://VIEWSTOCK?DATATYPE=DAY&LAYOUT=Level2默认&PAGE=分时走势&LABEL='+t.obj+'">'+t.obj.split(".")[0]+"</a>"}},{width:"80",name:"证券简称",css:"1",title:!0,sort:!0,value:function(t){return'<a href="dzh://VIEWSTOCK?DATATYPE=DAY&LAYOUT=Level2默认&PAGE=分时走势&LABEL='+t.obj+'">'+t.name+"</a>"}},{width:"60",name:"最新",color:!0,sort:!0,value:function(t){return this.fixValue(this.fixLastTrade(t))}},{width:"65",name:"涨幅",color:!0,sort:!0,value:function(t){return this.fixPercent(this.fixChg(t))}},{width:"auto",name:"标题",css:"white l",title:!0,sort:!0,value:function(t){return"<a href=\"dzh://navigate?'root://news/details/index.html?skin=white#"+t.C1+"#DZHPOPUP(854,504)#'\">"+t.C3+"</a>"}},{width:"165",name:"来源",css:"white l",sort:!0,value:function(t){return t.C8}},{width:"165",name:"时间",css:"white l",sort:!0,value:function(t){var e=t.C6.substr(0,8).replace(/^(\d{4})(\d\d)(\d\d)/,"$1-$2-$3");return a==t.C6.substr(0,8)&&(e=t.C6.substr(8,6).replace(/^(\d{2})(\d\d)(\d\d)/,"$1:$2:$3")),e}}],items:t,chgIndex:0,init:function(){this.send(),this.items.forEach(function(t){this.items[t.obj]instanceof Array?this.items[t.obj].push(t):this.items[t.obj]=[t]},this),this.base(arguments)},compare:function(t){return function(t,e){return this(t,e)||t.C1.localeCompare(e.C1)}.bind(this.base(t))},updateItems:function(t){t.length&&t.forEach(function(t){var e=this.items[t.obj];if(e)for(var i=0,n=e.length;n>i;i++)this.updateItem(e[i],t)},this),this.refresh(!0)},onCreate:function(t){t.target.find("thead")[0].addEventListener("mousedown",function(t){"SELECT"===t.target.tagName&&t.stopPropagation()},!0),t.target.find("select").eq(0).on("change",function(t){this.emit("stockFilterChange",t.target.selectedIndex)}.bind(this)).widget("select"),t.target.find("select").eq(1).on("change",function(t){this.chgIndex=t.target.selectedIndex,this.target.find("th").removeClass("asc desc"),this.sort(9,"desc"),this.changes.renderRows=!0}.bind(t)).widget("select")}.bind(this),onDblClick:function(t){location.assign($(t.currentTarget).find("a").eq(1).attr("href"))}})},onFilterInit:function(t){var e=t.target.widget,i=e.target;e.on("select",function(t){this.target.val(t.innerText.replace(/^(\S+)\s(.+)/,"$2 $1")).attr("data-id",t.dataset.id)}),i.on({focus:function(){this.val("").attr("data-id","")}.bind(i),blur:function(){!this.attr("data-id")&&this.val("")}.bind(i),keyup:function(t){13===t.which&&$("a[data-bind=onSearchBtnClick]").click()}.bind(i),input:function(t){var e=t.target.value.trim();e?(this.emit("filterInput",e.toUpperCase()),this.activeFilter=t.target.widget):t.target.widget.render([])}.bind(this)}).next().on("click",function(t){var e=this.results.find(">."+this.cssActive);e.length&&this.emit("select",e[0]),this.target.parent().find(">button:eq(0)").click(),t.stopPropagation()}.bind(e))},renderFilterResults:function(t){this.activeFilter.render(t)},onSearchBtnClick:function(){var t=$("input[type='search']").attr("data-id"),e=$("input[name='titleKey']")[0].value,i={code:t,titleKey:e};(t||e)&&this.emit("changeParmeter",i)}});return n.init=function(){new e(new this({root:$(document),grids:$(".grid"),pagerDiv:$(".pager"),tips:$(".tooltips")}))},n}),require(["views/vindex"],function(t){t.init()}),define("src",function(){});