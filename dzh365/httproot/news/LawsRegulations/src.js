define("views/_base",["_base","observable","jquery","datetime","dialog","filter","select","splitter","grid","ztree"],function(t,e){return t.extend([e],function(t){$.extend(this,t),this.root.on("click","[data-bind$=Click]",this.handleEvent.bind(this)),this.root.on("change","[data-bind$=Change]",this.handleEvent.bind(this)),setTimeout(function(){"function"==typeof this.init&&this.init(t),this.emit("init")}.bind(this),0)},{handleEvent:function(t){var e=t.currentTarget.dataset.bind;e in this&&"function"==typeof this[e]&&this[e](t),this.emit(e.replace(/^on\w/,function(t){return t.slice(-1).toLowerCase()}),t.currentTarget.value||t.currentTarget.dataset)}})}),define("presenters/_base",["_base"],function(t){return t.extend(function(t){this.view=t})}),define("repositories/_base",["_base","socket"],function(t){return t.extend(function(){},{})}),define("repositories/rules",["./_base"],function(t){return new(t.extend({getParams:function(t){return t.parameter&&(t.paraencode="base64",t.parameter=(external.base64encode||btoa)(JSON.stringify(t.parameter))),$.extend(t,{so:"jso-ui-laws.jar"})},processTreeData:function(t,e){this.industryData=[["","全部"]],this.areaData=[["","全部"]],this.branchData=[["","全部"]],this.levelData=[["","全部"]];for(var i=[{fatherNoderId:"-1",level:"1",itemId:"",name:"最新法规",nodeValue:"new",type:"newRules"},{fatherNoderId:"-1",level:"1",itemId:"",name:"法规收藏",nodeValue:"collect",childern:[]}],n=0,a=t.length;a>n;n++)if("1"==t[n].level)i.push(t[n]);else if("2"==t[n].level){for(var s=0,r=i.length;r>s;s++)i[s].nodeId==t[n].fatherNodeId&&(i[s].children||(i[s].children=[]),i[s].children.push(t[n]),t[n].name==e?i[s].open=!0:"最新法规"==e&&(i[3].open=!0));"115417"==t[n].fatherNodeId?this.industryData.push([t[n].itemId,t[n].name]):"115326"==t[n].fatherNodeId||"115383"==t[n].fatherNodeId?this.branchData.push([t[n].itemId,t[n].name]):"115525"==t[n].fatherNodeId?this.areaData.push([t[n].itemId,t[n].name]):"115404"==t[n].fatherNodeId&&this.levelData.push([t[n].itemId,t[n].name])}else if("3"==t[n].level)for(var s=0,r=i.length;r>s;s++)if(i[s].children)for(var o=0,h=i[s].children.length;h>o;o++)i[s].children[o].nodeId==t[n].fatherNodeId&&(i[s].children[o].children||(i[s].children[o].children=[]),i[s].children[o].children.push(t[n]));return i},getTreeNodes:function(){return $.send("/rpc",this.getParams({"function":"gw.sh.func.QueryLawsTreeRequest",parameter:{}}))},getRules:function(t){return $.send("/rpc",this.getParams({"function":"gw.sh.func.SearchLawsRequest",parameter:t}))},getRuleContent:function(t){return $.send("/rpc",this.getParams({"function":"gw.sh.func.GetDetailLawsRequest",parameter:{lawsId:t}}))},getFavorites:function(){var t=$.Deferred();return t.resolve("RulesFavorites"in localStorage?JSON.parse(localStorage.getItem("RulesFavorites")):[]),t},setFavorites:function(t){return localStorage.setItem(["RulesFavorites"].join("."),JSON.stringify(t)),this.getFavorites()},getRanges:function(){return{industryData:this.industryData,branchData:this.branchData,areaData:this.areaData,levelData:this.levelData}}}))}),define("presenters/rules",["./_base","../repositories/rules"],function(t,e){return t.extend(function(){this.view.on("init",this.onInit.bind(this)),this.view.on("treeNodesClick",this.onTreeNodesClick.bind(this)),this.view.on("pagerChange",this.onPagerChange.bind(this)),this.view.on("articleLinkClick",this.onArticleLinkClick.bind(this)),this.view.on("prevArticleLinkClick",this.onPrevArticleLinkClick.bind(this)),this.view.on("nextArticleLinkClick",this.onNextArticleLinkClick.bind(this)),this.view.on("attachmentLinkClick",this.onAttachmentLinkClick.bind(this)),this.view.on("searchBtnClick",this.onSearchBtnClick.bind(this)),this.view.on("advSearchBtnClick",this.onAdvSearchBtnClick.bind(this)),this.view.on("favoritesBtnClick",this.onFavoritesBtnClick.bind(this)),this.view.on("favoritesChange",this.onFavoritesChange.bind(this)),this.view.on("removeFavoritesBtnClick",this.onRemoveFavoritesBtnClick.bind(this)),this.view.on("exportBtnClick",this.onExportBtnClick.bind(this)),this.view.on("relatedClick",this.onRelatedClick.bind(this)),this.view.on("relatedDownloadClick",this.onRelatedDownloadClick.bind(this))},{onInit:function(){this.node=decodeURI((location.search.match(/treenode=([^&]*)/)||[,"最新法规"])[1]),this.pageCount=1,this.ruleList=[],this.args={type:4,pageNum:1,pageSize:50,content:"",bdate:"",edate:""},this.view.renderGrid([]),this.createLeftTree()},createLeftTree:function(){e.getTreeNodes().then(function(t){var i=e.processTreeData(t,this.node);this.view.renderTree(i);$.when(this.updateFavorites()).then(function(){this.view.renderNode(this.node)}.bind(this))}.bind(this))},onTreeNodesClick:function(t,e){arguments.length?(this.lock=!1,this.fixArgs("lawsId"==e?{type:3}:"newRules"==e?{type:4}:{type:2}),t&&e&&(this.args[e]=t,this.args.bdate="",this.args.edate=""),this.updateNoticePageCount(),this.updateRulesList()):(this.lock=!0,this.view.renderPager(1,1),this.view.grid.empty())},onPagerChange:function(t){this.lock||"pending"===this.listPromise.state()||(t=isNaN(Number(t))?1:Math.ceil(Number(t)),1>t&&(t=1),t>this.pageCount&&(t=this.pageCount),this.args.pageNum=Number(t),this.updateRulesList()),this.view.renderPager(this.args.pageNum,this.pageCount)},onArticleLinkClick:function(t){this.updateNoticeContent(t.key,function(){this.view.renderArticle(this.article.detail)}.bind(this))},onPrevArticleLinkClick:function(){this.article&&this.onArticleLinkClick({key:this.getRule(this.article.C1).prev.C1})},onNextArticleLinkClick:function(){this.article&&this.onArticleLinkClick({key:this.getRule(this.article.C1).next.C1})},onAttachmentLinkClick:function(t){this.updateNoticeContent(t.key,function(){this.view.renderAttachment(this.article,Number(t.index))}.bind(this))},onSearchBtnClick:function(t){t.type=1,this.fixArgs(t),this.args.bdate=t.bdate?t.bdate.replace(/-/g,"")+"000000":"",this.args.edate=t.edate?t.edate.replace(/-/g,"")+"235959":"",this.updateNoticePageCount(),this.updateRulesList()},onAdvSearchBtnClick:function(){this.view.renderSearchDialog(e.getRanges())},onFavoritesBtnClick:function(){e.getFavorites().then(function(t){this.view.renderFavoritesDialog(t.length?t:[{name:"收藏1"}])}.bind(this))},onFavoritesChange:function(t){e.setFavorites(t).then(function(t){this.view.renderFavoritesNode(t)}.bind(this))},onRemoveFavoritesBtnClick:function(t){if(t.keys){var i={};t.keys.split(",").forEach(function(t){i[t]=!0},i),e.getFavorites().then(function(t){var n=this.view.tree.getSelectedNodes()[0].index,a=t[n];if(a){for(var s=a.keys.split(","),r=s.length;r--;)s[r]in i&&s.splice(r,1);a.keys=s.join(","),e.setFavorites(t),this.view.changeFavoritesNode(a.keys)}}.bind(this))}},updateRulesList:function(){this.listPromise&&this.listPromise.cancel(),this.tips=setTimeout(function(){this.view.grid.loading(),this.view.renderPager(this.args.pageNum,this.pageCount)}.bind(this),100);try{this.listPromise=e.getRules(this.args).then(function(t){clearTimeout(this.tips),t.length>this.args.pageSize&&(t.pop(),this.view.renderPager(this.args.pageNum,++this.pageCount)),this.ruleList=t,t.offset=(this.args.pageNum-1)*this.args.pageSize,this.view.renderGrid(t),0===t.length?this.view.grid.empty():this.onArticleLinkClick({key:t[0].C1})}.bind(this),function(t){clearTimeout(this.tips),"cancel"!==t&&this.view.grid.error()}.bind(this))}catch(t){throw this.view.grid.error(),t}},updateNoticePageCount:function(){this.pageCount=1,this.args.pageNum=1,this.view.renderPager(this.args.pageNum,this.pageCount)},updateFavorites:function(){return e.getFavorites().then(function(t){this.view.renderFavoritesNode(t)}.bind(this))},updateNoticeContent:function(t,i){this.article=this.getRule(t).item,"detail"in this.article?i():e.getRuleContent(this.article.C1).then(function(t){t[0].C18A=t[0].C18A.replace(/\\/g,"/"),this.article.detail=t[0],i()}.bind(this))},onRelatedClick:function(t){console.dir(t),e.getRuleContent(t.key).then(function(t){t[0].C18A=t[0].C18A.replace(/\\/g,"/"),this.view.renderArticle(t[0])}.bind(this))},getRule:function(t){return!t||t+"\f"in this.ruleList||this.ruleList.forEach(function(t,e){this.ruleList[t.C1+"\f"]={item:t,prev:this.ruleList[e-1]||this.ruleList[this.ruleList.length-1],next:this.ruleList[e+1]||this.ruleList[0]}},this),t?this.ruleList[t+"\f"]:this.ruleList[0]},fixArgs:function(t){["type","index","deptId","key","bdate","edate","industryId","areaId","levelId","deptIdArr","levelIdArr","tradeArr","areaArr"].forEach(function(e){t[e]?this.args[e]=t[e]:delete this.args[e]},this),t=void 0},getDate:function(t){var e=new Date,i=parseInt(t);if(!isNaN(i))switch(t.slice(-1)){case"d":e.setDate(e.getDate()+i);break;case"m":e.setMonth(e.getMonth()+i);break;case"y":e.setFullYear(e.getFullYear()+i)}return new Date(e-6e4*e.getTimezoneOffset()).toJSON().replace(/\D/g,"").slice(0,8)+"000000"},onExportBtnClick:function(){if(this.ruleList.length){var t="大智慧数据导出",e='<html xmlns:x="urn:schemas-microsoft-com:office:excel"><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>'+t+'</x:Name><x:WorksheetOptions><x:Panes></x:Panes></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--><meta http-equiv="content-type"content="text/html; charset=gbk"><style>.text{font-family:Arial;font-size:10pt;mso-number-format:"@"}</style></head><body>',i="</body></html>";if(window.external.saveas){var n=[],a="法律法规导出"+(new Date).getTime()+parseInt(1e5*Math.random());n.push(e),n.push("<table>"),n.push("<tbody>");for(var s=0;s<this.ruleList.length;s++)n.push("<tr>"),n.push("<td>"+this.ruleList[s].C10.replace(/^(\d{4})(\d\d)(\d\d)(\d+)/,"$1-$2-$3 ")+"</td>"),n.push("<td>"+this.ruleList[s].C5+"</td>"),n.push("<td>"+(this.ruleList[s].C7?this.ruleList[s].C7:"--")+"</td>"),n.push("</tr>");n.push("</tbody>"),n.push("</table>"),n.push(i),window.external.saveas(n.join(""),a,"xls"),n=[]}}},onRelatedDownloadClick:function(t){if(external.download)for(var e=t.link.split(),i=0,n=e.length;n>i;i++)external.download("dzh://FILEMGR?OPEN=1&SHOWUI=1&LINK=http://pdf.gw.com.cn/pdf/pdfPath/MRGG/"+e[i].replace(/\\/g,"/")+"&FILE="+t.title+"(附件_"+i+")")}})}),define("views/widgets/grid",["grid"],function(t){return t.extend(function(){this.changeHandle()},{options:{forceFitColumns:!1,resizable:!1,resize:!0},formatter:{serial:function(t){return t+1},date:function(t,e,i){return i.substr(0,8).replace(/^(\d{4})(\d\d)(\d\d)/,"$1-$2-$3")},title:function(t,e,i,n,a){var s=a.C7.match(/[^,]+/g)||[""];if(s[0]=s[0].toLowerCase(),s.length>1)switch(s[0]){case"doc":case"docx":case"pdf":case"rar":case"txt":case"xls":case"xlsx":s[0]=s[0]+"-m";break;default:s[0]="multiple"}return['<a data-bind="onAttachmentLinkClick" data-key="',a.CV,'"><i class="icon-',s[0],'"></i></a> ','<a data-bind="onArticleLinkClick" data-key="',a.CV,'" title="',i,'">',i,"</a>"].join("")},favorites:function(t,e,i,n,a){return'<input type="checkbox" value="'+a.CV+"#"+a.TYPE+'">'}},getColumns:function(){var t=[{pwidth:"4%",name:"序号",cssClass:"center",formatter:this.formatter.serial},{pwidth:"10%",field:"C2",name:"公告日期",cssClass:"center",sortable:!0,formatter:this.formatter.date},{pwidth:"10%",field:"C5",name:"证券代码",cssClass:"center",sortable:!0},{pwidth:"14%",field:"C6",name:"证券简称",sortable:!0},{pwidth:"42%",field:"C3",name:"公告标题",sortable:!0,formatter:this.formatter.title},{pwidth:"12%",field:"C4",name:"公告类型",sortable:!0},{pwidth:"8%",name:'<button data-bind="'+this.btnHandle+'" class="btn-radius">'+this.btnContent+"</button>",cssClass:"center",formatter:this.formatter.favorites}];switch((location.search.match(/\btype=([^&]*)/)||[,"stock"])[1]){case"financial":t[3].pwidth=parseInt(t[3].pwidth)+parseInt(t[2].pwidth)+"%",t.splice(2,1);break;case"bond":case"fund":this.node.name in{"折算比例":1,"估值说明":1,"基金公司动态":1}&&(t[4].pwidth=parseInt(t[4].pwidth)+parseInt(t[3].pwidth)+parseInt(t[2].pwidth)+"%",t.splice(2,2))}return t.forEach(function(t,e){t.id=e}),t},render:function(t){return t.forEach(function(t,e){t.id=e}),this.base(t,this.getColumns()),this.instance.getData().setSerialField(1),this},loading:function(){this.render([]).target.find(">.slick-viewport").addClass("icon-loading")},tips:function(t){this.render([]).target.find(".grid-canvas").html('<div style="margin: 5px;">'+t+"</div>")},empty:function(){this.tips(this.emptyContent)},error:function(){this.tips("提示：服务器忙请求超时，请稍候重试")},getCheckedItems:function(){return this.target.find("input[type=checkbox]:checked").map(function(){return this.value}).toArray()},changeHandle:function(t){if(t){if("公告收藏"===(t.getParentNode()||{}).name)return this.emptyContent="提示：无收藏记录",this.btnContent='<i class="fa fa-trash-o"></i> 删除',void(this.btnHandle="onRemoveFavoritesBtnClick");this.node=t}else this.node={};this.emptyContent="提示：该品种无此项记录，或在当前筛选条件下无数据",this.btnContent='<i class="fa fa-star"></i> 收藏',this.btnHandle="onFavoritesBtnClick"}})}),define("views/widgets/rules_grid",["./grid"],function(t){return t.extend(function(){},{formatter:{nowPageNum:$(".pager").find("input").val(),serial:function(t){return t+1+this.getItems().offset},date:function(t,e,i){return i.substr(0,8).replace(/^(\d{4})(\d\d)(\d\d)/,"$1-$2-$3")},title:function(t,e,i,n,a){var s=a.C18A.match(/[^,]+\.\w+/g)||[""],r=s[0].replace(/^.+\./,"").toLowerCase(),o=!1;if(s.length>1){for(var h=1,l=s.length;l>h;h++)s[h].replace(/^.+\./,"").toLowerCase()!=r&&(o=!0);o?r="multiple":r+="-m"}return['<a data-bind="onAttachmentLinkClick" data-key="',a.C1,'"><i class="icon-',r,'"></i></a> ','<a data-bind="onArticleLinkClick" data-key="',a.C1,'" title="',i,'">',i,"</a>"].join("")},favorites:function(t,e,i,n,a){return'<input type="checkbox" value="'+a.C1+'">'},dept:function(t,e,i){return"NULL"==i?"":i}},getColumns:function(){var t=[{pwidth:"6%",name:"序号",cssClass:"center",formatter:this.formatter.serial},{pwidth:"10%",field:"C10",name:"日期",cssClass:"center",formatter:this.formatter.date},{pwidth:"52%",field:"C5",name:"标题",formatter:this.formatter.title},{pwidth:"24%",field:"C7",name:"发文机关",formatter:this.formatter.dept},{pwidth:"8%",name:'<button data-bind="'+this.btnHandle+'" class="btn-radius">'+this.btnContent+"</button>",cssClass:"center",formatter:this.formatter.favorites}];return t.forEach(function(t,e){t.id=e}),t},changeHandle:function(t){if(t){if("法规收藏"===(t.getParentNode()||{}).name)return this.emptyContent="提示：无收藏记录",this.btnContent='<i class="fa fa-trash-o"></i> 删除',void(this.btnHandle="onRemoveFavoritesBtnClick");this.node=t}else this.node={};this.emptyContent="提示：该品种无此项记录，或在当前筛选条件下无数据",this.btnContent='<i class="fa fa-star"></i> 收藏',this.btnHandle="onFavoritesBtnClick"}})}),define("views/widgets/confirm_dialog",["dialog"],function(t){return t.extend(function(){this.target.on("click","[data-bind$=Click]",this.handleEvent.bind(this)),this.target.on("change","[data-bind$=Change]",this.handleEvent.bind(this))},{onConfirmBtnClick:function(){this.emit("confirm"),this.hide()},onCancelBtnClick:function(){this.emit("cancel"),this.hide()},handleEvent:function(t){var e=t.currentTarget.dataset.bind;this.emit(e.replace(/^on\w/,function(t){return t.slice(-1).toLowerCase()}),t.currentTarget.value||t.currentTarget.dataset)}})}),define("views/widgets/search_dialog",["./confirm_dialog"],function(t){return t.extend(function(){this.existSelect=0;var t=this.target.find("select");this.filter=this.target.find("input[type=search]"),this.ranges=this.target.find("input[type=datetime]"),this.dateSelect=t.eq(0),this.branchSelect=t.eq(1).on("init",function(){this.branchSelect.widget().menu.on("change","input",function(){this.onRangeSelectChange(event,this.branchSelect)}.bind(this))}.bind(this)),this.industrySelect=t.eq(2).on("init",function(){this.industrySelect.widget().menu.on("change","input",function(){this.onRangeSelectChange(event,this.industrySelect)}.bind(this))}.bind(this)),this.areaSelect=t.eq(3).on("init",function(){this.areaSelect.widget().menu.on("change","input",function(){this.onRangeSelectChange(event,this.areaSelect)}.bind(this))}.bind(this)),this.levelSelect=t.eq(4).on("init",function(){this.levelSelect.widget().menu.on("change","input",function(){this.onRangeSelectChange(event,this.levelSelect)}.bind(this))}.bind(this)),this.onDateSelectChange(),/type=financial/.test(location.search)&&(this.filter.parent().hide(),this.rangeSelect.parent().hide())},{onDateSelectChange:function(){var t=Number(this.dateSelect.val()),e=new Date,i=new Date,n=function(t){return new Date(t-6e4*t.getTimezoneOffset()).toJSON().slice(0,10)};t&&(e.setMonth(i.getMonth()-t),this.ranges.prop("disabled",!1),this.ranges.eq(0).val(n(e)),this.ranges.eq(1).val(n(i))),this.ranges.prop("disabled",!!t)},onRangeSelectChange:function(t,e){if(t.target.checked){var i=$(t.target.parentNode.parentNode.parentNode).find("input");i.filter(":"+("全部"===t.target.parentNode.children[1].innerText?"gt":"eq")+"(0)").not(t.target).prop("checked",!1),i.toArray().forEach(function(t,i){e[0].options[i].selected=t.checked}.bind(this))}},onConfirmBtnClick:function(t){var e=this.filter.val(),i=this.ranges.prop("disabled");this.filter.val(this.filter.attr("data-id")||""),this.ranges.prop("disabled",!1),this.params={},console.log("this.target.find('form').serializeArray()",this.target.find("form").serializeArray()),this.target.find("form").serializeArray().forEach(function(t){t.value&&(this.params[t.name]=t.name in this.params?this.params[t.name]+","+t.value:t.value)},this),this.filter.val(e),this.ranges.prop("disabled",i),this.emit("change",this.params),this.base(t)},renderSelect:function(t){if(1==this.existSelect)return!1;this.existSelect=1;var e=[],i=[],n=[],a=[];t.branchData.forEach(function(t){this.push('<option value="',t[0],'">',t[1],"</option>")},e),t.industryData.forEach(function(t){this.push('<option value="',t[0],'">',t[1],"</option>")},i),t.areaData.forEach(function(t){this.push('<option value="',t[0],'">',t[1],"</option>")},n),t.levelData.forEach(function(t){this.push('<option value="',t[0],'">',t[1],"</option>")},a),this.branchSelect.html(e.join("")),this.industrySelect.html(i.join("")),this.areaSelect.html(n.join("")),this.levelSelect.html(a.join(""))}})}),define("views/widgets/tree_dialog",["./confirm_dialog"],function(t){return t.extend(function(){this.renderTree(this.cloneNodes())},{onConfirmBtnClick:function(t){var e=[];this.items={},this.value=[],this.tree.getNodesByFilter(function(t){return t.checked&&1!==t.check_Child_State}).forEach(function(t){this.value.push(t.name),t.keys&&t.keys.split(",").forEach(function(t){this[t]=!0},this.items)}.bind(this));for(var i in this.items)e.push(i);this.emit("change",this.value.join(","),e.join(",")),this.base(t)},cloneNodes:function(t,e){return t=t||this.nodes,e=e||[],t.forEach(function(t){var e={name:t.name,keys:t.keys,open:t.open};this[1].push(e),t.children&&(e.children=[],this[0](t.children,e.children))},[arguments.callee,e]),e},renderTree:function(t){this.tree=$.fn.zTree.init(this.target.find(".ztree"),{check:{enable:!0},view:{dblClickExpand:!1,expandSpeed:"",nameIsHTML:!0,selectedMulti:!1,showIcon:!1,showTitle:!1}},t)}})}),define("views/widgets/favorites_dialog",["./confirm_dialog"],function(t){return t.extend(function(){this.list=this.target.find("ul").on("click","li",this.onItemClick.bind(this)).on("blur","input",this.onItemBlur.bind(this)),this.setActiveItem()},{onItemClick:function(t){this.setActiveItem($(t.currentTarget))},onItemBlur:function(){var t=this.activeItem.find("input").remove().val().trim()||this.activeItem.attr("data-name");t?this.activeItem.removeClass("edit").text(t).attr("data-name",this.activeItem.text()):(this.activeItem.remove(),this.setActiveItem())},onAddBtnClick:function(){var t=$("<li></li>");this.list.append(t),this.setActiveItem(t),this.setEditItem()},onEditBtnClick:function(){this.setEditItem()},onRemoveBtnClick:function(){this.activeItem.remove(),this.setActiveItem()},onMoveUpBtnClick:function(){this.activeItem.prev().before(this.activeItem)},onMoveDownBtnClick:function(){this.activeItem.next().after(this.activeItem)},onConfirmBtnClick:function(t){var e=[],i=this.activeItem.attr("data-keys");i=(i?i.split(","):[]).concat(this.keys),this.activeItem.attr("data-keys",i),this.list.children().each(function(){e.push({name:this.dataset.name,keys:this.dataset.keys||""})}),this.emit("change",e),e=void 0,this.base(t)},setActiveItem:function(t){this.activeItem=(t||this.list.children().first()).siblings().removeClass("active").end().addClass("active")},setEditItem:function(t){this.editItem=(t||this.activeItem).addClass("edit"),this.editItem.html('<input type="text">').find("input").val(this.editItem.attr("data-name")||"").focus()},render:function(t){var e=[];return t.forEach(function(t,i){e.push("<li",i?"":' class="active"',' data-name="',t.name,'" data-keys="',t.keys,'">',t.name,"</li>")},e),this.list.html(e.join("")),this.setActiveItem(),this}})}),define("views/rules",["./_base","../presenters/rules","./widgets/rules_grid","./widgets/confirm_dialog","./widgets/search_dialog","./widgets/tree_dialog","./widgets/favorites_dialog"],function(t,e,i,n,a,s,r){var o=t.extend(function(){this.root.on("init","input[type=search]",this.onFilterInit.bind(this)),/type=financial/.test(location.search)&&(this.form.find("input").prop({type:"text",placeholder:"请输入标题关键字"}),this.form.find("a").removeAttr("data-bind").on("click",function(){this.emit("searchBtnClick",{key:this.form.find("input").val()})}.bind(this)))},{onTreeNodesClick:function(t,e,i){this.grid.changeHandle(i),i.itemId&&"NULL"!=i.itemId||i.name.indexOf("最新法规")>-1?this.emit("treeNodesClick",i.itemId,i.type):i.keys?this.emit("treeNodesClick",i.keys,"lawsId"):i.children?this.tree.expandNode(i):this.emit("treeNodesClick"),this.form.find("input").val("").removeAttr("data-id")},onFirstBtnClick:function(){this.emit("pagerChange",1)},onLastBtnClick:function(){this.emit("pagerChange",this.pager.find("input").attr("max"))},onPrevBtnClick:function(){this.emit("pagerChange",Number(this.pager.find("input").val())-1)},onNextBtnClick:function(){this.emit("pagerChange",Number(this.pager.find("input").val())+1)},onArticleLinkClick:function(){this.loadingArticle(),this.contentSplitter.is(":visible")?(this.contentSplitter.removeClass("flex-splitter-hide").show(),this.contentPanel.removeClass("flex-none-hide")):this.articleDialog.show()},onPrevArticleLinkClick:function(){this.loadingArticle()},onNextArticleLinkClick:function(){this.loadingArticle()},onChangeSizeBtnClick:function(t){$(t.target).addClass("active").siblings("a").removeClass("active").parents("article").css("font-size",t.target.dataset.size+"px")},onChangeViewBtnClick:function(t){this.contentSplitter.is(":visible")?(this.contentSplitter.hide().addClass("flex-splitter-hide"),this.contentPanel.addClass("flex-none-hide"),this.articleDialog.target.find(">.dialog-body").append(this.articlePanel),this.articleDialog.show(),$(t.target).find(">.fa").removeClass("fa-d003").addClass("fa-d004")):(this.contentSplitter.removeClass("flex-splitter-hide").show(),this.contentPanel.append(this.articlePanel).removeClass("flex-none-hide"),this.articleDialog.hide(),$(t.target).find(">.fa").removeClass("fa-d004").addClass("fa-d003"))},onSearchBtnClick:function(t){t.target.dataset.key=$(t.target.parentNode).find("input").val()||"",this.tree.cancelSelectedNode()},onAdvSearchBtnClick:function(){this.searchDialog instanceof Element&&(this.searchDialog=new a(this.searchDialog,{onChange:function(t){this.emit("searchBtnClick",t),this.tree.cancelSelectedNode()}.bind(this),onHide:function(){this.treeDialog.hide&&this.treeDialog.hide()}.bind(this)}))},onChooseBtnClick:function(){if(this.treeDialog instanceof Element){var t=this.tree.getNodes();this.treeDialog=new s(this.treeDialog,{nodes:(/type=stock\b/.test(location.search)?[t[t.length-2]]:[]).concat(t[t.length-1]),onChange:function(t,e){this.searchDialog.target.find("#itemId").val(t),this.searchDialog.target.find("input[name=itemId]").val(e)}.bind(this)})}this.treeDialog.show()},onFavoritesBtnClick:function(t){this.favoritesDialog instanceof Element&&(this.favoritesDialog=new r(this.favoritesDialog,{onChange:function(t){this.emit("favoritesChange",t)}.bind(this)})),this.favoritesDialog.keys=t.target.dataset.key?[t.target.dataset.key]:this.grid.getCheckedItems()},onRemoveFavoritesBtnClick:function(){this.alertDialog instanceof Element&&(this.alertDialog=new n(this.alertDialog,{onConfirm:function(){this.emit("removeFavoritesBtnClick",{keys:this.grid.getCheckedItems().join(",")})}.bind(this)})),this.grid.getCheckedItems().length&&this.alertDialog.show()},onFilterInit:function(t){var e=t.target.widget,i=e.target;i.on({focus:function(){this.val("").attr("data-id","")}.bind(i),keyup:function(t){13===t.which&&this.blur().parent().find(">a:eq(0)").click()}.bind(i),input:function(t){var e=t.target.value.trim();e?(this.emit("filterInput",e.toUpperCase()),this.activeFilter=t.target.widget):t.target.widget.render([])}.bind(this)})},onCloseBtnClick:function(t){$(t.target).parents(".dialog").widget().hide()},renderTree:function(t){this.tree=$.fn.zTree.init(this.nav,{callback:{onClick:this.onTreeNodesClick.bind(this)},view:{dblClickExpand:!1,expandSpeed:"",nameIsHTML:!0,selectedMulti:!1,showIcon:!1,showTitle:!1}},t)},renderNode:function(t){var e=this.tree.getNodeByParam("name",t);e&&document.getElementById(e.tId+"_a").click()},renderLatestCount:function(t){var e=this.tree.getNodes()[0];e.name=e.name.replace(/<b>[^<]*<\/b>/,"")+"<b>["+t+"]</b>",this.tree.updateNode(e)},renderFavoritesNode:function(t){var e=this.tree.getNodes()[1],i=e.open;this.tree.removeChildNodes(e),this.tree.addNodes(e,t.map(function(t,e){return t.index=e,t}),!i)},renderSecuritiesNode:function(t){var e=this.tree.getNodes()[2],i=e.open;this.tree.removeChildNodes(e),this.tree.addNodes(e,t,!i)},renderGrid:function(t){this.grid=this.grid||new i({target:this.container}),this.grid.render(t)},renderPager:function(t,e){this.pager.find("input").attr("max",e).val(t),this.pager.find("label").text("/ "+e),this.pager.find("a").eq(1)[1===t?"addClass":"removeClass"]("btn-disable"),this.pager.find("a").eq(2)[t===e?"addClass":"removeClass"]("btn-disable")},renderFilterResults:function(t){this.activeFilter.render(t)},relatedRules:function(t){var e='<div id="relatedRules"><li class="fa"></li>';if("NULL"==t)e+="无相关法规</div>";else{e+="相关法规</div>";for(var i=t.split(";"),n=0,a=i.length;a>n;n++){var s=i[n].split(",");if(e+="<div>["+s[1].replace(/^(\d{4})(\d\d)(\d\d)(\d+)/,"$1-$2-$3 ")+"] ",s.length>3){for(var r=[],o=s[3].replace(/^.+\./,"").toLowerCase(),h=!1,l=3,c=s.length;c>l;l++)r.push(s[l]),l>3&&(s[l].replace(/^.+\./,"").toLowerCase()!=o?h=!0:o+="-m");h&&(o="multiple"),e+='<a data-bind="onRelatedDownloadClick" data-link="'+r.join()+'" data-title="'+s[2]+'"><i class=icon-'+o+"></i></a>"}e+='<a data-bind="onRelatedClick" data-key="'+s[0]+'" title="'+s[2]+'">'+s[2]+"</a><div>"}}return e},renderArticle:function(t){this.articlePanel.find(">h1").text(t.C5),this.articlePanel.find(">h2>span").text(t.C10.substr(0,8).replace(/^(\d{4})(\d\d)(\d\d)/,"$1-$2-$3")),this.articlePanel.find(">h2>a[data-bind=onFavoritesBtnClick]").attr("data-key",t.C1+"#"+t.TYPE),"NULL"===t.C18A?this.articlePanel.find("section").eq(0).find(">p").hide():this.articlePanel.find("section").eq(0).find(">p").html((t.C18A.toLowerCase().match(/pdf|doc|ppt|excel|xlsx|zip|ceb/g)||[]).map(function(t,e){return'<a data-bind="onAttachmentLinkClick" data-key="'+this.C1+'" data-index="'+e+'"><i class="icon-'+t+'"></i>附件'+(e+1)+"</a> "},t).join("")).show(),this.articlePanel.find("section").eq(1).html(t.C23.replace(/<\/?body>/g,""));var e=this.relatedRules(t.C2);this.articlePanel.find("section").eq(2).html(e),this.articlePanel.show(),$("#articlePanel")[0].scrollTop=0},loadingArticle:function(){this.articlePanel.hide()},renderAttachment:function(t,e){if(t.detail&&"NULL"!==t.detail.C18A){var i=(t.detail.C18A.match(/[^,]+/g)||[]).map(function(t,e){return"dzh://FILEMGR?OPEN=1&SHOWUI=1&LINK=http://pdf.gw.com.cn/pdf/pdfPath/MRGG"+(location.search.indexOf("_hk")>-1?"_HK":"")+"/"+t+"&FILE="+this.C18A+"(附件"+(e+1)+")"}.bind(t)).filter(function(t,e){return isNaN(this)||e==this}.bind(e)),n=function(){if(this.i<this.length){var t=this[this.i++];external.download?external.download(t):alert(t)}else clearInterval(this.id),this.length=0}.bind(i);i.i=0,i.id=setInterval(n,500),n()}},onRelatedDownload:function(t){console.dir(t)},renderSearchDialog:function(t){this.searchDialog.renderSelect(t),this.searchDialog.show()},renderFavoritesDialog:function(t){this.favoritesDialog.keys.length&&this.favoritesDialog.render(t).show()},changeFavoritesNode:function(t){var e=this.tree.getSelectedNodes()[0];e.keys=t,this.tree.updateNode(e),$("#"+e.tId+"_a").click()}});return o.init=function(){new e(new this({root:$(document),nav:$("#navTree"),form:$("form.flex-none"),container:$(".grid"),pager:$(".pager"),articlePanel:$("#articlePanel"),contentPanel:$("#contentPanel"),contentSplitter:$(".flex-splitter-bottom"),searchDialog:document.querySelector("#searchDialog"),favoritesDialog:document.querySelector("#favoritesDialog"),alertDialog:document.querySelector("#alertDialog"),treeDialog:document.querySelector("#treeDialog"),articleDialog:$("#articleDialog").widget("dialog")}))},o}),require(["views/rules"],function(){arguments[0]&&arguments[0].init&&arguments[0].init()}),define("src",function(){});