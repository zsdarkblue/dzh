(function(i){var r={dataMain:datatable_main,dataSecondary:datatable_secondary};var e={dids:i("#init-did").data("did"),mprDis:i("#main").data("did"),allIndex:0};var a=true,y=0,o=0,x="",s=0,q=[],v=[],f=[];fiexdData=null,data1=null,suffix="",report="",baseUrl="";var z=[],b=[];Socket.send("service=did&did="+e.mprDis+"&where=obj=IB&response_times=-1&fullmarket=1",function(C){if(C.length){j(C)}else{j(data1)}});if(e.mprDis=="100004"){fiexdData={IBO001:["1","IBO001","--","--","--","--","--","--","--","--","--","--"],IBO007:["2","IBO007","--","--","--","--","--","--","--","--","--","--"],IBO014:["3","IBO014","--","--","--","--","--","--","--","--","--","--"],IBO021:["4","IBO021","--","--","--","--","--","--","--","--","--","--"],IBO1M:["5","IBO1M","--","--","--","--","--","--","--","--","--","--"],IBO2M:["6","IBO2M","--","--","--","--","--","--","--","--","--","--"],IBO3M:["7","IBO3M","--","--","--","--","--","--","--","--","--","--"],IBO4M:["8","IBO4M","--","--","--","--","--","--","--","--","--","--"],IBO6M:["9","IBO6M","--","--","--","--","--","--","--","--","--","--"],IBO9M:["10","IBO9M","--","--","--","--","--","--","--","--","--","--"],IBO1Y:["11","IBO1Y","--","--","--","--","--","--","--","--","--","--"]};data1=[{obj:"IBIBO001.mmkt",time:"--",vol:"0","new":"--",open:"--",high:"--",low:"--",close:"--",avg:"--",lastclose:"--",lastavg:"--"}];suffix=".mmkt";report=""}if(e.mprDis=="100005"){fiexdData={R001:["1","R001","--","--","--","--","--","--","--","--","--","--"],R007:["2","R007","--","--","--","--","--","--","--","--","--","--"],R014:["3","R014","--","--","--","--","--","--","--","--","--","--"],R021:["4","R021","--","--","--","--","--","--","--","--","--","--"],R1M:["5","R1M","--","--","--","--","--","--","--","--","--","--"],R2M:["6","R2M","--","--","--","--","--","--","--","--","--","--"],R3M:["7","R3M","--","--","--","--","--","--","--","--","--","--"],R4M:["8","R4M","--","--","--","--","--","--","--","--","--","--"],R6M:["9","R6M","--","--","--","--","--","--","--","--","--","--"],R9M:["10","R9M","--","--","--","--","--","--","--","--","--","--"],R1Y:["11","R1Y","--","--","--","--","--","--","--","--","--","--"]};data1=[{obj:"IBR001.org",time:"--",vol:"0","new":"--",open:"--",high:"--",low:"--",close:"--",avg:"--",lastclose:"--",lastavg:"--"}];suffix=".org";report="pledge"}if(e.mprDis=="100006"){fiexdData={OR001:["1","OR001","--","--","--","--","--","--","--","--","--","--"],OR007:["2","OR007","--","--","--","--","--","--","--","--","--","--"],OR014:["3","OR014","--","--","--","--","--","--","--","--","--","--"],OR021:["4","OR021","--","--","--","--","--","--","--","--","--","--"],OR1M:["5","OR1M","--","--","--","--","--","--","--","--","--","--"],OR2M:["6","OR2M","--","--","--","--","--","--","--","--","--","--"],OR3M:["7","OR3M","--","--","--","--","--","--","--","--","--","--"]};data1=[{obj:"IBOR001.rpo",time:"--",vol:"0","new":"--",open:"--",high:"--",low:"--",close:"--",avg:"--",lastclose:"--",lastavg:"--"}];suffix=".rpo";report="outright"}var k=["obj","new",0,"avg","open","high","low","lastclose","lastavg","vol"];function j(F){var H=[],G={},E=[],C=[];F.forEach(function(K){var L=[],J=null,I=[];J=K.obj.lastIndexOf(".");if(K.vol==0){K.vol="--"}else{if(e.dids=="100204"||e.dids=="100205"){K.vol=(K.vol*10000).toFixed(4)}else{K.vol=(K.vol/10000).toFixed(4)}}if(K.lastavg==0){K.lastavg="--"}K.obj=K.obj.substring(2,J);I.push((100*(K["new"]-K.lastclose)/K.lastclose).toFixed(4));if(I[0]=="NaN"){I[0]="--"}H.push(i.extend({},K,I))});H.forEach(function(I){var J=[],K=[];k.forEach(function(L){J.push(I[L])});G[I.obj]=J});for(var D in fiexdData){if(D in G){G[D].unshift(fiexdData[D][0]);fiexdData[D]=G[D]}E.push(fiexdData[D])}z=[];z=E;B(r.dataMain,0,E);A(1)}i("#tab-main .tab-bar").on("click","li",function(){x=i(this).data("did");var D=r.dataMain[o].fnSettings();if(D.aoData.length){r.dataMain[o].oApi._fnClearTable(D);r.dataMain[o].fnDraw()}var E=i(this).index();o=E;a=true;i("#tab-main-datatable"+(E+1)).parents(".dataTables_scroll").find(".dataTables_scrollHeadInner,.dataTable").css("width","100%");r.dataMain[E].find("td.dataTables_empty").html(" ");if(E==0){B(r.dataMain,0,z);A((E+1))}if(E==1){var F=g(i("#tab2-input11").val()),G=g(i("#tab2-input12").val()),C=i("#tab"+(E+1)+"-select1").val();if(q.length){B(r.dataMain,1,q)}else{Socket.send(""+baseUrl+"/bond/bestPricesBetweenBanks/iBFundsController/"+x+".dzh?variety="+C+"&beginDate="+F+"&endDate="+G+"&report="+report+"",function(H){q=[];q=l(p(H));B(r.dataMain,1,l(p(H)))})}}if(E==2){var F=g(i("#tab3-input11").val())+"000000",G=g(i("#tab3-input12").val())+"999999",C=i("#tab"+(E+1)+"-select1").val();if(e.mprDis=="100004"){F=i("#tab3-input11").val()+" 00:00:00";G=i("#tab3-input12").val()+" 23:59:59"}if(v.length){B(r.dataMain,2,v)}else{Socket.send(""+baseUrl+"/bond/bestPricesBetweenBanks/iBFundsController/"+x+".dzh?variety="+C+"&beginDate="+F+"&endDate="+G+"&report="+report+"",function(H){v=[];v=l(p(H));B(r.dataMain,2,v)})}}if(E>0){if(!i("#tab-splitter-virtual").hasClass("fiter-none")){i("#tab-splitter-virtual .tab-splitter-controller").click()}i("#tab-splitter-virtual").addClass("fiter-none");i("#tab-splitter").addClass("fiter-none")}else{i("#tab-splitter-virtual").removeClass("fiter-none");i("#tab-splitter").removeClass("fiter-none");if(i("#main").hasClass("expanded")){i("#tab-splitter-virtual .tab-splitter-controller").click()}}});i("#tab-secondary .tab-bar").on("click","li",function(){a=true;var C=r.dataSecondary[s].fnSettings();if(C.aoData.length){r.dataSecondary[s].oApi._fnClearTable(C);r.dataSecondary[s].fnDraw()}var D=i(this).index();s=D;i("#tab-secondary-datatable"+(D+1)).parents(".dataTables_scroll").find(".dataTables_scrollHeadInner,.dataTable").css("width","100%");r.dataSecondary[D].find("td.dataTables_empty").html(" ");e.dids=i(this).data("did");e.allIndex=i(this).index();u(e.allIndex,e.dids,code)});i("#tab-main .data").on("click",".dataTable tbody tr",function(){if(i(this).hasClass("row_selected")){return}a=false;i(this).addClass("row_selected").siblings().removeClass("row_selected");code=i(this).children("td").eq(1).html();u(e.allIndex,e.dids,code)});i("#tab-secondary .data").on("click",".dataTable tbody tr",function(){i(this).addClass("row_selected").siblings().removeClass("row_selected")});function A(C){if(i("#tab-main-datatable"+C+" tbody tr:first")){code=i("#tab-main-datatable"+C+" tbody tr:first").find("td").eq(1).html()}if(a){i("#tab-main-datatable"+C+" tbody tr:first").addClass("row_selected");u(e.allIndex,e.dids,code);a=false}}function u(F,E,D){if(F==0){Socket.send("service=did&did="+E+"&where=obj=IB"+D+""+suffix+"&response_times=1",function(I){var G=[];if(I.length<=0){G=[]}else{var H=I[0].obj.lastIndexOf(".");I[0].obj=I[0].obj.substring(2,H);I[0].data.datas.forEach(function(J){if(J[2]==0){J[2]="--"}else{J[2]=(J[2]/10000).toFixed(4)}if(J[1]==0){J[1]="--"}if(J[5]){if(J[5]==0){J[5]="--"}else{J[5]=(J[5]/10000).toFixed(4)}}if(s==0){J[0]=w(J[0].substr(8,6))}else{J[0]=J[0].slice(0,4)+"-"+J[0].slice(4,6)+"-"+J[0].slice(6,8)}J.unshift(I[0].obj)});G=I[0].data.datas}b=[];b=l(G);B(r.dataSecondary,F,b)})}if(F==1){var C=g(n(30));endDate=g(n(0));Socket.send(""+baseUrl+"/bond/bestPricesBetweenBanks/iBFundsController/"+E+".dzh?variety="+D+"&beginDate="+C+"&endDate="+endDate+"&report="+report+"",function(H){var G=[];G=l(p(H));if(r.dataSecondary[s]){r.dataSecondary[s].fnDestroy()}r.dataSecondary[s].dataTable({oLanguage:{sEmptyTable:"无数据"},aaData:G,sDom:"frtiS",bDeferRender:true,aaSorting:[[2,"desc"]],sScrollX:"99%",sScrollY:"100px",aoColumnDefs:[{bSortable:false,aTargets:[0]},{sClass:"my_right",aTargets:[11]}],fnDrawCallback:function(K){if(K.bSorted||K.bFiltered){for(var J=0,I=K.aiDisplay.length;J<I;J++){this.fnUpdate(J+1,K.aiDisplay[J],0,false,false)}}}});i("#tab-secondary-datatable"+(s+1)+"_wrapper div.dataTables_scrollHead").height(51);r.dataSecondary[s].fnDraw();r.dataSecondary[s].find("div.dataTables_scrollHeadInner").css({"padding-right":"20px"});r.dataSecondary[s].parent(".dataTables_scrollBody").height("-webkit-calc(100% - 50px)");i("#tab-secondary-datatable2_filter").css("display","none")})}}i("#tab-main form.filter-bar").on("click","a.btn-export-data",function(){var D=i("#tab"+(o+1)+"-select1").val(),C=i("#tab"+(o+1)+"-input11").val(),E=i("#tab"+(o+1)+"-input12").val();m(o,D,C,E)});function m(D,G,F,H){var E=g(F);var C=g(H);if(x=="getBuyBackHistoryInnerDayQuotation"){E=g(E)+"000000";C=g(C)+"999999"}if(x=="getIBLendingHistoryInnerDayQuotation"){E=F+" 00:00:00";C=H+" 23:59:59"}Socket.send(""+baseUrl+"/bond/bestPricesBetweenBanks/iBFundsController/"+x+".dzh?variety="+G+"&beginDate="+E+"&endDate="+C+"&report="+report+"",function(I){f=[];f=l(p(I));if(D==1){q=[];q=f}if(D==2){v=[];v=f}B(r.dataMain,D,f)})}function B(G,E,C){var D=G[E].fnSettings();G[E].oApi._fnClearTable(D);for(var F=0;F<C.length;F++){datatable_main[E].oApi._fnAddData(D,C[F])}G[E].fnDraw()}i("#tab-main .data").on("dblclick",".dataTable tbody tr",function(){var C="IB"+i(this).find("td").eq(1).html()+suffix;if(C){window.location="DZH://VIEWSTOCK?DATATYPE=DAY&LAYOUT=Level2默认&PAGE=分时走势&LABEL="+C+""}});i("#tab-main").on("click",".btn-export-excel",function(){var D="大智慧数据导出",E="数据导出"+(new Date()).getTime()+parseInt(Math.random()*100000);var C=["<html xmlns:x='urn:schemas-microsoft-com:office:excel'><head><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>"];C.push(D);C.push("</x:Name><x:WorksheetOptions><x:Panes></x:Panes></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--><meta http-equiv='content-type' content='text/html; charset=gbk'><style>.text { font-family:Arial;font-size:10pt;mso-number-format:'@';}</style></head>");C.push("<body>");C.push("<table width='100%' border='1' cellpadding='0' bordercolorlight='#999999' bordercolordark='#FFFFFF' cellspacing='0' align='center'>");C.push("<thead><tr>");C.push(i("#tab-main-datatable"+(o+1)+"_wrapper .dataTables_scrollHead .header-detail").html());C.push("</tr></thead><tbody>");C.push(i("#tab-main-datatable"+(o+1)+" tbody").html());C.push("</tbody></table>");C.push("</body>");if(window.external.saveas){window.external.saveas(C.join(""),E,"xls")}else{alert("请在大智慧客户端使用")}});function w(D){var C=/(\d{2})(\d{2})(\d{2})/;if(D==""){return D}else{return D.replace(C,"$1:$2:$3")}}function g(C){var D="";C.split("-").forEach(function(E){D+=E});return D}function l(E){for(var D=0;D<E.length;D++){var C=D+1;E[D].unshift(C)}return E}function p(D){var C=[];D.forEach(function(F){var G=[];for(var E in F){G.push(F[E])}C.push(G)});return C}function h(C,D){C.datepicker({onSelect:function(E){var F=c(C.eq(1).val(),C.eq(0).val()),G="日期区间不得超过"+(D+1)+"天";if(this===C[0]){if(F<0){C.eq(1).val(E)}if(F>D){alert(G);C.eq(1).val(t(E,-D))}}if(this===C[1]){if(F<0){C.eq(0).val(E)}if(F>D){alert(G);C.eq(0).val(t(E,D))}}}})}h(i("#tab2-input11,#tab2-input12"),29);h(i("#tab3-input11,#tab3-input12"),6);i("#tab2-input12").datepicker().datepicker("option",{maxDate:n(0)});i("#tab3-input12").datepicker().datepicker("option",{maxDate:n(0)});i("#tab2-input11").datepicker().datepicker("option",{maxDate:n(0)});i("#tab3-input11").datepicker().datepicker("option",{maxDate:n(0)});i("#tab2-input11").val(n(7));i("#tab2-input12").val(n(1));i("#tab3-input11").val(n(7));i("#tab3-input12").val(n(1));function n(D,F){var C=new Date(),I;var E=new Date(C.getFullYear(),C.getMonth(),C.getDate()-D);var H=E.getMonth()+1;if(H<10){H="0"+H}var J=E.getDate();var G=E.getFullYear();if(J<10){J="0"+J}I=G+"-"+H+"-"+J;if(F){I=G+H+J}return I}function t(E,D){var C=new Date(),F=null;C.setYear(parseInt(E.substring(0,4)));C.setMonth(parseInt(E.substring(5,7))-1);C.setDate(parseInt(E.substring(8,10)));return F=d(C,D)}function d(C,D){var G=C.getTime()-1000*60*60*24*D;var E=new Date();E.setTime(G);var F=E.getFullYear();var J=E.getMonth()+1;var H=E.getDate();if(H<10){H="0"+H}if(J<10){J="0"+J}var I=F+"-"+J+"-"+H;return I}function c(E,F){var H,D,C,G;H=E.split("-");D=new Date(H[1]+"-"+H[2]+"-"+H[0]);H=F.split("-");C=new Date(H[1]+"-"+H[2]+"-"+H[0]);G=parseInt((D-C)/1000/60/60/24);return G}})(jQuery);