var common=common||{};common={debug:false,v:[],getjson:function(data,f){return f?eval(data):eval("("+data+")")},Timeout:function(c,d,a){if(typeof d=="undefined"){d=0}var b=null;switch(c){case"location":b=function(){top.location.href=a};break;default:if(a&&typeof a==="function"){b=a}break}setTimeout(b,d)},isempty:function(b){b=$.trim(b);return(typeof(b)=="undefined"||b==undefined||b=="undefined"||b==null||b=="null"||b==""||!b)?true:false},changeURLPar:function(d,c,b){var e=c+"=([^&]*)";var a=c+"="+b;if(d.match(e)){tmp=d.replace(new RegExp(e,"gi"),a);return tmp}else{if(d.match("[?]")){return d+"&"+a}else{return d+"?"+a}}return d+"\n"+c+"\n"+b}};var Socket={root:window.external&&external.wsroot?external.wsroot:"ws://127.0.0.1:30718",queue:[],callbacks:[],waiting:false,instance:function(){if(this._instance===undefined){var b=this,a=["open","message","error","close"];this._instance=new WebSocket(this.root);a.forEach(function(c){b._instance.addEventListener(c,b)});addEventListener("unload",function(){b._instance.close();a.forEach(function(c){b._instance.removeEventListener(c,b)});removeEventListener("unload",arguments.callee)})}return this._instance},handleEvent:function(a){a.type in this&&this[a.type](a)},send:function(a,b){if(this.proxy.enable){this.proxy(a,b)}else{this.queue.push([a,b]);if(!this.waiting&&this.instance().readyState===1){this.subscribe()}}},subscribe:function(){this.waiting=true;this.instance().send("/json/subscribe?"+this.queue[0][0])},open:function(a){this.queue.length&&this.subscribe()},error:function(a){if(this.queue.length){this.queue.push(this.queue.shift());this.subscribe()}},message:function(d){var b=JSON.parse(d.data);if(b.res_seq==="0"){if(this.queue.length){this.callbacks[b.req_seq]=this.queue.shift()[1]}if(this.queue.length){this.subscribe()}else{this.waiting=false}}else{if(b.req_seq>0&&b.req_seq in this.callbacks){if(b.res_type>=0&&b.result&&b.result.datas&&b.result.head&&this.callbacks[b.req_seq]){var g=[],n=b.result.datas,f=n.length,h=b.result.head,k=h.length;for(var c=0;c<f;c++){var m=n[c],l={};for(var a=0;a<k;a++){l[h[a]]=m[a]}g.push(l)}this.callbacks[b.req_seq]({results:g})}else{this.callbacks[b.req_seq]({results:null})}delete this.callbacks[b.req_seq]}}},close:function(){this.queue.length=0;for(var a in this.queue.callbacks){delete this.queue.callbacks[a]}},proxy:function(b,c){var a=new WebSocket(this.root);a.addEventListener("open",function(d){d.target.send("/proxy/"+b)});a.addEventListener("message",function(f){var d=JSON.parse(f.data);c(d)});a.addEventListener("error",function(d){d.target.close();c({results:[]})})},phpProxy:function(b,c){var a=new WebSocket(this.root);a.addEventListener("open",function(d){d.target.send("/proxy/"+b)});a.addEventListener("message",function(f){var d=JSON.parse(f.data);c(d)});a.addEventListener("error",function(d){d.target.close();c({results:[]})})},read:function(b,d,c){var a=new WebSocket(this.root);b=true==c?"dzh2url?"+b:"dzh2data?"+b;a.addEventListener("open",function(f){f.target.send(b)});a.addEventListener("message",function(g){var f=g;d(f)});a.addEventListener("error",function(f){f.target.close();d({results:[]})})},soSend:function(e,g,d,f){var b=new WebSocket(this.root);var a=this.soHandle(g);var c="/json/subscribe?service=rpc&async_response_mode=0&paraencode=base64&function="+d+"&parameter="+a+"&so="+e+"&field=&where=&start=1&count=0&response_times=1&response_mode=0";b.addEventListener("open",function(h){h.target.send(c)});b.addEventListener("message",function(i){var h=JSON.parse(i.data);if(h.result!==undefined){f(h)}});b.addEventListener("error",function(h){h.target.close();f({results:[]})})},soHandle:function(c){var b="";for(var a in c){b+=btoa(c[a])+","}return b.substring(0,b.length-1)},speSend:function(b,c){var a=new WebSocket(this.root);a.addEventListener("open",function(d){d.target.send("/json/subscribe?"+b)});a.addEventListener("message",function(f){var d=JSON.parse(f.data);c(d)});a.addEventListener("error",function(d){d.target.close();c({results:[]})})}};Socket.proxy.enable=false;