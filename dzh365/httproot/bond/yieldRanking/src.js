define("model_base",["observable","jquery"],function(e){return e.extend({})}),define("models/security",["model_base","formatter"],function(e,t){return e.extend(function(e){$.extend(this,e),this.symbol=t.fixSymbol(this.obj)},{obj:"",name:"--",update:function(e){for(var t in e)("new"!==t||0!=e[t])&&(this[t]=isNaN(Number(e[t]))?e[t]:Number(e[t]));this.calculate(),this.emit("updated")},calculate:function(){this.lastTrade=t.fixLastTrade(this),this.change=t.fixChange(this),this.chg=t.fixChg(this),this.price=t.fixPrice(this),this.deadline=t.fixDeadline(this),this.repurchase=t.fixRepurchase(this),this.lastyear=t.fixLastyear(this),this.previousyear=t.fixPreviousyear(this)}})}),define("repositories/security",["repository_base","../models/security"],function(e,t){return e.extend({getInfo:function(e,t){return 1===arguments.length&&(t=e,e="new,lastclose"),$.send("/objinfo/getinfo",{field:e,where:"obj="+t})},getQuotes:function(e,t,i){switch(arguments.length){case 1:i=e,t="new,lastclose",e=void 0;break;case 2:i=t,t=e,e=void 0}return $.send(e?"/did?did="+e:"/quote/dyna",{field:t,where:"obj="+i,response_mode:0,response_times:-1})},getBlockInfo:function(e){return $.send({service:"blockinfo",type:e?"leaf":"sub",source:"local",block:e||"自选股",depth:1},{after:function(e){return e.map(function(e){return new t({obj:e.stockid,name:e.stockname})})}})},getData:function(e){return $.send("/rpc",{so:"jso-html5-bondprofit.jar","function":"gw.sh.func.BondProfitSortRequest",paraencode:"base64",parameter:(external.base64encode||btoa)(JSON.stringify(e))})},getYtm:function(){return $.send("/did",{did:100012,fullmarket:1,where:"obj=SH,SZ",field:"ytm,adjifiedduration",response_mode:0,response_times:-1})},getCodeYtm:function(e){return $.send("/did",{did:100012,where:"obj="+e,field:"ytm,adjifiedduration"})}})}),define("models/deliverable",["./security"],function(e){return e.extend({bond:new e,rate:new e,regDate:new RegExp("(\\d\\d)(\\d\\d)$"),getIRR:function(e){var t=Number(this[e])+Number(this.tradeDateAccruedInterest),i=this.bond.lastTrade*Number(this.conversionFactor)+Number(this.deliveryDateAccruedInterest),n=new Date(this.valueDate.replace(this.regDate,"-$1-$2")),s=new Date(this.tradeDate.replace(this.regDate,"-$1-$2")),a=new Date(this.deliveryDate.replace(this.regDate,"-$1-$2")),r=0,o=0,u=Number(this.couponRate),l=Number(this.paymentFrequency),d=(a-s)/864e5;for(s.getFullYear()-n.getFullYear()&&n.setFullYear(s.getFullYear()-1);a>n;)n.setMonth(n.getMonth()+12/l),n>s&&a>n&&(r+=u/l,o+=r*((a-n)/864e5)/d);return(i-t+r)*(365/d)/(t-o)*100},getBSS:function(e){return Number(this[e])-Number(this.bond.lastTrade)*Number(this.conversionFactor)},getBNOC:function(e){var t=Number(this[e])+Number(this.tradeDateAccruedInterest),i=this.bond.lastTrade*Number(this.conversionFactor)+Number(this.deliveryDateAccruedInterest),n=new Date(this.tradeDate.replace(this.regDate,"-$1-$2")),s=new Date(this.deliveryDate.replace(this.regDate,"-$1-$2")),a=(s-n)/864e5;return t*(1+Number(this.rate.lastTrade/100)*a/365)-i}})}),define("repositories/bond",["./security","../models/security","../models/deliverable"],function(e){return new(e.extend({getBonds:function(){return this.getBlockInfo("上证债券,上证小公募,深证债券,深证小公募")}}))}),define("presenters/index",["presenter_base","../repositories/bond","topic","vue"],function(e,t,i,n){return e.extend(function(){this.view.on("tabActive",this.onTabActive.bind(this))},{onInit:function(){this.index=0,this.createViewModel(),this.govt.$on("filtersChange",this.onFiltersGovt.bind(this)),this.view.renderFilters(this.govt,0);var e=[];this.view.renderGovtGrid(e),t.getBonds().then(function(e){this.view.renderGovtGrid(e),0==this.getCode(e).length&&this.view.govtGrids.setRows(this.view.govtGrids.items.filter(function(e){return e.volume>0&&"政府债"==e.c10}));var t=this.view.govtGrids;this.first=!0,t.promises[0].then(function(){var e=[];t.promises[1].progress(function(i){this.addItems(i,t,e)}.bind(this))}.bind(this)),setTimeout(function(){this.view.displayNone()}.bind(this),1e4)}.bind(this),function(){location.reload()}.bind(this))},onTabActive:function(e){this.index=e,0==e?this.view.govtGrids.setRows(this.view.govtGrids.items.filter(function(e){return e.volume>0&&"政府债"==e.c10})):(this.firm.$on("filtersChange",this.onFiltersFirm.bind(this)),this.view.renderFilters(this.firm,1),this.view.renderFirmGrid(this.view.govtGrids.items),this.view.firmGrids.setRows(this.view.govtGrids.items.filter(function(e){return e.volume>0&&"公司债"==e.c10})))},addItems:function(e,t,i){if(0==i.length&&setTimeout(function(){i.length&&(this.updateItems(i,t),i.length=0)}.bind(this),100),e.length)for(var n=0,s=e.length;s>n;n++)e[n].volume>0&&void 0==t.items[e[n].obj].ytm&&i.push(e[n])},updateItems:function(e,i){if(e.length){var n=this.getCode(e);$.when(t.getCodeYtm(n).then(function(e){for(var n=0,s=e.length;s>n;n++)void 0!=i.items[e[n].obj]&&i.items[e[n].obj].update(e[n]);this.ytm&&this.ytm.cancel(),this.ytm=t.getYtm().progress(function(e){for(var t=0,n=e.length;n>t;t++)void 0!=i.items[e[t].obj]&&i.items[e[t].obj].update(e[t])})}),t.getData({type:"2",code:n}).then(function(e){for(var t=0,n=e.length;n>t;t++)i.items[e[t].co1].update(e[t])})).then(function(){this.first&&this.view.displayNone(),this.first=!1,0==this.index&&this.onFiltersGovt(this.govt),1==this.index&&this.onFiltersFirm(this.firm)}.bind(this))}},getCode:function(e){var t=[],i=0;if(e)for(key in e)e[key].volume>0&&(t[i]=e[key].obj,i++);return t},onFiltersGovt:function(e){var t=[];e.values.deadline0&&e.values.deadline0.length>0&&t.push("(item.deadline)>="+e.values.deadline0),e.values.deadline1&&e.values.deadline1.length>0&&t.push("(item.deadline)<="+e.values.deadline1),e.values.yield0&&e.values.yield0.length>0&&t.push("(item.ytm*100)>="+e.values.yield0),e.values.yield1&&e.values.yield1.length>0&&t.push("(item.ytm*100)<="+e.values.yield1),e.values.amount0&&e.values.amount0.length>0&&t.push("(item.amount)>="+1e4*e.values.amount0),e.values.amount1&&e.values.amount1.length>0&&t.push("(item.amount)<="+1e4*e.values.amount1),e.values.convert0&&e.values.convert0.length>0&&t.push("(item.c12)>="+e.values.convert0),e.values.convert1&&e.values.convert1.length>0&&t.push("(item.c12)<="+e.values.convert1),e.conditions.market&&e.conditions.market.length>0&&t.push("(item.c2)=="+e.conditions.market),e.conditions.lastyear&&e.conditions.lastyear.length>0&&t.push("(item.lastyear)=="+e.conditions.lastyear),e.conditions.previousyear&&e.conditions.previousyear.length>0&&t.push("(item.previousyear)=="+e.conditions.previousyear),t.length?(t.push("(item.c10)=='政府债'"),this.view.govtGrids.setRows(this.view.govtGrids.items.filter(new Function("item","return "+t.join("&&"))))):this.view.govtGrids.setRows(this.view.govtGrids.items.filter(function(e){return e.volume>0&&"政府债"==e.c10}))},onFiltersFirm:function(e){var t=[];e.values.deadline0&&e.values.deadline1&&e.values.deadline0>e.values.deadline1?t.push("1>2"):e.values.deadline0&&e.values.deadline1?t.push("((item.c5)>="+e.values.deadline0+"&&(item.c5)<="+e.values.deadline1+")||((item.c6)>="+e.values.deadline0+"&&(item.c6)<="+e.values.deadline1+")"):(e.values.deadline0&&e.values.deadline0.length>0&&t.push("((item.c5)>="+e.values.deadline0+"||(item.c6)>="+e.values.deadline0+")"),e.values.deadline1&&e.values.deadline1.length>0&&t.push("((item.c5)<="+e.values.deadline1+"||(item.c6)<="+e.values.deadline1+")")),e.values.yield0&&e.values.yield0.length>0&&t.push("(item.ytm*100)>="+e.values.yield0),e.values.yield1&&e.values.yield1.length>0&&t.push("(item.ytm*100)<="+e.values.yield1),e.conditions.Bond0&&e.conditions.Bond0.length>0&&t.push("(item.c25)>="+e.conditions.Bond0),e.conditions.Bond1&&e.conditions.Bond1.length>0&&t.push("(item.c25)<="+e.conditions.Bond1),e.conditions.Subject0&&e.conditions.Subject0.length>0&&t.push("(item.c26)>="+e.conditions.Subject0),e.conditions.Subject1&&e.conditions.Subject1.length>0&&t.push("(item.c26)<="+e.conditions.Subject1),e.values.amount0&&e.values.amount0.length>0&&t.push("(item.amount)>="+1e4*e.values.amount0),e.values.amount1&&e.values.amount1.length>0&&t.push("(item.amount)<="+1e4*e.values.amount1),e.values.convert0&&e.values.convert0.length>0&&t.push("(item.c12)>="+e.values.convert0),e.values.convert1&&e.values.convert1.length>0&&t.push("(item.c12)<="+e.values.convert1),e.conditions.market&&e.conditions.market.length>0&&t.push("(item.c2)=="+e.conditions.market),e.conditions.assure&&e.conditions.assure.length>0&&t.push("(item.c21)=="+e.conditions.assure),e.conditions.lastyear&&e.conditions.lastyear.length>0&&t.push("(item.lastyear)=="+e.conditions.lastyear),e.conditions.previousyear&&e.conditions.previousyear.length>0&&t.push("(item.previousyear)=="+e.conditions.previousyear),1==e.provisions&&t.push("(item.c22)=='否'"),t.length?(t.push("(item.c10)=='公司债'"),this.view.firmGrids.setRows(this.view.firmGrids.items.filter(new Function("item","return "+t.join("&&"))))):this.view.firmGrids.setRows(this.view.firmGrids.items.filter(function(e){return e.volume>0&&"公司债"==e.c10}))},createViewModel:function(){this.govt=new n({data:{conditions:{market:"",lastyear:"",previousyear:""},values:{deadline0:"",deadline1:"",yield0:"",yield1:"",amount0:"",amount1:"",convert0:"",convert1:""},options1:[{text:"全部 ",value:""},{text:"上交所",value:"'上交所'"},{text:"深交所",value:"'深交所'"}],options2:[{text:"全部",value:""},{text:"盈",value:"'盈'"},{text:"亏",value:"'亏'"}]},methods:{filtersChange:function(){n.nextTick(function(){var e=!0;for(var t in this.values)isNaN(this.values[t])&&(this.values[t]=this.values[t].replace(/[^-.0-9]/g,"").replace(/(.)-+/g,"$1").replace(/\.(\d+)?\.*/g,".$1"),(!this.values[t].length||isNaN(this.values[t]))&&(e=!1));e&&this.$emit("filtersChange",this.$data)}.bind(this))}}}),this.firm=new n({data:{conditions:{Bond0:"",Bond1:"",Subject0:"",Subject1:"",assure:"",market:"",lastyear:"",previousyear:""},values:{deadline0:"",deadline1:"",yield0:"",yield1:"",amount0:"",amount1:"",convert0:"",convert1:""},options0:[{text:"全部",value:""},{text:"抵押担保",value:"'抵押担保'"},{text:"质押担保",value:"'质押担保'"},{text:"第三方担保",value:"'第三方担保'"},{text:"无",value:"'无'"}],options1:[{text:"全部",value:""},{text:"上交所",value:"'上交所'"},{text:"深交所",value:"'深交所'"}],options2:[{text:"全部",value:""},{text:"盈",value:"'盈'"},{text:"亏",value:"'亏'"}],options3:[{text:"全部",value:""},{text:"AAA",value:"21"},{text:"AA+",value:"20"},{text:"AA",value:"19"},{text:"AA-",value:"18"},{text:"A+",value:"17"},{text:"A",value:"16"},{text:"A-",value:"15"},{text:"BBB",value:"14"},{text:"BB+",value:"13"},{text:"BB",value:"12"},{text:"BB-",value:"11"},{text:"B+",value:"10"},{text:"B",value:"9"},{text:"B-",value:"8"},{text:"CCC",value:"7"},{text:"CC+",value:"6"},{text:"CC",value:"5"},{text:"CC-",value:"4"},{text:"C+",value:"3"},{text:"C",value:"2"},{text:"C-",value:"1"}]},provisions:!0,methods:{filtersChange:function(){n.nextTick(function(){var e=!0;for(var t in this.values)isNaN(this.values[t])&&(this.values[t]=this.values[t].replace(/[^-.0-9]/g,"").replace(/(.)-+/g,"$1").replace(/\.(\d+)?\.*/g,".$1"),(!this.values[t].length||isNaN(this.values[t]))&&(e=!1));e&&this.$emit("filtersChange",this.$data)}.bind(this))}}})}})}),define("views/index",["view_base","../presenters/index","fast_grid","active_grid","quotes_grid","tabs","dialog","select"],function(e,t,i,n,s){var a=e.extend(function(){this.tabs.on("active",this.onTabActive.bind(this))},{onTabActive:function(e,t){var n=e.currentTarget.widget.panes.eq(t).widget();n instanceof i?n.refresh():this.emit("tabActive",t)},renderFilters:function(e,t){e.$mount(this.form[t]),this.form.eq(t).find("select").widget("select")},renderGovtGrid:function(e){var t=0,i=this.grids[t].widget;i?(i.selectedItem=void 0,i.setItems(e)):this.govtGrids=new s(this.grids[t],{limit:9999,fields:["new,lastclose,amount,volume"],columns:[{width:"50",name:"序号",sort:!0,value:function(e,t){return t+1}},{width:"70",name:"代码",css:"blue l",sort:!0,value:function(e){return'<a href="dzh://VIEWSTOCK?DATATYPE=DAY&LAYOUT=Level2默认&PAGE=分时走势&LABEL='+e.obj+'">'+e.symbol+"</a>"}},{width:"75",name:"简称",css:"yellow l",sort:!0,title:!0,value:function(e){return'<a href="dzh://VIEWSTOCK?DATATYPE=DAY&LAYOUT=Level2默认&PAGE=分时走势&LABEL='+e.obj+'">'+e.name+"</a>"}},{width:"75",name:"最新",color:!0,sort:!0,value:function(e){return this.fixFloat(e.new,3)}},{width:"95",name:"收益率%",sort:!0,order:"desc",value:function(e){return this.fixFloat(100*e.ytm,4)}},{width:"95",name:"全价",sort:!0,value:function(e){return this.fixFloat(e.price,3)}},{width:"75",name:"涨跌幅%",color:!0,sort:!0,value:function(e){return this.fixFloat(e.chg)}},{width:"100",name:"剩余期限<span title='债券持有到期的期限，对于部分含提前赎回或&#10;回售的债券是持有至下一行权日的期限。采用&#10;X+Y的表示方式，例如4.5/2.5表示债券剩余&#10;4.5年到期,2.5表示剩余2.5年行权。'><span class='icon-landmine'></span></span>",sort:!0,value:function(e){return this.fixStr(e.deadline)}},{width:"95",name:"修正久期",sort:!0,value:function(e){return this.fixFloat(e.adjifiedduration,2)}},{width:"110",name:"金额(万)",sort:!0,value:function(e){return this.fixFloat(e.amount/1e4,2)}},{width:"85",name:"票面利率%",sort:!0,value:function(e){return this.fixFloat(e.c9,2)}},{width:"100",name:"债券类型",css:"white",sort:!0,value:function(e){return this.fixStr(e.c10)}},{width:"105",name:"债券期限<span title='对于部分含提前赎回或回售的债券，采用X+Y&#10;的表示方式，例如5+2表示债券在第5年末有赎&#10;回或回售权，若不行权，则剩余2年债券到期；&#10;对于部分含有本金提前偿还条款的债券，显示&#10;提前还本。'><span class='icon-landmine'></span></span> ",css:"white",sort:!0,value:function(e){return this.fixStr(e.c11,2)}},{width:"85",name:"上市市场",css:"white",sort:!0,value:function(e){return this.fixStr(e.c2)}},{width:"100",name:"折算率",css:"white",sort:!0,value:function(e){return this.fixFloat(0==e.c12?"—":e.c12,2)}},{width:"110",name:"回购利用率%<span title='公式=剩余面值*折算比例/全价*100%，&#10;保留2位小数。'><span class='icon-landmine'></span></span> ",css:"white",sort:!0,value:function(e){return this.fixFloat(0==e.repurchase?"—":e.repurchase,2)}},{width:"85",name:"下一付息日",css:"white",sort:!0,value:function(e){return this.fixTime(e.c13,"Y-M-d")}},{width:"100",name:"规模(亿)",css:"white",sort:!0,value:function(e){return this.fixFloat(e.c14,2)}},{width:"100",name:"去年买<span title='去年年初买入债券并只有至今的盈亏，&#10;最新全价-买入全价+期间付息金额*0.8。&#10;比如2015-8-31，则去年买入指在2014&#10;年1月1日买入。'><span class='icon-landmine'></span></span> ",css:"white",sort:!0,value:function(e){return e.lastyear}},{width:"100",name:"前年买<span title='指前年年初买入债券并持有至今的盈亏，&#10;最新全价-买入全价+期间付息金额*0.8。&#10;比如2015-8-831，则前年买入指在2013&#10;年1月1日买入。' ><span class='icon-landmine'></span></span>",css:"white",sort:!0,value:function(e){return e.previousyear}}],items:e,onDblClick:function(e){location.assign($(e.currentTarget).find("a").attr("href"))}})},renderFirmGrid:function(e){var t=1,i=this.grids[t].widget;i?(i.selectedItem=void 0,i.setItems(e)):(this.firmGrids=new s(this.grids[t],{limit:9999,columns:[{width:"50",name:"序号",sort:!0,value:function(e,t){return t+1}},{width:"70",name:"代码",css:"blue l",sort:!0,value:function(e){return'<a href="dzh://VIEWSTOCK?DATATYPE=DAY&LAYOUT=Level2默认&PAGE=分时走势&LABEL='+e.obj+'">'+e.symbol+"</a>"}},{width:"75",name:"简称",css:"yellow l",sort:!0,title:!0,value:function(e){return'<a href="dzh://VIEWSTOCK?DATATYPE=DAY&LAYOUT=Level2默认&PAGE=分时走势&LABEL='+e.obj+'">'+e.name+"</a>"}},{width:"75",name:"最新",color:!0,sort:!0,value:function(e){return this.fixFloat(e.new,3)}},{width:"95",name:"收益率%",sort:!0,order:"desc",value:function(e){return this.fixFloat(100*e.ytm,4)}},{width:"95",name:"全价",sort:!0,value:function(e){return this.fixFloat(e.price,3)}},{width:"75",name:"涨跌幅%",color:!0,sort:!0,value:function(e){return this.fixFloat(e.chg)}},{width:"100",name:"剩余期限<span title='债券持有到期的期限，对于部分含提前赎回或&#10;回售的债券是持有至下一行权日的期限。采用&#10;X+Y的表示方式，例如4.5/2.5表示债券剩余&#10;4.5年到期,2.5表示剩余2.5年行权。'><span class='icon-landmine'></span></span>",sort:!0,value:function(e){return this.fixStr(e.deadline)}},{width:"95",name:"修正久期",sort:!0,value:function(e){return this.fixFloat(e.adjifiedduration,2)}},{width:"110",name:"金额(万)",sort:!0,value:function(e){return this.fixFloat(e.amount/1e4,2)}},{width:"85",name:"票面利率%",sort:!0,value:function(e){return this.fixFloat(e.c9,2)}},{width:"100",name:"债券类型",css:"white",sort:!0,value:function(e){return this.fixStr(e.c10)}},{width:"100",name:"债券评级",css:"white",sort:!0,value:function(e){return 0==e.c19?"—":e.c19}},{width:"100",name:"主体评级",css:"white",sort:!0,value:function(e){return 0==e.c20?"—":e.c20}},{width:"100",name:"担保方式",css:"white",sort:!0,title:!0,value:function(e){return e.c21}},{width:"105",name:"债券期限<span title='对于部分含提前赎回或回售的债券，采用X+Y&#10;的表示方式，例如5+2表示债券在第5年末有赎&#10;回或回售权，若不行权，则剩余2年债券到期；&#10;对于部分含有本金提前偿还条款的债券，显示&#10;提前还本。'><span class='icon-landmine'></span></span> ",css:"white",sort:!0,value:function(e){return this.fixStr(e.c11,2)}},{width:"85",name:"上市市场",css:"white",sort:!0,value:function(e){return this.fixStr(e.c2)}},{width:"100",name:"折算率",css:"white",sort:!0,value:function(e){return this.fixFloat(0==e.c12?"—":e.c12,2)}},{width:"110",name:"回购利用率%<span title='公式=剩余面值*折算比例/全价*100%，&#10;保留2位小数。'><span class='icon-landmine'></span></span> ",css:"white",sort:!0,value:function(e){return this.fixFloat(0==e.repurchase?"—":e.repurchase,2)}},{width:"85",name:"下一付息日",css:"white",sort:!0,value:function(e){return this.fixTime(e.c13,"Y-M-d")}},{width:"100",name:"规模(亿)",css:"white",sort:!0,value:function(e){return this.fixFloat(e.c14,2)}},{width:"100",name:"去年买<span title='去年年初买入债券并只有至今的盈亏，&#10;最新全价-买入全价+期间付息金额*0.8。&#10;比如2015-8-31，则去年买入指在2014&#10;年1月1日买入。'><span class='icon-landmine'></span></span> ",css:"white",sort:!0,value:function(e){return e.lastyear}},{width:"100",name:"前年买<span title='指前年年初买入债券并持有至今的盈亏，&#10;最新全价-买入全价+期间付息金额*0.8。&#10;比如2015-8-831，则前年买入指在2013&#10;年1月1日买入。' ><span class='icon-landmine'></span></span>",css:"white",sort:!0,value:function(e){return e.previousyear}}],items:e,onDblClick:function(e){location.assign($(e.currentTarget).find("a").attr("href"))}}),this.grids.eq(0).widget().on("changed",function(){this.refresh(!0)}.bind(this.grids.eq(1).widget())))},displayNone:function(){$(".icon-loading").css("display","none")}});return a.init=function(){new t(new this({root:$(document),form:$("form"),grids:$(".grid"),chart:$("iframe.flex-auto"),tabs:$(".nav-tabs"),govtGrids:[],firmGrids:[]}))},a}),require(["views/index"],function(){require(["views/"+(location.pathname.match(/([^\/]+)\.html/)||[,"index"])[1]],function(){arguments[0]&&arguments[0].init&&arguments[0].init()})}),define("src",function(){});