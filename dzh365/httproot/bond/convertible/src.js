define("repositories/bond",["repository_base"],function(t){return new(t.extend({getInfo:function(t,e){return 1===arguments.length&&(e=t,t="new,lastclose"),$.send("/objinfo/getinfo",{field:t,where:"obj="+e})},getQuotes:function(t,e,i){switch(arguments.length){case 1:i=t,e="new,lastclose",t=void 0;break;case 2:i=e,e=t,t=void 0}return $.send(t?"/did?did="+t:"/quote/dyna",{field:e,where:"obj="+i,response_mode:0,response_times:-1})},getConvertibleBonds:function(){return $.send("/bond/convertibleBonds/getRealTimeAnalyzeList.dzh",{},{before:function(t){return t.head=["bond_obj","A2","A3","stock_obj","A5","A6","A7","A8","A9","A10","A11","A12","A13","A14","A15","A16","A17","A18","A19","A20","A21","A22","A23","A24","A25","A26","A27","A28","A29","A30","A31","A32"],t}})}}))}),define("presenters/index",["presenter_base","topic","../repositories/bond"],function(t,e,i){return t.extend(function(){this.view.on("tabActive",this.onTabActive.bind(this))},{onInit:function(){i.getConvertibleBonds().then(function(t){this.subscribe(t).then(function(){this.onTabActive(0)}.bind(this))}.bind(this),function(){location.reload()})},onTabActive:function(t){this.items&&this.view.renderPane(t,this.items)},subscribe:function(t){return this.items=t,this.bond_keys=[],this.stock_keys=[],this.items.forEach(function(t){this.items[t.bond_obj]=t,this.items[t.stock_obj]=t,this.bond_keys.push(t.bond_obj),this.stock_keys.push(t.stock_obj)},this),i.getInfo(this.bond_keys.concat(this.stock_keys)).then(function(t){this.updateItems(t),i.getQuotes(this.bond_keys.concat(this.stock_keys)).progress(this.updateItems.bind(this)),i.getQuotes(100012,"bondchange,conversionpremiumratio,ValueOfNetDebt,ytm",this.bond_keys).progress(this.updateItems.bind(this))}.bind(this))},updateItems:function(t){t.length&&(t.forEach(function(t){var e=this.items[t.obj],i=t.obj.indexOf(".bond")>-1?"bond_":"stock_";for(var n in t)("new"!==n||0!=e[n])&&(e[i+n]=isNaN(Number(t[n]))?t[n]:Number(t[n]));e.arbitrage=e.bond_bondchange?(e.stock_new||e.stock_lastclose)-(e.bond_new||e.bond_lastclose)*e.A7/100:0/0,e.conversion=((e.bond_new||e.bond_lastclose)-e.bond_bondchange)/e.bond_bondchange*100,e.bond=((e.bond_new||e.bond_lastclose)-e.bond_ValueOfNetDebt)/e.bond_ValueOfNetDebt*100,e.expire=100*e.bond_ytm},this),e.emit("updated"))}})}),define("presenters/contrast",["presenter_base","topic","vue"],function(t,e,i){return t.extend({init:function(){this.createViewModel(),this.vm.$on("filtersChange",this.onFiltersChange.bind(this)),e.on("updated",this.view.renderGrid.bind(this.view))},onInit:function(){this.view.renderFilters(this.vm),this.view.renderGrid(this.items),this.view.renderDefaultCharts()},onFiltersChange:function(t){var e=[];for(var i in t.conditions)t.conditions[i].length&&t.values[i].length&&!isNaN(t.values[i])&&e.push("(item."+i+").toFixed(4)"+t.conditions[i]+Number(t.values[i]));e.length?this.view.quotesGrid.setRows(this.items.filter(new Function("item","return "+e.join("&&")))):this.view.quotesGrid.setRows()},createViewModel:function(){this.vm=new i({data:{conditions:{arbitrage:"",conversion:"",bond:"",expire:""},values:{arbitrage:"",conversion:"",bond:"",expire:""},options:[{text:"全部",value:""},">",">=","<","<=",{text:"=",value:"=="}]},methods:{filtersChange:function(){i.nextTick(function(){var t=!0;for(var e in this.conditions)this.conditions[e].length?isNaN(this.values[e])&&(this.values[e]=this.values[e].replace(/[^-.0-9]/g,"").replace(/(.)-+/g,"$1").replace(/\.(\d+)?\.*/g,".$1"),(!this.values[e].length||isNaN(this.values[e]))&&(t=!1)):this.values[e]="";t&&this.$emit("filtersChange",this.$data)}.bind(this))}}})}})}),define("views/contrast",["view_base","../presenters/contrast","active_grid","splitter","tabs","select"],function(t,e,i){var n=t.extend(function(){this.splitter.on("move",this.onSplitterMove.bind(this))},{onSplitterMove:function(){this.quotesGrid&&this.quotesGrid.refresh()},onGridSelectItem:function(t,e){this.renderCharts(e.bond_obj,e.stock_obj)},renderFilters:function(t){t.$mount(this.form[0]),this.form.find("select").widget("select")},renderGrid:function(t){t?this.quotesGrid=new i(this.grid[0],{columns:[{width:"40",name:"序号",css:"white c",value:function(t,e){return e+1}},{width:"85",name:"转债代码",css:"blue c",sort:!0,value:function(t){return'<a href="dzh://VIEWSTOCK?DATATYPE=DAY&LAYOUT=Level2默认&PAGE=分时走势&LABEL='+t.bond_obj+'">'+t.A2+"</a>"}},{width:"85",name:"转债简称",css:"c",sort:!0,value:function(t){return'<a href="dzh://VIEWSTOCK?DATATYPE=DAY&LAYOUT=Level2默认&PAGE=分时走势&LABEL='+t.bond_obj+'">'+t.A3+"</a>"}},{width:"70",name:"最新价",color:function(t){return this.fixColor(this.fixChange(t.bond_new,t.bond_lastclose),3)},sort:!0,value:function(t){return this.fixValue(this.fixLastTrade(t.bond_new,t.bond_lastclose),3)}},{width:"70",name:"涨跌幅",order:"desc",color:function(t){return this.fixColor(this.fixChange(t.bond_new,t.bond_lastclose),3)},sort:!0,value:function(t){return this.fixPercent(this.fixChg(t.bond_new,t.bond_lastclose))}},{width:"85",name:"正股代码",css:"blue c",sort:!0,value:function(t){return'<a href="dzh://VIEWSTOCK?DATATYPE=DAY&LAYOUT=Level2默认&PAGE=分时走势&LABEL='+t.stock_obj+'">'+t.A5+"</a>"}},{width:"85",name:"正股简称",css:"c",sort:!0,value:function(t){return'<a href="dzh://VIEWSTOCK?DATATYPE=DAY&LAYOUT=Level2默认&PAGE=分时走势&LABEL='+t.stock_obj+'">'+t.A6+"</a>"}},{width:"70",name:"最新价",color:function(t){return this.fixColor(this.fixChange(t.stock_new,t.stock_lastclose))},sort:!0,value:function(t){return this.fixValue(this.fixLastTrade(t.stock_new,t.stock_lastclose))}},{width:"70",name:"涨跌幅",color:function(t){return this.fixColor(this.fixChange(t.stock_new,t.stock_lastclose))},sort:!0,value:function(t){return this.fixPercent(this.fixChg(t.stock_new,t.stock_lastclose))}},{width:"85",name:"转股价值",css:"white",sort:!0,value:function(t){return this.fixFloat(t.bond_bondchange,2)}},{width:"85",name:"套利空间",sort:!0,value:function(t){return this.fixFloat(t.arbitrage,2)}},{width:"100",name:"转股溢价率",css:"white",sort:!0,value:function(t){return this.fixPercent(t.conversion,2)}},{width:"85",name:"纯债价值",css:"white",sort:!0,value:function(t){return this.fixFloat(t.bond_ValueOfNetDebt,4)}},{width:"85",name:"纯债溢价",css:"white",sort:!0,value:function(t){return this.fixFloat(this.fixLastTrade(t.bond_new,t.bond_lastclose)-t.bond_ValueOfNetDebt,2)}},{width:"100",name:"纯债溢价率",css:"white",sort:!0,value:function(t){return this.fixPercent(t.bond,2)}},{width:"100",name:"到期收益率",css:"white",sort:!0,value:function(t){return this.fixPercent(t.expire,4)}},{width:"85",name:"股性债性",css:"white",sort:!0,value:function(t){var e=(this.fixLastTrade(t.bond_new,t.bond_lastclose)-t.bond_ValueOfNetDebt)/t.bond_ValueOfNetDebt-(this.fixLastTrade(t.bond_new,t.bond_lastclose)-t.bond_bondchange)/t.bond_bondchange;return isNaN(e)?"－":-.1>e?"偏债型":e>.1?"偏股型":"平衡型"}},{width:"auto",name:"",value:function(){return""}}],items:t,onSelectItem:this.onGridSelectItem.bind(this),compare:function(t){return function(t,e){return this(t,e)||t.bond_obj.localeCompare(e.bond_obj)}.bind(this.base(t))}}):this.visible&&this.quotesGrid&&this.quotesGrid.refresh(!0)},renderCharts:function(t,e){"about:blank"===this.charts[1].src?this.charts.eq(0).one("load",function(){this.charts.eq(1).attr("src","/platform/charts/index.html#"+e)}.bind(this)).attr("src","/platform/charts/index.html#"+t):(this.charts.eq(0).attr("src","/platform/charts/index.html#"+t),this.charts.eq(1).attr("src","/platform/charts/index.html#"+e))},renderDefaultCharts:function(){if(this.quotesGrid){var t=this.quotesGrid.getItem(0);t&&this.renderCharts(t.bond_obj,t.stock_obj)}}});return n.init=function(t,i){var n=new this({form:t.find("form"),grid:t.find(".grid"),charts:t.find("iframe"),splitter:t.find(".flex-splitter")}),s=new e(n);return s.items=i,n},n}),define("presenters/scatter",["presenter_base","topic"],function(t,e){return t.extend({init:function(){e.on("updated",this.updateItems.bind(this))},onInit:function(){this.updateItems()},updateItems:function(){if(this.items){var t=[];this.items.forEach(function(t){!isNaN(t.conversion)&&!isNaN(t.bond)&&1/0!==t.conversion&&1/0!==t.bond&&this.push({name:t.A3,x:Number(t.conversion.toFixed(4)),y:Number(t.bond.toFixed(4))})},t),this.view.renderScatter(t)}}})}),define("views/scatter",["view_base","../presenters/scatter","highcharts"],function(t,e){var i=t.extend(function(){addEventListener("resize",this.onResize.bind(this)),this.time=new Date,this.span=0},{onResize:function(){this.scatter&&(cancelAnimationFrame(this.requestId),this.requestId=requestAnimationFrame(function(){var t=this.getSize();this.scatter.setSize(t.width,t.height,!1)}.bind(this)))},getSize:function(){var t={width:this.chart.width(),height:this.chart.height()};return t.width/t.height>1.5?t.width=1.5*t.height:t.height=t.width/1.5,t},renderScatter:function(t){if(this.scatter){var e=new Date;this.span+=e-this.time,this.time=e,clearTimeout(this.timeoutId),this.timeoutId=setTimeout(function(){this.span=0,this.visible&&this.scatter.series[0].setData(arguments[0])}.bind(this,t),Math.max(0,5e3-this.span))}else{var i=this.getSize();this.scatter=new Highcharts.Chart({chart:{renderTo:this.chart.attr("id"),type:"scatter",reflow:!1,width:i.width,height:i.height,marginTop:35,backgroundColor:"#000000"},title:{text:""},subtitle:{enabled:!1},exporting:{enabled:!1},legend:{enabled:!1},credits:{enabled:!1},xAxis:{title:{text:"转股溢价率 (%)",style:{color:"#c0c0c0"}},labels:{style:{color:"#999999"}},startOnTick:!0,endOnTick:!0,showLastLabel:!0,gridLineColor:"#333333",gridLineWidth:1},yAxis:{title:{text:"纯 债 溢 价 率 (%)",style:{width:"1em",color:"#c0c0c0"},rotation:0,x:-5,y:-48},labels:{style:{color:"#999999"}},gridLineColor:"#333333"},plotOptions:{scatter:{marker:{radius:5,states:{hover:{enabled:!0,lineColor:"rgb(100,100,100)"}}},states:{hover:{marker:{enabled:!1}}},dataLabels:{enabled:!0,y:-6,formatter:function(){return this.point.name},style:{color:"#c0c0c0",fontSize:"12px"}}}},tooltip:{formatter:function(){return["<b>",this.point.name,"</b><br>转股溢价率 ",this.x.toFixed(4),"%<br>纯债溢价率 ",this.y.toFixed(4),"%"].join("")},backgroundColor:"rgba(0, 0, 0, 0.75)",style:{fontFamily:"simsun",fontSize:"13px",color:"#c0c0c0"}},series:[{data:t}]})}}});return i.init=function(t,i){var n=new this({chart:$("#scatter")}),s=new e(n);return s.items=i,n},i}),define("presenters/track",["presenter_base","topic","vue"],function(t,e,i){return t.extend({init:function(){this.createViewModel(),this.view.on("filtersChange",this.onFiltersChange.bind(this)),this.view.on("contentBtnClick",this.onContentBtnClick.bind(this)),e.on("updated",this.view.renderGrid.bind(this.view))},onInit:function(){this.view.renderFilters(this.vm),this.onFiltersChange()},onFiltersChange:function(){this.view.renderGrid(this.items,this.vm.provisions)},onContentBtnClick:function(t){this.view.renderDialog(t)},createViewModel:function(){this.vm=new i({data:{provisions:[!0,!0,!0,!0]}})}})}),define("views/track",["view_base","../presenters/track","active_grid","splitter","tabs","select","dialog"],function(t,e,i){var n=t.extend(function(){},{renderFilters:function(t){t.$mount(this.form[0]),this.form.find("select").widget("select")},renderDialog:function(t){var e=this.quotesGrid.getItem(t.index);this.dialog.target.find("article").html(["<h1></h1><section>",e[t.content],"</section>"].join("")),this.dialog.show()},renderGrid:function(t,e){t?(this.quotesGrid&&this.quotesGrid.destroy(),this.quotesGrid=new i(this.grid[0],{columns:this.getColumns(e),items:t,provisions:e,scrollTop:this.quotesGrid&&this.quotesGrid.scrollTop||0,scrollLeft:this.quotesGrid&&this.quotesGrid.scrollLeft||0,onCreate:function(){this.target.css("padding-top",56).find("tr").before(["<tr>",'<td colspan="8">可转债</td>','<td colspan="5">转股价修正条款</td>','<td colspan="6">提前回售条款</td>','<td colspan="6">提前赎回条款</td>','<td colspan="4">到期赎回条款</td>',"<td></td>","</tr>"].filter(function(t,e){return 2>e||e>5||this[e-2]}.bind(this.provisions)).join(""))},compare:function(t){return function(t,e){return this(t,e)||t.bond_obj.localeCompare(e.bond_obj)}.bind(this.base(t))}})):this.visible&&this.quotesGrid&&this.quotesGrid.refresh(!0)},getColumns:function(t){return Array.prototype.concat.apply([{width:"40",name:"序号",css:"white c",value:function(t,e){return e+1}},{width:"85",name:"转债代码",css:"blue c",sort:!0,value:function(t){return'<a href="dzh://VIEWSTOCK?DATATYPE=DAY&LAYOUT=Level2默认&PAGE=分时走势&LABEL='+t.bond_obj+'">'+t.A2+"</a>"}},{width:"85",name:"转债简称",css:"c",sort:!0,value:function(t){return'<a href="dzh://VIEWSTOCK?DATATYPE=DAY&LAYOUT=Level2默认&PAGE=分时走势&LABEL='+t.bond_obj+'">'+t.A3+"</a>"}},{width:"100",name:"转股起始日",css:"white",sort:!0,order:"desc",value:function(t){return t.A9.replace(/^(\d{4})(\d\d)(\d\d).*/,"$1-$2-$3")}},{width:"70",name:"正股价",color:function(t){return this.fixColor(this.fixChange(t.stock_new,t.stock_lastclose))},sort:!0,value:function(t){return this.fixValue(this.fixLastTrade(t.stock_new,t.stock_lastclose))}},{width:"100",name:"最新转股价",css:"white",sort:!0,value:function(t){return this.fixValue(t.A7,2)}},{width:"95",name:"余额(亿元)",css:"white",sort:!0,value:function(t){return this.fixFloat(t.A10,4)}},{width:"115",name:"余额占发行比",css:"white",sort:!0,value:function(t){return this.fixPercent(t.A11)}}],[[{width:"160",name:"转股价修正触发条件",css:"orange",sort:!0,value:function(t,e){return'<a data-index="'+e+'" data-title="A12" data-content="A16" data-bind="onContentBtnClick"><i class="fa fa-external-link-square"></i> '+t.A12+"</a>"}},{width:"100",name:"修正触发价",css:"white",sort:!0,value:function(t){return this.fixFloat(t.A13,2)}},{width:"165",name:"修正触发价/正股价-1",css:"white",sort:!0,value:function(t){return this.fixPercent(100*(t.A13/this.fixLastTrade(t.stock_new,t.stock_lastclose)-1),2)}},{width:"100",name:"已满足天数",css:"white",sort:!0,value:function(t){return t.A14}},{width:"85",name:"触发进度",css:"blue l",sort:!0,value:function(t){return'<span class="bar" style="width: '+.99*t.A15+'%;">'+t.A15+"%</span>"}}],[{width:"100",name:"回售起始日",css:"white",sort:!0,value:function(t){return t.A17.replace(/^(\d{4})(\d\d)(\d\d).*/,"$1-$2-$3")}},{width:"160",name:"提前回售触发条件",css:"orange",sort:!0,value:function(t,e){return t.A17?'<a data-index="'+e+'" data-title="A18" data-content="A22" data-bind="onContentBtnClick"><i class="fa fa-external-link-square"></i> '+t.A18+"</a>":""}},{width:"70",name:"触发价",css:"white",sort:!0,value:function(t){return t.A17?this.fixFloat(t.A19,2):""}},{width:"145",name:"触发价/正股价-1",css:"white",sort:!0,value:function(t){return t.A17?this.fixPercent(100*(t.A19/this.fixLastTrade(t.stock_new,t.stock_lastclose)-1),2):""}},{width:"100",name:"已满足天数",css:"white",sort:!0,value:function(t){return t.A17?t.A20:""}},{width:"85",name:"触发进度",css:"blue l",sort:!0,value:function(t){return t.A17?'<span class="bar" style="width: '+.99*t.A21+'%;">'+t.A21+"%</span>":""}}],[{width:"100",name:"赎回起始日",css:"white",sort:!0,value:function(t){return t.A23.replace(/^(\d{4})(\d\d)(\d\d).*/,"$1-$2-$3")}},{width:"160",name:"提前赎回触发条件",css:"orange",sort:!0,value:function(t,e){return'<a data-index="'+e+'" data-title="A24" data-content="A28" data-bind="onContentBtnClick"><i class="fa fa-external-link-square"></i> '+t.A24+"</a>"}},{width:"70",name:"触发价",css:"white",sort:!0,value:function(t){return this.fixFloat(t.A25,2)}},{width:"145",name:"正股价/触发价-1",css:"white",sort:!0,value:function(t){return this.fixPercent(100*(this.fixLastTrade(t.stock_new,t.stock_lastclose)/t.A25-1),2)}},{width:"100",name:"已满足天数",css:"white",sort:!0,value:function(t){return t.A26}},{width:"85",name:"触发进度",css:"blue l",sort:!0,value:function(t){return'<span class="bar" style="width: '+.99*t.A27+'%;">'+t.A27+"%</span>"}}],[{width:"85",name:"到期日",css:"white",sort:!0,value:function(t){return t.A29.replace(/^(\d{4})(\d\d)(\d\d).*/,"$1-$2-$3")}},{width:"100",name:"到期赎回价",css:"white",sort:!0,value:function(t){return this.fixFloat(t.A30,2)}},{width:"170",name:"是否含最后一期利息",css:"white",sort:!0,value:function(t){return"1"===t.A31?"是":"否"}},{width:"85",name:"触发进度",css:"blue l",sort:!0,value:function(t){return'<span class="bar" style="width: '+.99*t.A32+'%;">'+t.A32+"%</span>"}}]].filter(function(t,e){return this[e]}.bind(t)).concat([{width:"auto",name:"",value:function(){return""}}]))}});return n.init=function(t,i){var n=new this({root:t,form:t.find("form"),grid:t.find(".grid"),dialog:$(".dialog").widget("dialog")}),s=new e(n);return s.items=i,n},n}),define("views/index",["view_base","../presenters/index","./contrast","./scatter","./track","tabs"],function(t,e,i,n,s){var o=t.extend(function(){this.tabs.on("active",this.onTabActive.bind(this))},{views:[],onTabActive:function(t,e){this.emit("tabActive",e)},renderPane:function(t,e){if(!this.views[t]){var o=[i,n,s][t];o&&(this.views[t]=o.init(this.panes.eq(t),e),this.views[t].emit("init"))}this.activeView&&(this.activeView.visible=!1),this.activeView=this.views[t],this.activeView&&(this.activeView.visible=!0)}});return o.init=function(){new e(new this({tabs:$(".nav-tabs"),panes:$(".nav-panes > div")}))},o}),require(["views/index"],function(){require(["views/"+(location.pathname.match(/([^\/]+)\.html/)||[,"index"])[1]],function(){arguments[0]&&arguments[0].init&&arguments[0].init()})}),define("src",function(){});