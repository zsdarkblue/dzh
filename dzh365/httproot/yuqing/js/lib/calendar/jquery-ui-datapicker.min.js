(function(f){f.fn.datapicker=function(x){var m=f.extend({},f.fn.datapicker.defaults,x);var s;var u,o,t,p,r;var w;var v,q;var n={init:function(){f("#dataPickerBd").remove();w=f("#"+m.inputtextId);var y=w.val().split("-");if(y.length==3&&/^\d{4}$/.test(y[0])&&/[0-9]{1,2}/.test(y[1])&&/[0-9]{1,2}/.test(y[2])&&y[1]<=12&&y[1]>0&&y[2]>0&&y[2]<=31){s=this;this.create()}else{alert("日期不符合格式，请重新填写");f(".dataPickerBd").remove();return false}},create:function(){var A=f("html").width();var B=w.offset().top;var z=w.offset().left;var C=A-z;var y=w.height();if(C>m.pickerWidth){z=z}else{z=A-m.pickerWidth-3}top.$("body").append("<div id='dataPickerBd' style='width:"+m.pickerWidth+"px;height:"+m.pickerHeight+"px;background:"+m.bgcolor+";top:"+(parseInt(B)+y+2)+"px;left:"+z+"px;' class='dataPickerBd'></div>");this.createTitle();this.createBd();this.prototype.bind();v=f("#dataPickerBd").offset().top;q=f("#dataPickerBd").offset().left},createTitle:function(){f(".dataPickerBd").append("<div class='dataPickerTitle'></div>");this.createTriangle()},createTriangle:function(){u="<span class='fs1 prevYear' aria-hidden='true' data-icon='"+m._left2triangle+"'></span>";o="<span class='fs1 nextYear' aria-hidden='true' data-icon='"+m._right2triangle+"'></span>";t="<span class='fs1 prevMonth' aria-hidden='true' data-icon='"+m._lefttriangle+"'></span>";p="<span class='fs1 nextMonth' aria-hidden='true' data-icon='"+m._righttriangle+"'></span>";r="<span class='fs1 downtriangle data-selected' aria-hidden='true' data-icon='"+m._downtriangle+"'></span>";f(".dataPickerTitle").append(u+t+"<a class='title_time_year'>"+k+"</a><label><a data-month='"+a+"' class='borderstyle'><span>"+i[a-1]+"月</span>"+r+"</a></label></a>"+p+o)},createBd:function(){var y=m.pickerHeight-f(".dataPickerTitle").height();f(".dataPickerBd").append("<div style='height:"+y+"px;' class='dataPickerCon'></div>");this.createTable(k,a)},createTable:function(A,B){var D="";for(var y in l){D+="<td>"+l[y]+"</td>"}var z='<div class="tablecon"><table><thead><tr>'+D+"</tr></thead><tbody></tbody></table></div>";f(".dataPickerCon").append(z);var C=this.createTime(k,a,1)},createTime:function(H,F,G){var B=w.val().split("-");if(G==2){}else{if(B.length==3&&/^\d{4}$/.test(B[0])&&/[0-9]{1,2}/.test(B[1])&&/[0-9]{1,2}/.test(B[2])&&B[1]<=12&&B[1]>0&&B[2]>0&&B[2]<=31){G=1}else{G=2;return false}}switch(G){case 2:H=H;F=F;break;case 1:H=B[0];F=(B[1]>10)?B[1]:B[1].substring(1,2);c=(B[2]>10)?B[2]:B[2].substring(1,2);k=B[0];a=(B[1]>10)?B[1]:B[1].substring(1,2);s.prototype.sltRemove();f(".dataPickerTitle .borderstyle").empty();f(".dataPickerTitle .borderstyle").append("<span>"+i[F-1]+"月</span>"+r);f(".dataPickerTitle .borderstyle").attr("data-month",F);break}f(".tablecon tbody").empty();var D=g(H,F);var K=F-1;if(K==0){K=12}else{K=K}var z=d(H,K);var A=b(H,F);var N="";var L=nextStartDay=1;if(A==0){A=7}var y=z-A+1;var I,M,E;if(F==1){I=parseInt(H)-1}else{if(F==12){M=parseInt(H)+1}}E=H;for(var C=1;C<7;C++){N+="<tr>";for(var J=0;J<7;J++){if(L==1&&A==0&&C==1){if(F==1){N+="<td year="+I+" month=12 class='blue'>"+y+"</td>"}else{N+="<td year="+E+" month="+(F-1)+" class='blue'>"+y+"</td>"}y++}else{if(J!=A&&C==1){if(y>z){N+="<td year="+E+" month="+(F-1)+">"+L+"</td>";L++}else{if(F==1){N+="<td year="+I+" month=12 class='blue'>"+y+"</td>"}else{N+="<td year="+E+" month="+(F-1)+" class='blue'>"+y+"</td>"}}y++}else{if(C!=1&&L>D){if(F==12){N+="<td year="+M+" month=1 class='blue'>"+nextStartDay+"</td>"}else{N+="<td year="+E+" month="+(parseInt(F)+1)+" class='blue'>"+nextStartDay+"</td>"}nextStartDay++}else{if(c==L&&k==f(".title_time_year").text()&&f(".dataPickerTitle .borderstyle").attr("data-month")==a){N+="<td year="+E+" month="+(F)+" class='sel'>"+L+"</td>"}else{if(L==j.getDate()&&E==j.getFullYear()&&F==(j.getMonth()+1)){N+="<td year="+E+" month="+(F)+" class='today'>"+L+"</td>"}else{N+="<td year="+E+" month="+(F)+">"+L+"</td>"}}L++}}}}N+="</tr>"}f(".tablecon tbody").append(N)}};n.prototype={prevYear:function(){s.prototype.sltRemove();var z=f(".title_time_year").text()-1;f(".title_time_year").text(z);var y=f(".dataPickerTitle .borderstyle").attr("data-month");s.createTime(z,y,2)},nextYear:function(){s.prototype.sltRemove();var y=parseInt(f(".title_time_year").text())+1;f(".title_time_year").text(y);var z=f(".dataPickerTitle .borderstyle").attr("data-month");s.createTime(y,z,2)},prevMonth:function(){s.prototype.sltRemove();var z=f(".dataPickerTitle .borderstyle").attr("data-month")-1;var y=f(".title_time_year").text();if(z==0){z=12;y=y-1}f(".title_time_year").text(y);f(".dataPickerTitle .borderstyle").attr("data-month",z);f(".dataPickerTitle .borderstyle").empty();f(".dataPickerTitle .borderstyle").append("<span>"+i[z-1]+"月</span>"+r);s.createTime(y,z,2)},nextMonth:function(){s.prototype.sltRemove();var z=parseInt(f(".dataPickerTitle .borderstyle").attr("data-month"))+1;var y=f(".title_time_year").text();if(z>12){z=1;y=parseInt(y)+1}f(".title_time_year").text(y);f(".dataPickerTitle .borderstyle").attr("data-month",z);f(".dataPickerTitle .borderstyle").empty();f(".dataPickerTitle .borderstyle").append("<span>"+i[z-1]+"月</span>"+r);s.createTime(y,z,2)},selected:function(){f(".dataPicker-slt").remove();var B=f(".dataPickerTitle label").offset().top;var y=f(".dataPickerTitle label").width();var A=f(".dataPickerTitle label").height();f("#dataPickerBd").append("<div style='top:25px;left:126px;width:"+(y-2)+"px;' class='dataPicker-slt'></div>");for(var z=0;z<i.length;z++){f(".dataPicker-slt").append("<p data-cn-month='"+i[z]+"' data-month='"+(z+1)+"'>"+i[z]+"月</p>")}},sltDate:function(){var A=f(this).attr("year");var z=f(this).attr("month");var y=f(this).text();z=(z<10)?"0"+z:z;y=(y<10)?"0"+y:y;var B=A+"-"+z+"-"+y;f(this).parent().parent().find(".sel").removeClass("sel");f(this).addClass("sel");w.val(B);m.callback(B);f("#dataPickerBd").remove();f(document).unbind("mousedown",this.remove);s.prototype.unbind()},selectedOption:function(){var A=f(this).attr("data-month");var z=f(this).attr("data-cn-month");var y=f(".title_time_year").text();f(".dataPickerTitle .borderstyle").empty();f(".dataPickerTitle .borderstyle").attr("data-month",A);f(".dataPickerTitle .borderstyle").append("<span>"+z+"月</span>"+r);s.createTime(y,A,2);s.prototype.sltRemove()},sltRemove:function(){f(".dataPicker-slt").remove()},remove:function(){e=window.event?window.event:e;var A=e.srcElement;var z=e.x;var y=e.y;if(f(A).attr("id")==m.inputtextId||f(A).attr("id")==m.dateId){return true}else{if(y>v&&y<(parseInt(m.pickerHeight)+v)&&z>q&&z<(parseInt(m.pickerWidth)+q)){return true}else{if(f(A).parent().attr("class")=="dataPicker-slt"){return true}else{f("#dataPickerBd").remove();f(document).unbind("mousedown",this.remove)}}}},resize:function(){var A=f("html").width();var B=w.offset().top;var z=w.offset().left;var C=A-z;var y=w.height();if(C>m.pickerWidth){z=z}else{z=A-m.pickerWidth-3}f("#dataPickerBd").css("top",(parseInt(B)+y+2));f("#dataPickerBd").css("left",z);v=f("#dataPickerBd").offset().top;q=f("#dataPickerBd").offset().left},bind:function(){f(".prevYear").bind("click",this.prevYear);f(".nextYear").bind("click",this.nextYear);f(".prevMonth").bind("click",this.prevMonth);f(".nextMonth").bind("click",this.nextMonth);f(".dataPickerTitle").on("click",".data-selected",this.selected);f("#dataPickerBd").on("click",".dataPicker-slt p",this.selectedOption);f("#dataPickerBd").on("click","tbody td",this.sltDate);document.addEventListener("click",this.remove,false);window.addEventListener("resize",this.resize,false)},unbind:function(){f(".prevYear").unbind("click",this.prevYear);f(".nextYear").unbind("click",this.nextYear);f(".prevMonth").unbind("click",this.prevMonth);f(".nextMonth").unbind("click",this.nextMonth)}};n.init()};var j=new Date();var k=j.getFullYear();var a=j.getMonth()+1;var c=j.getDate();var h=j.getDay();var l=["日","一","二","三","四","五","六"];var i=["一","二","三","四","五","六","七","八","九","十","十一","十二"];function g(m,n){return new Date(m,n,0).getDate()}function d(m,n){return g(m,n)}function b(m,p){var n=new Date(m,p,0);n.setDate(1);var o=["0","1","2","3","4","5","6"];return o[n.getDay()]}f.fn.datapicker.defaults={pickerWidth:"280",pickerHeight:"200",bgcolor:"#ededed",dateId:"data_btn",_left2triangle:"&#xe01f;",_right2triangle:"&#xe020;",_lefttriangle:"&#xe01d;",_righttriangle:"&#xe01c;",_downtriangle:"&#xe01e;",inputtextId:"calendartext",callback:function(m){}}})(jQuery);
