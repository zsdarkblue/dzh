(function(d){var c=d(document).data("func",{});d.smartMenu=d.noop;d.fn.smartMenu=function(k,n){var a=d("body"),j={name:"",offsetX:2,offsetY:2,textLimit:6,beforeShow:d.noop,afterShow:d.noop};var b=d.extend(j,n||{});var l=function(g){var e=g||k,h=g?Math.random().toString():b.name,i="",p="",f="smart_menu_";if(d.isArray(e)&&e.length){i='<div id="smartMenu_'+h+'" class="'+f+'box"><div class="'+f+'body"><ul class="'+f+'ul">';d.each(e,function(o,r){if(o){i=i+'<li class="'+f+'li_separate">&nbsp;</li>'}if(d.isArray(r)){d.each(r,function(C,z){var y=z.text,A="",D="",B=Math.random().toString().replace(".","");if(y){if(y.length>b.textLimit){y=y.slice(0,b.textLimit)+"â€¦";D=' title="'+z.text+'"'}if(d.isArray(z.data)&&z.data.length){A='<li class="'+f+'li" data-hover="true">'+l(z.data)+'<a href="javascript:" class="'+f+'a"'+D+' data-key="'+B+'"><i class="'+f+'triangle"></i>'+y+"</a></li>"}else{A='<li class="'+f+'li"><a href="javascript:" class="'+f+'a"'+D+' data-key="'+B+'">'+y+"</a></li>"}i+=A;var q=c.data("func");q[B]=z.func;c.data("func",q)}})}});i=i+"</ul></div></div>"}return i},m=function(){var g="#smartMenu_",e="smart_menu_",f=d(g+b.name);if(!f.size()){d("body").append(l());d(g+b.name+" a").bind("click",function(){var h=d(this).attr("data-key"),i=c.data("func")[h];if(d.isFunction(i)){i.call(c.data("trigger"))}d.smartMenu.hide();return false});d(g+b.name+" li").each(function(){var h=d(this).attr("data-hover"),i=e+"li_hover";d(this).hover(function(){var p=d(this).siblings("."+i);p.removeClass(i).children("."+e+"box").hide();p.children("."+e+"a").removeClass(e+"a_hover");if(h){d(this).addClass(i).children("."+e+"box").show();d(this).children("."+e+"a").addClass(e+"a_hover")}})});return d(g+b.name)}return f};d(this).each(function(){this.oncontextmenu=function(e){if(d.isFunction(b.beforeShow)){b.beforeShow.call(this)}e=e||window.event;e.cancelBubble=true;if(e.stopPropagation){e.stopPropagation()}d.smartMenu.hide();var f=c.scrollTop();var g=m();if(g){g.css({display:"block",left:e.clientX+b.offsetX,top:e.clientY+f+b.offsetY});c.data("target",g);c.data("trigger",this);if(d.isFunction(b.afterShow)){b.afterShow.call(this)}return false}}});if(!a.data("bind")){a.bind("click",d.smartMenu.hide).data("bind",true)}};d.extend(d.smartMenu,{hide:function(){var a=c.data("target");if(a&&a.css("display")==="block"){a.hide()}},remove:function(){var a=c.data("target");if(a){a.remove()}}})})(jQuery);